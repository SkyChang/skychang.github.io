{"componentChunkName":"component---src-templates-page-js","path":"/2011/09/18/ASP-NET-MVC-升級ASP-NET-MVC-3專案至ASP-NET-MVC-4/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"ASP.NET MVC -  升級ASP.NET MVC 3專案至ASP.NET MVC 4","date":"18 September 2011","author":"Sky Chang","excerpt":null,"tags":["ASP.NET MVC"],"coverImage":null},"id":"aa3b3e9b-a56f-5253-a398-7a15530f9dc2","html":"<p>這篇是在官網看到的，因為我覺得滿實用，就順便實作了一次，首先，ASP.NET MVC 4是可以和ASP.NET MVC 3 和平相處的，所以我們可以選擇適合的時間點，將ASP.NET MVC 3換成ASP.NET MVC 4。</p>\n<p>另外，官網上建議最簡單的升級方式，就是創建一個新的ASP.NET MVC 4專案，然後把舊的ASP.NET MVC 3的views, controllers, code, and content files等東西，拷貝到新的ASP.NET MVC 4專案，並設定好關聯，最後也別忘了，Web.config也要將原本ASP.NET MVC 3有改過的地方，弄過去到ASP.NET MVC 4。</p>\n<p>如要手動升級ASP.NET MVC 3到ASP.NET MVC 4可以依照我下面的步驟去做，內容除了官網的解說外，我也附加上我自己的圖，我相信這樣會比較清楚。</p>\n<p>1.修改Web.Config的字串( Web.Config除了根目錄外，還有在View下，還有一個在Area下 )反正所有看到的Web.Config都要留意，將原本的以下字串。</p>\n<pre class=\"brush: csharp;\">System.Web.Mvc, Version=3.0.0.0\nSystem.Web.WebPages, Version=1.0.0.0\nSystem.Web.Helpers, Version=1.0.0.0\nSystem.Web.WebPages.Razor, Version=1.0.0.0\n</pre>\n<p>改為以下字串。</p>\n<pre class=\"brush: csharp;\">System.Web.Mvc, Version=4.0.0.0\nSystem.Web.WebPages, Version=2.0.0.0\nSystem.Web.Helpers, Version=2.0.0.0,\nSystem.Web.WebPages.Razor, Version=2.0.0.0,\n</pre>\n<p>基本上根目錄並沒有System.Web.WebPages.Razor，所以我把剩餘的部分改一改。</p>\n<p><a href=\"http://lh3.ggpht.com/-LECDA0IHtv4/TncEb9jEF-I/AAAAAAAAAis/FsACSRutRMQ/s1600-h/image%25255B3%25255D.png\"><img src=\"http://lh4.ggpht.com/-FcvmLjkK7lo/TncEcX5nPzI/AAAAAAAAAiw/JhzMe5nM0Uo/image_thumb%25255B1%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>而View底下的Web.config，就有很多東西要修改了，如果有Area，基本上和View下面的Web.config同。</p>\n<p><a href=\"http://lh4.ggpht.com/--wgXKQ4TPUE/TncEcyKlD4I/AAAAAAAAAi0/UnmDUt7wqRM/s1600-h/image%25255B7%25255D.png\"><img src=\"http://lh5.ggpht.com/-ouq98GjSnVw/TncEdUZgUhI/AAAAAAAAAi4/d077Ib6qPBQ/image_thumb%25255B3%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>View底下的Web.config還有這裡，滿容易漏掉的。</p>\n<p><a href=\"http://lh6.ggpht.com/-IaRE_qthxbQ/TncEdpBQWfI/AAAAAAAAAi8/T_KIjFcSOXo/s1600-h/image%25255B28%25255D.png\"><img src=\"http://lh5.ggpht.com/-w__faOfO8Bo/TncEeGmNGlI/AAAAAAAAAjA/vELG4x2Tl8Q/image_thumb%25255B14%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>2.在根目錄的Web.config，將webPages更改為\"2.0.0.0”，並添加一個新的PreserveLoginUrl，值設為True，如下:</p>\n<pre class=\"brush: xml;\">&lt;appSettings&gt;\n  &lt;add key=\"webpages:Version\" value=\"2.0.0.0\" /&gt;\n  &lt;add key=\"PreserveLoginUrl\" value=\"true\" /&gt;\n&lt;appSettings&gt;\n</pre>\n<p>3.在Visual Studio的參考裡面，刪除對 3.0版本的System.Web.Mvc參考( dll )。然後添加一個 System.Web.Mvc（v4.0.0.0）如下:</p>\n<ol>\n<li>System.Web.Mvc (v3.0.0.0)<li>System.Web.WebPages (v1.0.0.0)<li>System.Web.Razor (v1.0.0.0)<li>System.Web.WebPages.Deployment (v1.0.0.0)<li>System.Web.WebPages.Razor (v1.0.0.0)</li>\n</ol>\n<p>然後加入以下參考</p>\n<ol>\n<li>System.Web.Mvc (v4.0.0.0)<li>System.Web.WebPages (v2.0.0.0)<li>System.Web.Razor (v2.0.0.0)<li>System.Web.WebPages.Deployment (v2.0.0.0)<li>System.Web.WebPages.Razor (v2.0.0.0)</li>\n</ol>\n<p>我之前的專案只有用到System.Web.Mvc和System.Web.WebPages，但我看新開的MVC4專案則有參考到全部，所以這邊我還是全部都參考進去。</p>\n<p><a href=\"http://lh6.ggpht.com/-DVlNQQtavxI/TncEeV5hl1I/AAAAAAAAAjE/nEsVXDUXxgE/s1600-h/image%25255B11%25255D.png\"><img src=\"http://lh3.ggpht.com/-i1uWdof51mo/TncEe8RItfI/AAAAAAAAAjI/fTSvdgpapNc/image_thumb%25255B5%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>記得要選對版本。</p>\n<p><a href=\"http://lh6.ggpht.com/-t86OhoP3tPs/TncEfsPQKAI/AAAAAAAAAjM/6wefh8VZ2HU/s1600-h/image%25255B16%25255D.png\"><img src=\"http://lh3.ggpht.com/-AEpOV-v_XTk/TncEhYQ-08I/AAAAAAAAAjQ/Wvq1WDQPONA/image_thumb%25255B8%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>4.在方案總管中，右鍵點擊項目名稱，然後選擇卸載項目。然後再右鍵點擊此名稱，並選擇編輯 ProjectName.csproj。( 這裡要注意一下，如果只有一個專案，是沒辦法卸載的，此時可以直接使用記事本去改，也是可以的。)</p>\n<p><a href=\"http://lh5.ggpht.com/-xUeCQM5OUVg/TncEiCgthyI/AAAAAAAAAjU/-X1i3FtE8wc/s1600-h/image%25255B20%25255D.png\"><img src=\"http://lh3.ggpht.com/-ky_RaeUaQqo/TncEi0vUacI/AAAAAAAAAjY/NpToLImRUps/image_thumb%25255B10%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>5.找到ProjectTypeGuids元素，用{E3E379DF- F4C6-4180-9B81-6769533ABE47}取代{E53F8FEA- EAE0-44A6-8774- FFD645390401}。</p>\n<p><a href=\"http://lh4.ggpht.com/-NKDln2QW6bk/TncEjKcIbCI/AAAAAAAAAjc/_AS457Qd3Yg/s1600-h/image%25255B24%25255D.png\"><img src=\"http://lh5.ggpht.com/-36BIhhOeo0w/TncEjiWH3XI/AAAAAAAAAjg/GJuyTr-K-AI/image_thumb%25255B12%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>6.儲存，並關閉正在編輯中的(csproj)文件，右鍵點擊該項目，然後選擇重新載入。</p>\n<p>7.如果有引用任何第三方元件，且會編譯使用以前版本的ASP.NET MVC，就必須打開根目錄的Web.config文件，並添加以下bindingRedirect元素：</p>\n<pre class=\"brush: xml;\">&lt;configuration&gt;\n  &lt;!--... elements deleted for clarity ...--&gt;\n\n  &lt;runtime&gt;\n    &lt;assemblyBinding xmlns=\"urn:schemas-microsoft-com:asm.v1\"&gt;\n      &lt;dependentAssembly&gt;\n        &lt;assemblyIdentity name=\"System.Web.Helpers\" \n             publicKeyToken=\"31bf3856ad364e35\" /&gt;\n        &lt;bindingRedirect oldVersion=\"1.0.0.0\" newVersion=\"2.0.0.0\"/&gt;\n      &lt;/dependentAssembly&gt;\n      &lt;dependentAssembly&gt;\n        &lt;assemblyIdentity name=\"System.Web.Mvc\" \n             publicKeyToken=\"31bf3856ad364e35\" /&gt;\n        &lt;bindingRedirect oldVersion=\"1.0.0.0-3.0.0.0\" newVersion=\"4.0.0.0\"/&gt;\n      &lt;/dependentAssembly&gt;\n      &lt;dependentAssembly&gt;\n        &lt;assemblyIdentity name=\"System.Web.WebPages\" \n             publicKeyToken=\"31bf3856ad364e35\" /&gt;\n        &lt;bindingRedirect oldVersion=\"1.0.0.0\" newVersion=\"2.0.0.0\"/&gt;\n      &lt;/dependentAssembly&gt;\n    &lt;/assemblyBinding&gt;\n  &lt;/runtime&gt;\n&lt;/configuration&gt;\n</pre>\n<p>以上，完成收工!</p>\n<h4>參考資料</h4>\n<ol>\n<li><a href=\"http://www.asp.net/learn/whitepapers/mvc4-release-notes\" title=\"http://www.asp.net/learn/whitepapers/mvc4-release-notes\">http://www.asp.net/learn/whitepapers/mvc4-release-notes</a></li>\n</ol>","excerpt":"這篇是在官網看到的，因為我覺得滿實用，就順便實作了一次，首先，ASP.NET MVC 4是可以和ASP.NET MVC 3 和平相處的，所以我們可以選擇適合的時間點，將ASP.NET MVC 3換成ASP.NET MVC…"}},"pageContext":{"type":"posts","next":{"frontmatter":{"path":null,"title":"ASP.NET MVC - ASP.NET MVC 4 全新範例樣板","tags":["ASP.NET MVC"]},"fields":{"slug":"/2011/09/18/ASP-NET-MVC-ASP-NET-MVC-4-全新範例樣板/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/ASP-NET-MVC-ASP-NET-MVC-4-全新範例樣板.md"},"previous":{"frontmatter":{"path":null,"title":"ASP.NET MVC - ASP.NET MVC 4 Mobile範例樣板","tags":["ASP.NET MVC"]},"fields":{"slug":"/2011/09/19/ASP-NET-MVC-ASP-NET-MVC-4-Mobile範例樣板/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/ASP-NET-MVC-ASP-NET-MVC-4-Mobile範例樣板.md"}}}}