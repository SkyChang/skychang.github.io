{"componentChunkName":"component---src-templates-page-js","path":"/2020/12/12/Apache-Spark-Use_DotNet_For_Apache_Spark/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Apache Spark - 使用 .NET for Apache Spark","date":"12 December 2020","author":"Sky Chang","excerpt":null,"tags":["Azure","DataBricks",".NET","Spark","Linux"],"coverImage":null},"id":"9e8e2ebb-c6dc-5f91-8b5e-cd3bd425de44","html":"<h2>前言</h2>\n<p>其實，這屬於 Data 部門的事情 \b\b( 無誤 )，但因 .NET Conf 的原因，剛好又沒有人講到 .NET for Apache Spark，而近期，因為有個案子剛好有用到 Data Bricks，所以就舉手說，Keynote 來稍微講講 .NET for Apache Spark，於是就產生了這一篇....</p>\n<h2>.NET for Apache Spark</h2>\n<p>那什麼是 .NET for Apache Spark ？</p>\n<p>簡單的說，我們在分析超大型資料的時候，大家可能都有聽過 Apache Spark 這個分析的技術，但上面通常撰寫的語言，不是 Python 就是 Scala，那只會 C# 的小弟，就粉可憐，不過好佳在，目前 .NET 已經強大到，能在各個平台中出現，而今天要講的，就是能在 Apache Spark 上使用 C# 來進行分析。</p>\n<h2>.NET for Apache Spark 環境準備</h2>\n<p>首先，當然要先準備環境，官方<a href=\"https://docs.microsoft.com/zh-tw/dotnet/spark/tutorials/get-started?tabs=windows\">原文在此</a>，但小弟稍微調整了一下，例如，小弟採用 zulu JDK 取代 Oracle JDK，透過 brew 直接安裝 Apache-Spark。</p>\n<p>Note : Windows 環境，請參閱<a href=\"https://docs.microsoft.com/zh-tw/dotnet/spark/tutorials/get-started?tabs=linux\">官網步驟</a>，小弟今天的環境是 MacOS。</p>\n<h3>安裝 .NET</h3>\n<p>首先，既然是 .NET for Apache Spark，那當然就是要先裝 .NET，這邊小弟就不針對 .NET 安裝詳細敘述，可以直接去 .NET 的<a href=\"https://dotnet.microsoft.com/download\">官網下載</a>並安裝。小弟這邊的版本是 .NET 5 的版本。</p>\n<h3>Zulu JDK 11</h3>\n<p>這邊小弟使用 Zulu JDK 11 來取代原本官網的 Oracle JDK 8，目前 Apache Spark 的 Java 最低版本為 8，但官網說 11 也可以，所以這邊就直接使用 Zulu JDK 11。</p>\n<p>( Oracle JDK 因有授權問題，所以為了不必要的困擾，小弟習慣使用 Zulu JDK 來取代 Oracle JDK )</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bda24ab1e95100174049d64652ad9093/b04fb/2020-12-12-15-47-01.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAACD0lEQVQoz22TT2vbQBDF/TWaYw8lKXXB0BxqEp/8NY0vDaU1gRZyCm0JlB5rMPSP4+A4lixZsiWtZK1WWkv268wmNi2NYJhFmv3t08zbmhACWabw++YOP0e3lCf4RXk2m8G2bUynU6xWKxRFQXUZrRNEIoblhZgvI7jLGBMvRioz5HmOGgN5IeIEksBZXpiPaZpivV4TSO+BnDmUUhAiQkx7pZRUL827PZCLy7LEdrsFP7xmoNbaFPKm3Zozb3QcF57nQa5SZGlm1BtgkiSI4xjdbhedTsfk4XBowFzAAFb6d9acTdDBOsNChUYUH1hjJa7rotFooF6v4+DgCc7O3hhgVVV47NlUJUJvjiwUGC9vcDm+hFY5FCtk4Hw+R7vdRrPZxLOjF+idf9gr3LXAwKkl1WaDMgoROjNIf4E7b4Svo8/IfR+KVO6BJyenOD5+haeHL/Hu/KMB8W8YRQTh4B5zlEmM0LYgPR9T9xrfRl+QB8G/wFarhdek8PnRIXq994//8sPQGB6FBEgkJvEEn6wraHID26/GA+EJDQYDE/1+3/R05zsOM2kqVmQprQvzzQyJWnE/qDXWOkdVksKApSplGloUuSlm1WwnPmwXkSA3kEXYQsZ7VBMES4hogUymWAqF0dBHbTwe398Ky8LtZEo3w8KMbgi/+z9sc3vsh++O45AXfSQiwPcfDt5eXOMP0TUmJKVz2ZsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 12 12 15 47 01\"\n        title=\"2020 12 12 15 47 01\"\n        src=\"/static/bda24ab1e95100174049d64652ad9093/78d47/2020-12-12-15-47-01.png\"\n        srcset=\"/static/bda24ab1e95100174049d64652ad9093/56d15/2020-12-12-15-47-01.png 200w,\n/static/bda24ab1e95100174049d64652ad9093/d9f49/2020-12-12-15-47-01.png 400w,\n/static/bda24ab1e95100174049d64652ad9093/78d47/2020-12-12-15-47-01.png 800w,\n/static/bda24ab1e95100174049d64652ad9093/64756/2020-12-12-15-47-01.png 1200w,\n/static/bda24ab1e95100174049d64652ad9093/b04fb/2020-12-12-15-47-01.png 1398w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>確認一下在 /Libary/Java/JavaVirtualMachines/ 底下是否安裝完成，以可以執行 JAVA 看看有無問題。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/30a02d8351803258535e9696bf7ae711/8cb5d/2020-12-12-15-48-13.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABEklEQVQoz3WSa3KDMAyEuVXAGD/AD6hJaXP/u2wlO6YOTX/syJoxH7uSO20ttDEkDa01DJ+5koZhQN/3kFIixgjv/a9CKKKzcy7XQH0ntYEkiGLgbDBpBaUUrLEYxUhQgYn6bdsytAW7WgnIykBDF+y6YnYzlrBgXiyit/iIM1ZvsAaLfXN4PL7xdRxIac/OWkirThOQpQw5syRy6GeJsEgCTljdhBQNjs879pRw31N2xU4ZUF1XdeIZS4ginpsQA8Ut4rNSBKYUFdDWPw7HccyD/0+32+tSasyrs9MhA4ur4u6qdsuh2Wzdajj7xmGN28Z+B8wOF/cCC5cfdAzgj05IE/cdkO/zWz1nydD8hMoofgAP/T1JVkWeSwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 12 12 15 48 13\"\n        title=\"2020 12 12 15 48 13\"\n        src=\"/static/30a02d8351803258535e9696bf7ae711/78d47/2020-12-12-15-48-13.png\"\n        srcset=\"/static/30a02d8351803258535e9696bf7ae711/56d15/2020-12-12-15-48-13.png 200w,\n/static/30a02d8351803258535e9696bf7ae711/d9f49/2020-12-12-15-48-13.png 400w,\n/static/30a02d8351803258535e9696bf7ae711/78d47/2020-12-12-15-48-13.png 800w,\n/static/30a02d8351803258535e9696bf7ae711/8cb5d/2020-12-12-15-48-13.png 906w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3>安裝 Apache Spark</h3>\n<p>這邊官方是使用手動安裝，但目前查看，Brew 已經包好了，所以小弟主要採用 Brew 進行。</p>\n<h4>brew 安裝</h4>\n<p>這邊小弟因為是使用 mac，所以直接使用 brew 進行安裝。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">brew <span class=\"token function\">install</span> apache-spark</code></pre></div>\n<p>玩成後，可以執行底下指令，確認版本。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">spark-submit --version</code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/89cfe55a8e971848de8006270caf5397/8cb5d/2020-12-12-15-34-28.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABAklEQVQoz31RWa6EMAzrrVgLdGWH+5/GL64mI/Q04sNKiIpjO2bJES4EhOARU0TOGSFGWGth+x69YBiG8t11Xal1XaOqqp8w87ogCEnKCXnJiDEgpYR5npGEmDXIwmmaCjlJ27ZF0zSlEpwRTdPC3PeNbduwrqvUHcdxFHB2nidO6fd9Lz3ndKBwzmEcx+KA4EJzXVdRRAVRKvsoyqiKPav3/tvzR5IQtE+lhMZgNBdW3aKW9BGr4pnXc674EhIa/vMImpMq+YXnMsMsaJEWaJu50CKhtqj6jVAXFkI9CINnnjySHoaLuPmN7L9KY0XVIJicqAuiTjB8bHtRq4+fmb7hDy94Nrf40vvMAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 12 12 15 34 28\"\n        title=\"2020 12 12 15 34 28\"\n        src=\"/static/89cfe55a8e971848de8006270caf5397/78d47/2020-12-12-15-34-28.png\"\n        srcset=\"/static/89cfe55a8e971848de8006270caf5397/56d15/2020-12-12-15-34-28.png 200w,\n/static/89cfe55a8e971848de8006270caf5397/d9f49/2020-12-12-15-34-28.png 400w,\n/static/89cfe55a8e971848de8006270caf5397/78d47/2020-12-12-15-34-28.png 800w,\n/static/89cfe55a8e971848de8006270caf5397/8cb5d/2020-12-12-15-34-28.png 906w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h4>手動安裝</h4>\n<p>當然，也可以自行下載。</p>\n<p><a href=\"https://spark.apache.org/downloads.html\">下載</a>，選擇 3.0.1 的版本。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/781aa60d57bc18f721c68482a1866255/b04fb/2020-12-12-14-45-54.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAAB7ElEQVQoz5WSS08UURCF5+cb4gIhKP/ChYnEFTFRBCUIs1DBYZzunn737fftd/dnzQyB4M6bnFR3pXKq6pya1XXNNI6kcUy6+sEY3LN7E//7pmli1jYNZd3y/tMlHz6ecWe5WBqMfMAoRqxyxK8m/HrCk+jocYdyIKxGAj3gC9phN8Csa2qCouXoUvHme8bBt4TDrxEHgv3zgIOLkFeCTdw/D3nxOWDvLOSl1B1dxRzfZLy+TnHLfkdY65ImCLBWFsbSwLhfcX+7wFj8oY0VYxozZjFDmgjkO09AhbSRjVrf0ihTci6M3VakWZXnIFOqosR0XMxA8ct0WTghieTypmP4V6y+J3VWmHfXWL/nZN5SCPsdYV0WdNIxcqTjBp4nAyjCMEb5AVEQyX9EKabpJKZIEtnIp0k8yVnU8VqizTh0u5UbcblKM5aLFbYYYho2oePRJkqKN4iolBBGIfoBleSpOipXkYUihW6fXN6cTS9ns3acZ3BkUtt1tzFUiiCKCGRS1/fI84q5ecrbiz1O5se8uzkk0d6DKULY9QN2ELPyE9Gypm5atNbosmTbUDTrOtGy7x9lNMNbrpan3DmX/LS/ULX5E+EwDKzXa2xZ1Yticl1RFIVMkj8iy7JtblPfiImR3KqZPj//zcp/AR8u8W48m+9RAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 12 12 14 45 54\"\n        title=\"2020 12 12 14 45 54\"\n        src=\"/static/781aa60d57bc18f721c68482a1866255/78d47/2020-12-12-14-45-54.png\"\n        srcset=\"/static/781aa60d57bc18f721c68482a1866255/56d15/2020-12-12-14-45-54.png 200w,\n/static/781aa60d57bc18f721c68482a1866255/d9f49/2020-12-12-14-45-54.png 400w,\n/static/781aa60d57bc18f721c68482a1866255/78d47/2020-12-12-14-45-54.png 800w,\n/static/781aa60d57bc18f721c68482a1866255/64756/2020-12-12-14-45-54.png 1200w,\n/static/781aa60d57bc18f721c68482a1866255/b04fb/2020-12-12-14-45-54.png 1398w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>下載後，將此解壓縮到 ~/bin 底下</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> ~/bin\n<span class=\"token function\">tar</span> xvf spark-3.0.1-bin-hadoop3.2.tgz --directory ~/bin</code></pre></div>\n<p>完成如下</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c89d0179b4541d00c1634275d21b10c7/8cb5d/2020-12-12-14-54-08.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABHUlEQVQoz4WSa5KDIBCEcyvFNw8RRVEreP+j9DJE3CSb3f0xNSDyVU83t8XusJPDMAyY5xnTNMFaGztV13VomgaMMRRFcfXndeysQMUUbvvm4dwOM45Y1zVCqZxzESiEQNu2yPM8XkyVs+/946yA4AF4HB77HoDmFUh7HtSRArqQgGn9/o3+07on4HEBSRXBaOR5WTAG1ZzzC/qs8EXtCez7APT+jm3b4sgJGL0M0LquP6r7E3i/+wuYRh6Dd4MxqKrqzSf2P9An4OkhBUFwAmqt4/5TKL8CD/8Ihfza1i08oSn6Ny/uDMdEYJZlPwJJRWcEViqkbMPFIUC44FBaQSoB03MMWkJKhTqMXZZl9JMsoE7vMq2pKDj6R0qJL2NVPUi9MujdAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 12 12 14 54 08\"\n        title=\"2020 12 12 14 54 08\"\n        src=\"/static/c89d0179b4541d00c1634275d21b10c7/78d47/2020-12-12-14-54-08.png\"\n        srcset=\"/static/c89d0179b4541d00c1634275d21b10c7/56d15/2020-12-12-14-54-08.png 200w,\n/static/c89d0179b4541d00c1634275d21b10c7/d9f49/2020-12-12-14-54-08.png 400w,\n/static/c89d0179b4541d00c1634275d21b10c7/78d47/2020-12-12-14-54-08.png 800w,\n/static/c89d0179b4541d00c1634275d21b10c7/8cb5d/2020-12-12-14-54-08.png 906w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>如果有需要，也可以將此目錄放到環境變數下，來方便使用。</p>\n<h3>下載 .NET for Apache Spark</h3>\n<p>有了 .NET、JAVA、Apache Spark、最後一個步驟要準備的是 .NET for Apache Spark。</p>\n<p>大家可以透過此位置<a href=\"https://github.com/dotnet/spark/releases\">下載</a>，如下圖。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/21f1a9199432ba3547316aa9f26ba8e6/b04fb/2020-12-12-16-10-41.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABmElEQVQoz41Ty27cMAzc//+kAj009/bSNIcWKJpmvfFDsmU9bL3sycheJw1QbEtjINoUqRmKPo1KwVkLYx3cNHO1sG7CNPvtm/cBs/dbrPhldYyHmJDzgpQyUlmJSP8UuNnGFXImphU/nh2ESZAuY5gWnMWIZ6HR9g6VHDCy6A4eHj2mJcIEkggzil0LZogpo3PAuQ/4LRye5IQz8dho3D18xcf7L3jqBtSjQTNqYiQBB5upxLdwOWDlcwrBo9UZ1RBJeQGZI10Rl3U79UH+xOfm2+bndQVDV6zcT7lEXvnG2CmT9qfvEz7cKxbcaQMr3mx59UrCLWySS8P3EgmDG9CqItXv0mXALxHJnrLmyKQFt2xj6K8Fy40pw+YLgfOlxqVu0bQCtdSoux5t10FIuU2BNgbG8CI4BTss8/PO8K1gpuQExWZXVYVLI1B1ejuo8D9kLezX3/Aq+Sh4fIgxcgZnjFpDqREz5/GI/cveST6SSk+t48zVAg3ldrLnIen/LyWE8K6g4oz1wwA5kKHxUNpsf8Gfe27ZC/9eWQOj+0VgAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 12 12 16 10 41\"\n        title=\"2020 12 12 16 10 41\"\n        src=\"/static/21f1a9199432ba3547316aa9f26ba8e6/78d47/2020-12-12-16-10-41.png\"\n        srcset=\"/static/21f1a9199432ba3547316aa9f26ba8e6/56d15/2020-12-12-16-10-41.png 200w,\n/static/21f1a9199432ba3547316aa9f26ba8e6/d9f49/2020-12-12-16-10-41.png 400w,\n/static/21f1a9199432ba3547316aa9f26ba8e6/78d47/2020-12-12-16-10-41.png 800w,\n/static/21f1a9199432ba3547316aa9f26ba8e6/64756/2020-12-12-16-10-41.png 1200w,\n/static/21f1a9199432ba3547316aa9f26ba8e6/b04fb/2020-12-12-16-10-41.png 1398w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>下載下來後，解壓縮到 ~/bin 底下。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">mkdir</span> ~/bin\n<span class=\"token function\">tar</span> xvf Microsoft.Spark.Worker.netcoreapp3.1.osx-x64-1.0.0.zip --directory ~/bin\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">DOTNET_WORKER_DIR</span><span class=\"token operator\">=</span><span class=\"token string\">\"~/bin/Microsoft.Spark.Worker-1.0.0\"</span></code></pre></div>\n<p>如果有需要，也可以將此目錄放到環境變數下，來方便使用。因小弟是使用 zsh，所以放到 .zshrc 底下。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8ca1e9161ae1d2326dfb8b8fe5da085b/8cb5d/2020-12-12-16-22-11.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 44.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAAA/UlEQVQoz22S6Q6EIAyEeSsFjSKXR+L7Pw7bKY5hN/vjC1dppwNmXdc6z7MyTdPLOI51GAYdQUqpllJqzlnHX/Z9VwwCEAxijArm3vu6bZsSZX1dl+5jHUJQeN5jkBUVjuOo53nqyDkVIea+b73gnGtdyOis/Ub2RGF5L6J9KOtbJlAHVTh77UHyHtkzSRJREVtalkUPqQYJUJQKG/a/QgQhIdqCSnpDb+FpkTk8pA2IxR3E0LvweGvQIhTZpwKV8XWJvi6Kdi9K/xW+si6er9B89Opj/41QkN8FFuUfqBqj8SHWDd8mS3s5iuwmP0mruwQgMQq8CZ8vBvigPR8jqjz9Po+93QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 12 12 16 22 11\"\n        title=\"2020 12 12 16 22 11\"\n        src=\"/static/8ca1e9161ae1d2326dfb8b8fe5da085b/78d47/2020-12-12-16-22-11.png\"\n        srcset=\"/static/8ca1e9161ae1d2326dfb8b8fe5da085b/56d15/2020-12-12-16-22-11.png 200w,\n/static/8ca1e9161ae1d2326dfb8b8fe5da085b/d9f49/2020-12-12-16-22-11.png 400w,\n/static/8ca1e9161ae1d2326dfb8b8fe5da085b/78d47/2020-12-12-16-22-11.png 800w,\n/static/8ca1e9161ae1d2326dfb8b8fe5da085b/8cb5d/2020-12-12-16-22-11.png 906w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>撰寫 .NET for Apache Spark 應用程式</h2>\n<p>接著，我們建立一個新的 Console 應用程式。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">dotnet new console -o DotNetForApacheSpark.HelloWorld\n<span class=\"token builtin class-name\">cd</span> DotNetForApacheSpark.HelloWorld\ndotnet <span class=\"token function\">add</span> package Microsoft.Spark</code></pre></div>\n<p>接下來，我們就可以用 .NET 來寫這個程式了，以前，只能透過 Python 或是其他語言，對於只會寫 C# 的小弟我來說，粉可憐的。</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">using</span> <span class=\"token namespace\">System</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token namespace\">Microsoft<span class=\"token punctuation\">.</span>Spark<span class=\"token punctuation\">.</span>Sql</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">using</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Microsoft<span class=\"token punctuation\">.</span>Spark<span class=\"token punctuation\">.</span>Sql<span class=\"token punctuation\">.</span>Functions</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">namespace</span> <span class=\"token namespace\">DotNetForApacheSpark<span class=\"token punctuation\">.</span>HelloWorld</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">class</span> <span class=\"token class-name\">Program</span>\n    <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">static</span> <span class=\"token return-type class-name\"><span class=\"token keyword\">void</span></span> <span class=\"token function\">Main</span><span class=\"token punctuation\">(</span><span class=\"token class-name\"><span class=\"token keyword\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></span> args<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// Create Spark session</span>\n            <span class=\"token class-name\">SparkSession</span> spark <span class=\"token operator\">=</span>\n                SparkSession\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">Builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">AppName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"word_count_sample\"</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">GetOrCreate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Create initial DataFrame</span>\n            <span class=\"token class-name\"><span class=\"token keyword\">string</span></span> filePath <span class=\"token operator\">=</span> args<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            <span class=\"token class-name\">DataFrame</span> dataFrame <span class=\"token operator\">=</span> spark<span class=\"token punctuation\">.</span><span class=\"token function\">Read</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Text</span><span class=\"token punctuation\">(</span>filePath<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">//Count words</span>\n            <span class=\"token class-name\">DataFrame</span> words <span class=\"token operator\">=</span>\n                dataFrame\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">Select</span><span class=\"token punctuation\">(</span><span class=\"token function\">Split</span><span class=\"token punctuation\">(</span><span class=\"token function\">Col</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"value\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token string\">\" \"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Alias</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"words\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">Select</span><span class=\"token punctuation\">(</span><span class=\"token function\">Explode</span><span class=\"token punctuation\">(</span><span class=\"token function\">Col</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"words\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Alias</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"word\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">GroupBy</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"word\"</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">Count</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">OrderBy</span><span class=\"token punctuation\">(</span><span class=\"token function\">Col</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"count\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">Desc</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Display results</span>\n            words<span class=\"token punctuation\">.</span><span class=\"token function\">Show</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n            <span class=\"token comment\">// Stop Spark session</span>\n            spark<span class=\"token punctuation\">.</span><span class=\"token function\">Stop</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>完成後進行編譯。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">dotnet build</code></pre></div>\n<p>然後這邊建立一個文件稱為 input.txt，這個文件，等等會提供 Apache Spark 進行文字的解析。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Hello World\nThis .NET app uses .NET for Apache Spark\nThis .NET app counts words with Apache Spark</code></pre></div>\n<p>完成後，請將 input.txt 複製到 .NET Build 出來的目錄底下，通常為 bin/Debug/net5.0 底下，然後我們也必須應換到這個目錄下執行底下指令，需要注意的是 microsoft-spark-3-0_2.12-1.0.0.jar，這個檔案，其實就在 bin/Debug/net5.0 底下，而 DotNetForApacheSpark.HelloWorld.dll 因為是編譯出來的，所以也同樣在 bin/Debug/net5.0 底下，所以，進入 bin/Debug/net5.0 底下直接執行底下命令會比較快。</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">spark-submit <span class=\"token punctuation\">\\</span>\n--class org.apache.spark.deploy.dotnet.DotnetRunner <span class=\"token punctuation\">\\</span>\n--master <span class=\"token builtin class-name\">local</span> <span class=\"token punctuation\">\\</span>\nmicrosoft-spark-3-0_2.12-1.0.0.jar <span class=\"token punctuation\">\\</span>\ndotnet DotNetForApacheSpark.HelloWorld.dll input.txt</code></pre></div>\n<p>完成的結果如下，可以快速分析完剛剛提供的文件。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/f66828a2b6e0d00f0c79306eba2a497a/912c7/2020-12-12-16-50-29.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 62.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsSAAALEgHS3X78AAAB4ElEQVQ4y51S127bQBDkd4iiKPFYxV4sFlEsUoLATpACxA9BECD//xOT3TUoK4YNBHkYzHGPt2VmtaZrkKU54jhGEifIsgx12+BwOKA/ndD3PU7HI6ZpQtu2KIpCkKYpkiQhpII8z+WtdpknDMNAP2RyoWwbrueiqiopEgQBXNcVGIaBzWYj4PN6vRYscWatSCIcuw5FWSGKYnnIl47jwKbkzBzzPA/b7VYe3Sa+LcCsxdTBPM2Y5hnzfEZJiZfKL/FaopfQiiLHeb6QViONPpE+1T89fDNhTEZworY9out60i3FarW6arSMeAuO67r+avc08h7DacAwjri7O5BenhjB+rFuzKZpin4LlFLicBiG8H3/qjXfaUkQYhxGWRHHcelnWxwuy1LWo65rWRH+Zub1WFxfjOMClmU9dVjR7jR1I2awy5yU1yWKoje1fMswWZuMumialsbcS0LP86UzHvt/zNGUTW3zqMQMy1LXhLpUN55hPPESNwzav83f0DzSwVEWXFsRbNjWDnEYIPQ9OTtqJ/fMareFS2fPUfK9Mw2Yho7NenWFVn76DW/4CrO+h9k8YEsIzo/YXx6RfPiB/OGXIL3/SfHvUP1nuOM3+MMX2N1HGNV7rIoL1uU76MR/ACAbfC44eVpzAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"2020 12 12 16 50 29\"\n        title=\"2020 12 12 16 50 29\"\n        src=\"/static/f66828a2b6e0d00f0c79306eba2a497a/78d47/2020-12-12-16-50-29.png\"\n        srcset=\"/static/f66828a2b6e0d00f0c79306eba2a497a/56d15/2020-12-12-16-50-29.png 200w,\n/static/f66828a2b6e0d00f0c79306eba2a497a/d9f49/2020-12-12-16-50-29.png 400w,\n/static/f66828a2b6e0d00f0c79306eba2a497a/78d47/2020-12-12-16-50-29.png 800w,\n/static/f66828a2b6e0d00f0c79306eba2a497a/64756/2020-12-12-16-50-29.png 1200w,\n/static/f66828a2b6e0d00f0c79306eba2a497a/912c7/2020-12-12-16-50-29.png 1228w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>後記</h2>\n<p>這邊初步的體驗 .NET for Apache Spark，雖然小弟沒有對這塊很熟，也只是隨手摸摸，但可以看到在未來 .NET 的發長上，真的可以看見許多東西。</p>\n<h2>參考資料</h2>\n<ul>\n<li><a href=\"https://dotnet.microsoft.com/learn/data/spark-tutorial/intro\">https://dotnet.microsoft.com/learn/data/spark-tutorial/intro</a></li>\n<li><a href=\"https://docs.microsoft.com/zh-tw/dotnet/spark/tutorials/get-started?tabs=windows\">https://docs.microsoft.com/zh-tw/dotnet/spark/tutorials/get-started?tabs=windows</a></li>\n<li><a href=\"https://github.com/dotnet/spark\">https://github.com/dotnet/spark</a></li>\n</ul>","excerpt":"前言 其實，這屬於 Data 部門的事情 \b\b( 無誤 )，但因 .NET Conf 的原因，剛好又沒有人講到 .NET for Apache Spark，而近期，因為有個案子剛好有用到 Data Bricks，所以就舉手說，Keynote 來稍微講講 .NET for…"}},"pageContext":{"type":"posts","next":{"frontmatter":{"path":null,"title":"Azure - AKS - 使用 AAD Pod Identity 進行 Azure 服務驗證","tags":["Azure","Container","Kubernetes","AAD","Linux","AKS","Identity"]},"fields":{"slug":"/2020/11/29/Azure-AKS_AAD_Pod_Identity/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/Azure-AKS_AAD_Pod_Identity/Azure-AKS_AAD_Pod_Identity.md"},"previous":null}}}