{"componentChunkName":"component---src-templates-page-js","path":"/2013/08/22/Windows-Azure-SQL-Server-in-VM的一些注意事項/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Windows Azure -  SQL Server in VM的一些注意事項","date":"22 August 2013","author":"Sky Chang","excerpt":null,"tags":["Azure","SQL Server"],"coverImage":null},"id":"ef8e1049-c783-5214-8ba7-f12b92fd192b","html":"<p>因為在準備投影片，就想說，順便整理整理，提供給大家做一個參考。</p>\n<p>在Azure服務裡面，最簡單的服務，大概就是vm吧，而託Azure的福，原本要跪求IT賜給我們一台測試機，現在我們也可以直接利用Azure的VM來進行測試了，而這邊，就列一下，SQL Server in VM的一些注意事項。</p>\n<p>如下MSDN的截圖，我們要控制SQL Server有兩條入，一條是從上面的遠端桌面，這應該是最簡單不過了，另外一個就是利用SSMS工具。但如同下圖所示，如果要用SSMS，就會有很多紅色驚嘆號；是的，這些東西就是我們今天要告訴大家，要開啟的!!</p>\n<p>( 當然，這內容和自己建立的vm沒甚麼兩樣，差異大概只差在，需要在Azure vm的端點那邊，開啟一下端點，另外，預設會開啟一個比較特殊的port，在SQL Server 2014的時候；port 11435是給SQL Server 2014部屬用的。因為這個東西算是很基本的設定，所以後面的說明，就不會列的很詳細了，請見諒。 )</p>\n<p><img src=\"http://i.msdn.microsoft.com/dynimg/IC670657.gif\" alt=\"存取 Windows Azure 虛擬機器中的 SQL Server\" title=\"存取 Windows Azure 虛擬機器中的 SQL Server\"></p>\n<h4>第一步 使用SQL Server驗證連接到SQL Server</h4>\n<p>是的，我們要先用遠端登入登入SQL Server機器，在利用SSMS連入SQL Server後，要把SQL Server和Windows驗證的混合模式打開。</p>\n<p><a href=\"http://lh3.ggpht.com/-SPrgPgD7g7E/UhYlYhrK-AI/AAAAAAAAHCY/6XuqzlvEHvw/s1600-h/image%25255B12%25255D.png\"><img src=\"http://lh5.ggpht.com/-R-RUtx2NAz8/UhYlZma0bVI/AAAAAAAAHCg/pdpTjvTHfAo/image_thumb%25255B6%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，我們要修改sa的密碼和登入權限，如下圖 ( 請注意，這邊為了解說方便，所以直接打開sa，但真實環境下，請建立新的帳號，並且開啟特定的權限。 )</p>\n<p><a href=\"http://lh3.ggpht.com/-YjB3VA_cJkU/UhYlasWGiTI/AAAAAAAAHCo/BURldOSSDZI/s1600-h/image%25255B17%25255D.png\"><img src=\"http://lh3.ggpht.com/-Wlzp0gOrl7g/UhYlbQ6za8I/AAAAAAAAHCw/LgXZRev2xRY/image_thumb%25255B9%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>設定完成後，記得要去SQL Server Configuration Manager重新啟動一下SQL Server。</p>\n<p><a href=\"http://lh5.ggpht.com/-k4phzO_sTZw/UhYlcQI1siI/AAAAAAAAHC4/ZpEmJAIsOZk/s1600-h/image%25255B22%25255D.png\"><img src=\"http://lh4.ggpht.com/-Trh143LX2Io/UhYldAW9WgI/AAAAAAAAHDA/vMoc6G3zHfA/image_thumb%25255B12%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，我們可以用sa登入試試看。</p>\n<p><a href=\"http://lh6.ggpht.com/-FjoDxO7CIfE/UhYleLjjGhI/AAAAAAAAHDI/ZHPRWKpaLLI/s1600-h/image%25255B27%25255D.png\"><img src=\"http://lh3.ggpht.com/-M_mf3K_wRnA/UhYle0ZFk6I/AAAAAAAAHDQ/2xym08LINnQ/image_thumb%25255B15%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>確定可以登入後，我們就可以進入下一步，開啟TCP/IP。</p>\n<h4>第二步 開啟SQL Server的TCP/IP</h4>\n<p>說到這個，小弟超久超久以前，要連SSMS，一直連不上去，就是因為TCP/IP沒開啟，所以大家記得要開啟，小弟使用SQL Server 2014的樣板，預設是已經開啟了。</p>\n<p><a href=\"http://lh3.ggpht.com/-NxnbSEVmg1w/UhYlfz3hEHI/AAAAAAAAHDY/ZYkyvf9OXIw/s1600-h/image%25255B70%25255D.png\"><img src=\"http://lh3.ggpht.com/-AqFtrPafCZA/UhYlgukygWI/AAAAAAAAHDg/fCjMl8n86Fo/image_thumb%25255B40%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，是要開啟vm上的防火牆。</p>\n<h4>第三步 開啟VM上的防火牆</h4>\n<p>SQL Server預設的Port是1433，所以如果要用SSMS連進來，就要開啟1433的Port ( 如果有要用其他服務，也別忘了要開啟。)</p>\n<p><a href=\"http://lh6.ggpht.com/-VRCMb-QfYG0/UhYlhwCQHxI/AAAAAAAAHDo/LJCmvVYhB1g/s1600-h/image%25255B32%25255D.png\"><img src=\"http://lh6.ggpht.com/-RRRmwU_dQhQ/UhYli1fEfRI/AAAAAAAAHDw/H7oFYOkCa5c/image_thumb%25255B18%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>這邊填入1433。</p>\n<p><a href=\"http://lh4.ggpht.com/-pBH_DLPv3GM/UhYljsYHOUI/AAAAAAAAHD4/l8EMNt7xIKM/s1600-h/image%25255B40%25255D.png\"><img src=\"http://lh3.ggpht.com/-Zgot_lRdA9A/UhYlkTFntrI/AAAAAAAAHEA/NDilVLn7gP4/image_thumb%25255B22%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>後續就照著預設值就可以了。</p>\n<p><a href=\"http://lh3.ggpht.com/-T-4vkqMhagI/UhYllZR7g9I/AAAAAAAAHEI/j9qEe96CRQw/s1600-h/image%25255B45%25255D.png\"><img src=\"http://lh4.ggpht.com/-GOA4gUY-19U/UhYlmEuBQaI/AAAAAAAAHEQ/GQCLFcEHMF0/image_thumb%25255B25%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>如果有特別需求，這邊可以調整，但我想，通常應該不會改變連線才對。</p>\n<p><a href=\"http://lh6.ggpht.com/-i5g9NMp3YH0/UhYlnGbvheI/AAAAAAAAHEY/Pukb9GVLQyc/s1600-h/image%25255B50%25255D.png\"><img src=\"http://lh4.ggpht.com/-mnPKJgwmGzI/UhYlnxM2zRI/AAAAAAAAHEg/ql-aFZ6BeYc/image_thumb%25255B28%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>然後輸入一個可識別的名稱。</p>\n<p><a href=\"http://lh6.ggpht.com/-grGL6heH6kM/UhYlo2lg-BI/AAAAAAAAHEo/pagukMYKX1Y/s1600-h/image%25255B55%25255D.png\"><img src=\"http://lh6.ggpht.com/--SejoCvl1k0/UhYlpde6fhI/AAAAAAAAHEw/9ZOh4L1DYd0/image_thumb%25255B31%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>完成之後就會如下圖，另外，如果眼尖的，會發現預設就有一個SQL Server Cloud Adapter。</p>\n<p><a href=\"http://lh4.ggpht.com/-mpGbkD-_wYQ/UhYlqpsHuwI/AAAAAAAAHE4/599c7E5t5vg/s1600-h/image%25255B60%25255D.png\"><img src=\"http://lh4.ggpht.com/-QVvsrRRLt9I/UhYlrS_odSI/AAAAAAAAHFA/V306xn3GXe4/image_thumb%25255B34%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>他的Port是11435，主要是拿來在SQL Server 2014直接部屬到SQL Server in vm用的，因為小弟是用SQL Server 2014的樣板建立的vm，所以有出現這個，至於2012的樣板會不會有，小弟就不知道了，大家有興趣可以幫小弟試試看XDDD。</p>\n<p><a href=\"http://lh5.ggpht.com/-9p_ZYxM5yb4/UhYlsT618fI/AAAAAAAAHFI/w96jkeCF580/s1600-h/image%25255B65%25255D.png\"><img src=\"http://lh5.ggpht.com/-c5Bc7mtMpVU/UhYltE5-JoI/AAAAAAAAHFQ/vvMtY99cZBs/image_thumb%25255B37%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>到這邊，vm上的設定通通都結束了，接下來要去Windows Azure裡面設定。</p>\n<p>第四步 設定Windows Azure VM的端點</p>\n<p>預設情況下，當我們啟用Windows Azure VM的時候，就可以先選擇要開的端點了，如下圖。</p>\n<p><a href=\"http://lh5.ggpht.com/-4ZoRz11rbxk/UhYluELKf0I/AAAAAAAAHFY/owBq1RbGp8g/s1600-h/image%25255B79%25255D.png\"><img src=\"http://lh6.ggpht.com/-GBzDTw57c8Y/UhYlu_H8m1I/AAAAAAAAHFg/W9rkn6Py9mQ/image_thumb%25255B45%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>如果當時忘記開，也可以自己從這邊打開。</p>\n<p><a href=\"http://lh6.ggpht.com/-Jh1-BXVlYpo/UhYlvshNDlI/AAAAAAAAHFo/o96BOx8gvF8/s1600-h/image%25255B74%25255D.png\"><img src=\"http://lh3.ggpht.com/-O8TUT2IuTpA/UhYlwbVPSCI/AAAAAAAAHFw/0UmEEEDdzI0/image_thumb%25255B42%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>例如下圖，我們要把11435打開，那我們可以如下圖設定；公用連接埠表示的是對外的連接，也就是外面要用11111來連入這台Server，而私用連接埠是內部用的連接，也就是說外面從11111連進來，會對應到內部的11435；這邊建議用不同的Port，才能防止攻擊，另外，也強烈建議，把平常沒用到的端點刪掉，例如Remote Desktop的3389，沒事的時候，就把它刪掉，要用的時候在建立，這樣會安全很多。</p>\n<p><a href=\"http://lh3.ggpht.com/-upsw-q8ArTU/UhYlxHqcUGI/AAAAAAAAHF4/7fcgehDQ8cY/s1600-h/image%25255B84%25255D.png\"><img src=\"http://lh6.ggpht.com/-Lpt6IGlydi8/UhYlx8vQRiI/AAAAAAAAHGA/XCXyb342wMY/image_thumb%25255B48%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>到這邊，我們就結束了所有設定。</p>\n<p>最終步 在Local使用ssms登入</p>\n<p>最後，我們再用SSMS登入就可以了。</p>\n<p><a href=\"http://lh4.ggpht.com/-fmlVwhTKkds/UhYly5HabiI/AAAAAAAAHGI/YeRt-0HSLMM/s1600-h/image%25255B90%25255D.png\"><img src=\"http://lh6.ggpht.com/-qVInj9-uqjI/UhYlzt85e0I/AAAAAAAAHGQ/0TninwV1Uag/image_thumb%25255B52%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>這樣就可以順利連上去了。</p>\n<p>補充</p>\n<p>如果今天Azure的端點不是設定為1433，設定為10000的話，可以在ssms裡的伺服器名稱後面加入小逗點，再加上port，如下圖。</p>\n<p><a href=\"http://lh3.ggpht.com/-u30BOIT5r8g/UhYmMijqyPI/AAAAAAAAHGY/zXX6lD8QOgY/s1600-h/image%25255B95%25255D.png\"><img src=\"http://lh5.ggpht.com/-yR-ptNNF-tc/UhYmNqx0U-I/AAAAAAAAHGg/Pw97tm-BHEE/image_thumb%25255B55%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>這樣就可以簡單的指定Port了。</p>\n<h4>後記</h4>\n<p>其實對於DBA來說，這真的很簡單，但隨著Azure的發展，Developer也可以簡單的建立Azure上的vm拿來測試與支援，相信對於專職於寫Code的朋友們，可能就會四處碰壁了，所以這邊也提供了這些步驟，希望能讓Developer們，使用DB的時候，不會一開始就卡住~~</p>\n<h4>參考資料</h4>\n<ul>\n<li><a href=\"http://blogs.msdn.com/b/windowsazure/archive/2012/07/16/data-series-how-to-setup-sql-server-on-windows-azure-virtual-machines.aspx\" title=\"http://blogs.msdn.com/b/windowsazure/archive/2012/07/16/data-series-how-to-setup-sql-server-on-windows-azure-virtual-machines.aspx\">http://blogs.msdn.com/b/windowsazure/archive/2012/07/16/data-series-how-to-setup-sql-server-on-windows-azure-virtual-machines.aspx</a></li>\n<li><a href=\"http://msdn.microsoft.com/zh-tw/library/windowsazure/dn133152.aspx\" title=\"http://msdn.microsoft.com/zh-tw/library/windowsazure/dn133152.aspx\">http://msdn.microsoft.com/zh-tw/library/windowsazure/dn133152.aspx</a></li>\n</ul>","excerpt":"因為在準備投影片，就想說，順便整理整理，提供給大家做一個參考。 在Azure服務裡面，最簡單的服務，大概就是vm吧，而託Azure的福，原本要跪求IT賜給我們一台測試機，現在我們也可以直接利用Azure的VM來進行測試了，而這邊，就列一下，SQL Server in VM…"}},"pageContext":{"type":"posts","next":{"frontmatter":{"path":null,"title":"Windows Azure -  在Windows Server VM安裝中文語系","tags":["Azure","Windows Server"]},"fields":{"slug":"/2013/08/22/Windows-Azure-在Windows-Server-VM安裝中文語系/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Windows-Azure-在Windows-Server-VM安裝中文語系.md"},"previous":{"frontmatter":{"path":null,"title":"Windows Azure -  使用SQL Server的DAC來輸出資料到Azure的Blob","tags":["Azure","SQL Server"]},"fields":{"slug":"/2013/08/22/Windows-Azure-使用SQL-Server的DAC來輸出資料到Azure的Blob/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Windows-Azure-使用SQL-Server的DAC來輸出資料到Azure的Blob.md"}}}}