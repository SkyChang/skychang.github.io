{"componentChunkName":"component---src-templates-page-js","path":"/2013/08/22/Windows-Azure-使用SQL-Server的DAC來輸出資料到Azure的Blob/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Windows Azure -  使用SQL Server的DAC來輸出資料到Azure的Blob","date":"22 August 2013","author":"Sky Chang","excerpt":null,"tags":["Azure","SQL Server"],"coverImage":null},"id":"43255424-d8c9-58a3-8134-1615882d17fe","html":"<p>隨著時代的進步，Windows Azure的發展，現在Windows Azure和SQL Server的結合越來越緊密，而今天，我們就來看看，透過DAC的機制，來將SQL Server的資料，輸出一份到Azure的Blob，並且在從Azure的Blog佈署回SQL Server。</p>\n<p>但在開始之前，或許大家對於DAC比較不熟，DAC主要是用來封裝資料庫的結構，至於為什麼要這樣呢?因為在正式的環境裡面，一般的開發人員不太可能會碰到正式的DB，而開發人員使用的是測試的DB，正常的情況下，通常是在Local開發，然後在佈署到測試db，但最終怎樣把修改過的結構給DBA呢??結論就是使用DAC，然後DBA拿到封裝包後，在去正式機上佈署。</p>\n<p>而DAC通常有兩種封裝，一種是dacpac和bacpac，dacpac代表的是指封裝結構，而dacpac則會一起封裝資料，這邊使用的會是bacpac，這點大家也要注意一下。</p>\n<h4>從本地資料庫將資料輸出到Azure的Blob備份</h4>\n<p>在開始前，我們要先在Windows Azure那邊，建立一個新的Blob。</p>\n<p><a href=\"http://lh3.ggpht.com/-EU9gvCdoXf0/UhYx7fx3PPI/AAAAAAAAHGw/eOdKOomzySg/s1600-h/image%25255B35%25255D.png\"><img src=\"http://lh5.ggpht.com/-72utnFyIbxY/UhYx8WCRIpI/AAAAAAAAHG4/lIvBJjebfCY/image_thumb%25255B19%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>建立完成後，我們要進入那個Blob，然後建立新的容器；這邊的存取請選擇私用，表示只有此帳號的人可以讀取，才不會資料庫的東西被別人偷走。</p>\n<p><a href=\"http://lh3.ggpht.com/-Urppiry0YCo/UhYx9S6PdyI/AAAAAAAAHHA/hsbVNNuaPT0/s1600-h/image%25255B39%25255D.png\"><img src=\"http://lh5.ggpht.com/-1ZUl17DvpFU/UhYx-H6qI9I/AAAAAAAAHHI/o8SOlNoZBYQ/image_thumb%25255B21%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>容器建立完成後，就可以回到SSMS裡面，而要使用這個功能很簡單，我們只要在想要輸出的資料庫這邊，按下滑鼠右鍵，就可以看到選項如下。</p>\n<p><a href=\"http://lh5.ggpht.com/-mQGdlbd_wKc/UhYx_Ewi2JI/AAAAAAAAHHQ/g8WSBd_qTWY/s1600-h/image%25255B21%25255D.png\"><img src=\"http://lh5.ggpht.com/-Kh3-1hl8BEI/UhYyABjy4II/AAAAAAAAHHY/Lzd2-tYzI_4/image_thumb%25255B11%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，我們可以看到這個簡介，我們可以看到，此精靈會幫我們匯出BACPAC ( 也就是包含資料 )。</p>\n<p><a href=\"http://lh4.ggpht.com/-b7xNbV2djKk/UhYyAzd6bFI/AAAAAAAAHHg/_6GPlt0T9FY/s1600-h/image%25255B26%25255D.png\"><img src=\"http://lh3.ggpht.com/-o5dZvnWLMnQ/UhYyB6VlU2I/AAAAAAAAHHo/cj4VVEa0uI0/image_thumb%25255B14%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，我們要選擇連接，連線Azure的Blob</p>\n<p><a href=\"http://lh6.ggpht.com/-FlrrLIi8x-M/UhYyCpvJ87I/AAAAAAAAHHw/f4mfEyyWMQk/s1600-h/image%25255B31%25255D.png\"><img src=\"http://lh4.ggpht.com/-do6diF7hb2U/UhYyDn4bL2I/AAAAAAAAHH4/0P1G4BGNXY8/image_thumb%25255B17%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>按下去後，會出現一個連接至Windows Azure儲存體的視窗，我們必須回到Windows Azure的Blob取得相關資料；回到Blob的儀表版，下面有一個管理存取金鑰，點下去後，就可得到我們想要的資訊，並且填入到SSMS的對話框中。</p>\n<p><a href=\"http://lh6.ggpht.com/-532J_MOt91A/UhYyEamS_bI/AAAAAAAAHIA/foMroeRTvGQ/s1600-h/image%25255B49%25255D.png\"><img src=\"http://lh4.ggpht.com/-IQvNZb7bgs8/UhYyFaNcGUI/AAAAAAAAHII/zYpllLMf4sw/image_thumb%25255B27%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>如果無誤的話，就可以取得到容器，這邊小弟的容器是亂打的test123。</p>\n<p><a href=\"http://lh5.ggpht.com/-m6HjlrfZgYA/UhYyGYW9wtI/AAAAAAAAHIQ/4RO4AK_Tybk/s1600-h/image%25255B54%25255D.png\"><img src=\"http://lh3.ggpht.com/-aW1Fp1OYgAM/UhYyHai7NbI/AAAAAAAAHIY/368dNsHqkOY/image_thumb%25255B30%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>最後，他會讓我們確認資訊，無誤後，就可以按下完成，開始匯出到Azure的Blob。</p>\n<p><a href=\"http://lh6.ggpht.com/-tYewT1uBzlA/UhYyIBJneZI/AAAAAAAAHIg/JMqHXA9_Gh0/s1600-h/image%25255B59%25255D.png\"><img src=\"http://lh6.ggpht.com/-ruaEneYSogY/UhYyJAQ_feI/AAAAAAAAHIo/kFCptoLl1yQ/image_thumb%25255B33%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>在處理的過程。</p>\n<p><a href=\"http://lh4.ggpht.com/-hutajF_DZ1c/UhYyJ4_uIcI/AAAAAAAAHIw/risFoCONoC4/s1600-h/image%25255B65%25255D.png\"><img src=\"http://lh4.ggpht.com/-nQdMwgdOquE/UhYyKnxHPYI/AAAAAAAAHI4/Bmxr94nU2BU/image_thumb%25255B37%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>當完成後，我們回到Windows Azure的Blob看看，就可以發現到已經傳上去了。( 這邊有兩筆，是因為小弟測試了兩次。 )</p>\n<p><a href=\"http://lh5.ggpht.com/-c86egw-O0bw/UhYyLiOUmtI/AAAAAAAAHJA/eKoyoJ9wCfE/s1600-h/image%25255B69%25255D.png\"><img src=\"http://lh5.ggpht.com/-iBZS3BIuk7M/UhYyMeXN3sI/AAAAAAAAHJI/r3fUxGD4Arg/image_thumb%25255B39%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>這樣就完成了資料的備份。</p>\n<h4>從Azure Blob將資料匯入進來</h4>\n<p>接下來，我們要把剛剛的資料，匯入回本地的資料庫，這次我們選擇匯入資料層應用程式。</p>\n<p><a href=\"http://lh4.ggpht.com/-o9L9JaTlcmc/UhYyNBtpFfI/AAAAAAAAHJQ/ap7Vy0d996Q/s1600-h/image%25255B73%25255D.png\"><img src=\"http://lh3.ggpht.com/-zlS89U8SE90/UhYyN_EtLBI/AAAAAAAAHJY/8MMqg8H7cXw/image_thumb%25255B41%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>可以從這邊看到，我們還是利用BACPAC檔案來進行處理。</p>\n<p><a href=\"http://lh5.ggpht.com/-DXCzIlWBUxk/UhYyOj_Y1bI/AAAAAAAAHJg/fEiEY2TU1V4/s1600-h/image%25255B78%25255D.png\"><img src=\"http://lh3.ggpht.com/-sNxNbdXDc1o/UhYyPr-atnI/AAAAAAAAHJo/HWuXFePnZnI/image_thumb%25255B44%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>這邊的作法其實也都是一樣，所以就不多加解釋了喔~~</p>\n<p><a href=\"http://lh4.ggpht.com/-Htv2EWna5Ag/UhYyQRckQpI/AAAAAAAAHJw/sVjbuDUf4gg/s1600-h/image%25255B83%25255D.png\"><img src=\"http://lh3.ggpht.com/-olAyQAYAjgE/UhYyRcezueI/AAAAAAAAHJ4/dlAp9LfzCBo/image_thumb%25255B47%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>然後可以選擇新的資料庫名稱。</p>\n<p><a href=\"http://lh5.ggpht.com/-4PK95n3kyo4/UhYySPf-p1I/AAAAAAAAHKA/wD62WWTNtMc/s1600-h/image%25255B88%25255D.png\"><img src=\"http://lh6.ggpht.com/-X8-Y0OYgKV0/UhYyTErvAEI/AAAAAAAAHKI/bLijQGlhEW4/image_thumb%25255B50%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>一樣有一些確認的資訊。</p>\n<p><a href=\"http://lh6.ggpht.com/-AJ2uqGrdPGc/UhYyT7ukwCI/AAAAAAAAHKQ/xsE69qhjCBE/s1600-h/image%25255B92%25255D.png\"><img src=\"http://lh3.ggpht.com/-kvGE-u9xH70/UhYyU-dh8hI/AAAAAAAAHKY/Wa9cnixWtfw/image_thumb%25255B52%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，就開始處理了。</p>\n<p><a href=\"http://lh3.ggpht.com/-aG9ppunWlE0/UhYyV2mlgWI/AAAAAAAAHKg/cfklScM-TfU/s1600-h/image%25255B97%25255D.png\"><img src=\"http://lh4.ggpht.com/-aMz5o2VhmwM/UhYyW8V2nAI/AAAAAAAAHKo/QcwjtEfvRX4/image_thumb%25255B55%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>完成之後，就可以發現，我們新的資料庫已經匯入進來了，而且連資料也可以保留喔!!</p>\n<p><a href=\"http://lh4.ggpht.com/-LUK4LSxfI-s/UhYyXhhHuYI/AAAAAAAAHKw/qGYISd37iTM/s1600-h/image%25255B101%25255D.png\"><img src=\"http://lh3.ggpht.com/-m7Bq1oBtsP0/UhYyYmhy8kI/AAAAAAAAHK4/q_iNL0EB7r8/image_thumb%25255B57%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>到這邊，就算完成了。</p>\n<h4>後記</h4>\n<p>現在的東西，和Windows Azure的整合越來越緊密，除了從本地的DB可以透過DAC來將資料往上拋外，可想當然爾，Azure VM裡面的DB當然也是沒問題的，但更讓人震驚的是，Azure SQL Database也可以簡單的輸入與輸出資料到Blob，也讓整個應用更加的串接起來，更加的廣闊了。最後，如果想要手動輸入T-SQL來做的朋友們，也可以參考我好友<a href=\"http://www.dotblogs.com.tw/terrychuang/archive/2013/01/29/89209.aspx\">Terry</a>的連結喔!!~</p>\n<h4>參考資料</h4>\n<ul>\n<li><a href=\"http://technet.microsoft.com/zh-tw/library/ee210546.aspx\" title=\"http://technet.microsoft.com/zh-tw/library/ee210546.aspx\">http://technet.microsoft.com/zh-tw/library/ee210546.aspx</a></li>\n<li><a href=\"http://guruinfocollection.blogspot.tw/2013/04/data-tools-dacpac-bacpac.html\" title=\"http://guruinfocollection.blogspot.tw/2013/04/data-tools-dacpac-bacpac.html\">http://guruinfocollection.blogspot.tw/2013/04/data-tools-dacpac-bacpac.html</a></li>\n<li><a href=\"http://www.dotblogs.com.tw/terrychuang/archive/2013/01/29/89209.aspx\" title=\"http://www.dotblogs.com.tw/terrychuang/archive/2013/01/29/89209.aspx\">http://www.dotblogs.com.tw/terrychuang/archive/2013/01/29/89209.aspx</a></li>\n</ul>","excerpt":"隨著時代的進步，Windows Azure的發展，現在Windows Azure和SQL Server的結合越來越緊密，而今天，我們就來看看，透過DAC的機制，來將SQL Server的資料，輸出一份到Azure的Blob，並且在從Azure的Blog佈署回SQL Server…"}},"pageContext":{"type":"posts","next":{"frontmatter":{"path":null,"title":"Windows Azure -  SQL Server in VM的一些注意事項","tags":["Azure","SQL Server"]},"fields":{"slug":"/2013/08/22/Windows-Azure-SQL-Server-in-VM的一些注意事項/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Windows-Azure-SQL-Server-in-VM的一些注意事項.md"},"previous":{"frontmatter":{"path":null,"title":"Windows Azure -  SQL Database Data Sync","tags":["Azure","SQL Server"]},"fields":{"slug":"/2013/08/23/Windows-Azure-SQL-Database-Data-Sync/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Windows-Azure-SQL-Database-Data-Sync.md"}}}}