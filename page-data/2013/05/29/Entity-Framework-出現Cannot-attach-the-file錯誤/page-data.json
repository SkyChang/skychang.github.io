{"componentChunkName":"component---src-templates-page-js","path":"/2013/05/29/Entity-Framework-出現Cannot-attach-the-file錯誤/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Entity Framework - 出現Cannot attach the file錯誤","date":"29 May 2013","author":"Sky Chang","excerpt":null,"tags":["ASP.NET MVC","Entity Framework","SQL Server"],"coverImage":null},"id":"2d3a4faa-8ee6-5ed5-9ed5-ef4303b3d303","html":"<p>這篇也是小小的紀錄文，稍微紀錄一下。</p>\n<p>最近玩Entity Framework Code First玩得很大，而前一陣子，使用Code First的時候，要更新資料庫，卻出現Cannot attach the file的錯誤。如下圖。</p>\n<p><a href=\"http://lh5.ggpht.com/-aogvdx2ilik/UaYZR7RPNDI/AAAAAAAAGLU/8KM4ui2Px7g/s1600-h/image7.png\"><img src=\"http://lh5.ggpht.com/-smzgLAVpEjI/UaYZS-an6ZI/AAAAAAAAGLc/ZArCTDXpY-k/image_thumb3.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<blockquote>\n<p>Cannot attach the file 'C:\\xxx專案\\bin\\Debug\\xxx.mdf' as database 'xxxdb'. </p>\n</blockquote>\n<p>其實Cannot attach the file的錯誤，有滿多種可能的，但這邊的情況主要是因為如下；這是這次發生問題的專案結構，小弟有分為主要的MVC專案和專門管Model的Model專案，而問題，主要是Web.config和App.config這邊。</p>\n<p><a href=\"http://lh6.ggpht.com/-qoOZuc-_YSI/UaYZTrFZwyI/AAAAAAAAGLk/ypYhukdTLLk/s1600-h/image%25255B4%25255D.png\"><img src=\"http://lh4.ggpht.com/-4K-a9pNn00U/UaYZUoGHWLI/AAAAAAAAGLs/FqdriAk250w/image_thumb%25255B2%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>好的，那為什麼會發生這個問題呢!!?其實很簡單，那是因為路徑上的問題與錯誤。</p>\n<p>我們先用SSMS來看一下真正的mdf檔案在哪邊；當然，很對不起，很多東西都被反白掉了，但如果仔細看，我們可以發現mdf檔案和ldf檔案都在App_Data底下。</p>\n<p><a href=\"http://lh3.ggpht.com/-E3ali-XFcKc/UaYZVQDPU4I/AAAAAAAAGL0/Rutzjb2kOUY/s1600-h/image%25255B9%25255D.png\"><img src=\"http://lh5.ggpht.com/-kTEvSfxhhYo/UaYZV-SvO_I/AAAAAAAAGL8/F5blmwg0aYs/image_thumb%25255B5%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，我們回頭看看MVC專案底下的Web.Config；是的，connectionString裡面的AttachDbFilename參數，指向的檔案位置是DataDirectory，其實這就是代表著指著專案底下的App<em>Data目錄；以上面的例子來說，就是MVC專案底下的App</em>Data目錄。</p>\n<p><a href=\"http://lh4.ggpht.com/-Yc1zFAWCgrc/UaYZWvoTw_I/AAAAAAAAGME/feDs5QLZ57c/s1600-h/image%25255B13%25255D.png\"><img src=\"http://lh3.ggpht.com/-PkRroUECtmg/UaYZXQOjbsI/AAAAAAAAGMM/s3iumO6-juQ/image_thumb%25255B7%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>但實際上，當我們下達Updata-database指令的時候，卻是針對Model專案，如下圖。</p>\n<p><a href=\"http://lh4.ggpht.com/-_AAp9UEnO-w/UaYZYCspIpI/AAAAAAAAGMU/GIh9Y9DDwsE/s1600-h/image%25255B17%25255D.png\"><img src=\"http://lh4.ggpht.com/-HCxUbp4eoWk/UaYZY7s2r5I/AAAAAAAAGMc/-0Zs_Mthbbo/image_thumb%25255B9%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>那我們看一下Model底下的App.config，可以發現，也有AttachDbFilename的參數，而且也是指向著App<em>Data目錄，但其實我們真正的資料庫卻是在MVC專案的App</em>Data目錄阿!!</p>\n<p>是的，所以當Updata-Database的時候，就會發生這種錯誤，因為資料庫的檔案，實際上根本就不存在Model專案的App_Data目錄下~~</p>\n<p>所以解決的方式很簡單，我們只要把Model專案的App.config的ConnectionString的AttachDbFilename拿掉，就可以了，如下圖。</p>\n<p><a href=\"http://lh6.ggpht.com/-W7P8cYAJfa0/UaYZZjtpoDI/AAAAAAAAGMk/VfT_Mz2p3-w/s1600-h/image%25255B21%25255D.png\"><img src=\"http://lh6.ggpht.com/-OiAm48SkzWA/UaYZaUTunfI/AAAAAAAAGMs/6cYCXbIdK2A/image_thumb%25255B11%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>這樣在一次的updata-database就不會有問題了。</p>","excerpt":"這篇也是小小的紀錄文，稍微紀錄一下。 最近玩Entity Framework Code First玩得很大，而前一陣子，使用Code First的時候，要更新資料庫，卻出現Cannot attach the file的錯誤。如下圖。 image Cannot attach the…"}},"pageContext":{"type":"posts","next":{"frontmatter":{"path":null,"title":"ASP.NET MVC -  HTTP 錯誤 401.2 - Unauthorized","tags":["ASP.NET MVC","IIS","Visual Studio"]},"fields":{"slug":"/2013/04/30/ASP-NET-MVC-HTTP-錯誤-401-2-Unauthorized/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/ASP-NET-MVC-HTTP-錯誤-401-2-Unauthorized.md"},"previous":{"frontmatter":{"path":null,"title":"Visual Studio - 使用不同身分開啟VS2012","tags":["Visual Studio"]},"fields":{"slug":"/2013/05/29/Visual-Studio-使用不同身分開啟VS2012/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Visual-Studio-使用不同身分開啟VS2012.md"}}}}