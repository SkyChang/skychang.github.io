{"componentChunkName":"component---src-templates-page-js","path":"/2013/07/01/ASP-NET-MVC-OData與JayData找不到導覽屬性的原因/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"ASP.NET MVC -  OData與JayData找不到導覽屬性的原因","date":"01 July 2013","author":"Sky Chang","excerpt":null,"tags":["ASP.NET MVC","JavaScript","JayData","OData"],"coverImage":null},"id":"2cf8e531-3ca8-50cb-83aa-520d1ea38ab3","html":"<p>這篇是比較複雜的整合後產生的問題，關於ODtat和Web Api還有JayData的關係，近期會再有文章來補充。</p>\n<p>最近花了一些時間查了這個問題，所以在這邊紀錄一下；這個問題主要是當我們使用EF進行多對多，或是1對多的時候產生的問題 ( 其實也不算是問題，主要還是因為Web API暫時不支援，但官方已經開始在撰寫了 )；問題主要如下。</p>\n<p>我們都知道，使用OData可以輕易的透過網址取得想要的資訊，例如取得Customer，但如果今天Customer和Order有關聯，而且一個Customer會有多個Order時 ( 也就是1對多關係 )，那OData還有一個$Expand的語法可以用 ( 題外話，多對多也適用… )。</p>\n<p>而JayData官方的寫法如下，假設這個範例是DigitalArchives和SubCategory有關係，而且是多對多的關係，我們可以利用JayData來幫忙查詢。</p>\n<pre class=\"brush: js;\">$data.initService('/OData', function (dbFactory) {\n    var mydatabase = dbFactory();\n    mydatabase.DigitalArchives.include(\"SubCategory\")\n        .filter(\"it.ID == 1\")\n        .forEach(function (c) {\n            //do something\n        })\n});\n</pre>\n<p>而我們啟動瀏覽器，就可以看到，他會把上面的語法轉換成OData網址，並使用$Expand來includ相關聯的物件。</p>\n<p><a href=\"http://lh3.ggpht.com/-63WMs8iCGfI/UdFVomTTWzI/AAAAAAAAGgE/l_9qtUTklbs/s1600-h/image%25255B8%25255D.png\"><img src=\"http://lh3.ggpht.com/-W4kSdb8FR5g/UdFVpi8f6dI/AAAAAAAAGgM/dDMQ9fNxZ7w/image_thumb%25255B4%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>如果實際去看這個網址吐出來的東西，是找不到inclde的SubCategory屬性的。</p>\n<p><a href=\"http://lh6.ggpht.com/-nrt2U5zqfKQ/UdFVsZTDFzI/AAAAAAAAGgc/NEEfY7rFHDQ/s1600-h/image%25255B9%25255D.png\"><img src=\"http://lh6.ggpht.com/-Jg3qXIC7SOs/UdFVtWW7K7I/AAAAAAAAGgk/SDCZn0FkJUg/image_thumb%25255B5%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>會這樣的原因，是因為OData 3.0開始，為了讓OData傳輸的資料輕量，所以不會主動地把關聯的導覽屬性加進來，而要使用$Expand的方式，而目前Web Api還不支援$Expand( 官方已經在開始處理了 )。</p>\n<p>而這邊也給大家看一下，如果是2.0版本，會出現怎樣的效果。如果想看舊版的，可以在輸入Content-Type: application/json;odata=verbose，呈現的效果如下。( 使用Fiddler2對<a href=\"http://localhost:2261/OData/DigitalArchives(1)\">http://localhost:2261/OData/DigitalArchives(1</a>偵錯。)</p>\n<p><a href=\"http://lh5.ggpht.com/--mfH4ijbUI0/UdFVuaAaYQI/AAAAAAAAGgs/7SMDia7tEbE/s1600-h/image%25255B14%25255D.png\"><img src=\"http://lh4.ggpht.com/-1WgovxRbAsk/UdFVvnSYQkI/AAAAAAAAGg0/ZM0BWkzY36o/image_thumb%25255B8%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>反正不管怎樣，就是因為Web API不支援…</p>\n<p>所以該如何做呢??基本上，小弟目前只想到兩個方法，第一個是用OData Action，自己定義一個Action，但目前Action沒辦法傳回Collection，只能傳會Array…</p>\n<p>第二個方法，就是使用如上圖的網址，但小弟目前也找不到JayData產生如上圖網址的方法，所以只能用Ajax去呼叫上面網址，取得JSON後再去處理。( Web Api 要另外撰寫方法。 )</p>\n<p>總之，最後的結論，只能用第二種方式暫時的解，等Web Api更新。大體上是這樣了~</p>\n<p>參考資料</p>\n<ul>\n<li><a href=\"http://www.asp.net/web-api/overview/odata-support-in-aspnet-web-api/getting-started-with-odata-in-web-api/explore-the-odata-endpoint\" title=\"http://www.asp.net/web-api/overview/odata-support-in-aspnet-web-api/getting-started-with-odata-in-web-api/explore-the-odata-endpoint\">http://www.asp.net/web-api/overview/odata-support-in-aspnet-web-api/getting-started-with-odata-in-web-api/explore-the-odata-endpoint</a></li>\n<li><a href=\"https://aspnetwebstack.codeplex.com/workitem/1074\" title=\"https://aspnetwebstack.codeplex.com/workitem/1074\">https://aspnetwebstack.codeplex.com/workitem/1074</a></li>\n<li><a href=\"http://stackoverflow.com/questions/16455501/why-doesnt-my-odata-response-have-navigation-properties\" title=\"http://stackoverflow.com/questions/16455501/why-doesnt-my-odata-response-have-navigation-properties\">http://stackoverflow.com/questions/16455501/why-doesnt-my-odata-response-have-navigation-properties</a></li>\n<li><a href=\"http://stackoverflow.com/questions/13998133/asp-net-webapi-odata-with-datajs-throws-an-error\" title=\"http://stackoverflow.com/questions/13998133/asp-net-webapi-odata-with-datajs-throws-an-error\">http://stackoverflow.com/questions/13998133/asp-net-webapi-odata-with-datajs-throws-an-error</a></li>\n<li><a href=\"http://stackoverflow.com/questions/17154475/net-webapi-odata-actions-that-return-an-queryable\" title=\"http://stackoverflow.com/questions/17154475/net-webapi-odata-actions-that-return-an-queryable\">http://stackoverflow.com/questions/17154475/net-webapi-odata-actions-that-return-an-queryable</a></li>\n<li><a href=\"http://stackoverflow.com/questions/16887105/webapi-odata-service-adding-foreignkey\" title=\"http://stackoverflow.com/questions/16887105/webapi-odata-service-adding-foreignkey\">http://stackoverflow.com/questions/16887105/webapi-odata-service-adding-foreignkey</a></li>\n<li>*</li>\n</ul>","excerpt":"這篇是比較複雜的整合後產生的問題，關於ODtat和Web Api還有JayData的關係，近期會再有文章來補充。 最近花了一些時間查了這個問題，所以在這邊紀錄一下；這個問題主要是當我們使用EF進行多對多，或是1對多的時候產生的問題 ( 其實也不算是問題，主要還是因為Web API…"}},"pageContext":{"type":"posts","next":{"frontmatter":{"path":null,"title":"紀錄文 - Visual Studio 2013 Preview 的新功能 - 版本控制篇","tags":["Git","TFS","Visual Studio"]},"fields":{"slug":"/2013/07/01/紀錄文-Visual-Studio-2013-Preview-的新功能-版本控制篇/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/紀錄文-Visual-Studio-2013-Preview-的新功能-版本控制篇.md"},"previous":{"frontmatter":{"path":null,"title":"Visual Studio -  利用Team Foundation Service當代理伺服器進行負載測試","tags":["TFS","Tools","Visual Studio"]},"fields":{"slug":"/2013/07/02/Visual-Studio-利用Team-Foundation-Service當代理伺服器進行負載測試/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Visual-Studio-利用Team-Foundation-Service當代理伺服器進行負載測試.md"}}}}