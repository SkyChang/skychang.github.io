{"componentChunkName":"component---src-templates-page-js","path":"/2019/03/26/Azure-DevOps-Load_Test_Web_App_TLS_Error/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Azure DevOps - 對 Web App 使用壓力測試時發生錯誤","date":"26 March 2019","author":"Sky Chang","excerpt":null,"tags":["Azure","AzureDevOps","DevOps","TFS","LoadTest"],"coverImage":null},"id":"47a6943a-1aed-56be-a8e8-1fb9602fbdd1","html":"<h2>不重要的碎碎念</h2>\n<p>幾百年沒寫 Blog 了，上一篇文章已經一年前了 ( 遮臉 )，而沒寫文章的時間也收到很多 Fans (!?) 的鼓勵，都在詢問為啥沒更新 XDDD，但真的沒辦法，工作太忙了，也請大家多喔見諒 ( 好啦，是我偷懶... )</p>\n<p>而最近因答應了某人，所以打算又開始執筆來寫一些東西，於是就誕生了這篇....</p>\n<h2>問題</h2>\n<p>這幾天因為專案需求，需要在 Azure App Service 的 Web App 使用 VS Load Test 測試一些東西：尤其是這幾天，每天都下雨的情況下，只好拿壓力測試工具來出氣，當興高采烈地按下去，然後悠哉地去泡一杯紅茶加牛奶，回來一看。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cc0cb67d277481d78cfe3f5968be1b9a/adc5a/01.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABeUlEQVQoz4WSTU7EMAyFexBYMNPGTpM002m7APE3YsSKJRKcgktw8IedpNMgIbF4ivPjLy+Om3Y+IdydYcMBTARmm2RtFv8nZoQwYJ5nGQOa67cvXH1+42Z8ALU7kMCMYTks8J5BOhZREVv+HbOBIRWhicFjmUaYrkPbdgIjdJ0pomr8a73ey2uNujHElwMZWBJMXmuLLhCzxaQ5RQmorlZtQCP1dHAc4Clg4KwUq4wTecQyj+QxWd23aLrq5gQVoLr2Uo9JanTkrDGNBlEl69HmcRAFkdd6ivOmhpHAvPO5lsltVnqu7JGURn+VtBs0LnNTTFjbb8D9vkUv3357ekIcYjqUS5Ev02RNIObUVt4H2N6hFwNO1Evsvd+AOwEOcuj1+SQ9tcghd6lrci9ATUofIbGTOPWsXKJATu1GFXDXSmM6nF/ucTiM6Sk10JQnr25U6tgWYF8uqJ7cSWEtHpcRUYCavALX1tGyvM9HfCwTDPfJpYJc9ewfBthE4U/bQ44AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"01\"\n        title=\"01\"\n        src=\"/static/cc0cb67d277481d78cfe3f5968be1b9a/78d47/01.png\"\n        srcset=\"/static/cc0cb67d277481d78cfe3f5968be1b9a/56d15/01.png 200w,\n/static/cc0cb67d277481d78cfe3f5968be1b9a/d9f49/01.png 400w,\n/static/cc0cb67d277481d78cfe3f5968be1b9a/78d47/01.png 800w,\n/static/cc0cb67d277481d78cfe3f5968be1b9a/adc5a/01.png 1068w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>好吧，沒有吐血，也把紅茶和牛奶吐出來了，是的，竟然打了 36649 的 request，然後也錯了 36649 的 request，完全的 100%...原本是想拿來當出氣工具，結果壓力全部跑回到自己身上...</p>\n<p>既然都錯了，而且打了兩三次都是同樣結果，那身為工程屍，只能去找錯了。</p>\n<p>所以第一步當然就是點開錯誤資訊看一下</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/15aee6b5b7bffbc090fa6e07e3d38184/97810/02.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABWUlEQVQoz4WRW0/CQBCF+1OEXqAX2lJL24BCTNBCKSGgCCZqaLctGI3x/78cZ1tQSQw8fDm7O5mzZzJC23ag2AEkw4F3fYMkSZCmjEj3ysBYRjBsNklZ/w9eC8MIgm3ZUCQJMtFxXUwmMaJogrtRhHEUI55OEcdTDIe36PcHJ/G8AIKu6RBFGZIko9lUodGdq6pWylGURlnnegrDMCGIIqWTlbJBVTWYpoVWy4RFyblyDKMFXTfOYpo2BG50MOTpuBE3te1KDx9w03Pw3iPDalTtaPRGQz07qrynHPlgWK+L8IIAeZGjILI8Ixi2u20Jy2jjLKVt/yFLkdH7lrRgCUZhWBkqZHhRq2HUGyB5/cLT+g3zRYFolmO5+sDL8yfWqx2WDwVWyy0e99wvcoxnGdrzd3QIZxD/JuTLcSnyldtF4PjwS4KKtl8S0LnC/9EOoV12Ybg9WHT+Bv+LL71/1zZeAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"02\"\n        title=\"02\"\n        src=\"/static/15aee6b5b7bffbc090fa6e07e3d38184/78d47/02.png\"\n        srcset=\"/static/15aee6b5b7bffbc090fa6e07e3d38184/56d15/02.png 200w,\n/static/15aee6b5b7bffbc090fa6e07e3d38184/d9f49/02.png 400w,\n/static/15aee6b5b7bffbc090fa6e07e3d38184/78d47/02.png 800w,\n/static/15aee6b5b7bffbc090fa6e07e3d38184/97810/02.png 1089w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>所以找到了第一個關鍵，An existing connection was forcibly closed by the remote host\t。</p>\n<p>啥，被中斷了，第一個想到的是，會不會是 Web App 爆了，實際點進去看，並且查看 Web App 的 CPU 等狀況：嗯，這根本不是好不好，而是根本沒打進去!!</p>\n<p>好啦，也合理，因為正常情況下，應該也會打幾個成功的進去啊！！！！！</p>\n<p>然後再去 Detail 檢查，也不是 500 錯誤，所以真的也沒進去。</p>\n<p>好吧，既然如此，就去問一下 google 大神，看看是什麼問題....</p>\n<h2>解決方案</h2>\n<p>當然，歷經多年沒寫文章，這篇是小品，所以就直接講答案，其實查閱的結果，這就是個 bug，未來應該也是會修啦，有興趣的可以直接<a href=\"https://developercommunity.visualstudio.com/content/problem/326207/vsts-load-test-fails.html\">參考這篇</a>。</p>\n<p>而這篇的內容主要就是在說，因為現在 Web App 預設會使用 TLS 1.2，而這會影響到壓測工具，但文章沒詳細敘述原因就是了，而暫時解的方法，大概這幾種，然後就開始吵，這個到底算不算 Bug....</p>\n<ol>\n<li>使用 Plung 掛上 TLS 1.2 的支援</li>\n<li>關閉 Https only，然後打 Http</li>\n<li>將 TLS 1.2 降到 1.0</li>\n</ol>\n<p>1 的方案小弟沒試過，因為想說未來應該會自己改完這 Bug XDD\n2 的方案不是很喜歡，因為打到 http 會在從新導向到 https..\n3 至少對我來說，是可以接受的暫時解，所以小弟就選擇 3 來處理此問題。</p>\n<p>想要修改的，可以到 Web App 的 SSL settings 進行設定，像下圖，我就把原本的 TLS 1.2 改成 1.0\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0dcc77c067f5a9aaed312de6c80af357/2ba58/03.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 56.49999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABt0lEQVQoz4VT23KbMBTkvTPmjkACIWHEzcaE1plOmzSZ+qX9gT71h/rX2yM5yXjSuHnYkTigXe2eg9eMNUopoZXCuq6o6xqbzQZRFCIMg1cIqR65d9fgiTKDlCWSJEWe5yh4CVlrFEK6Pcs5sixHkjLE9E0cR4T4af0XHi8lVK3cR0EQ0MEMjekQZxxRJmgVSJhFRYTs4pZvw9Nti3EcwDmH7/tIswz33x7QDz3mw0z1HKH/gYToVknyInwNXtd3aIm0qir4VOgFx+exx41psWwbfNwf8fX7byytwdpQFCScEPE1eLWqYIxxpCljmIlwlQp7wbCMt3j89QfL/IixVJhz5kStNWv9LXiVKLDdblGW5ZNKhOlQQUkBbWZUh59nOxSH/w6cZd0NaHTjVIMgpAwj3P9QmHYTuq4FS3yXL+cCrOBg5OIZGeV9+eya8uXhDqfTCcuyYLfbEdEex9s7TNNIzRoxjBOGYYAhYamNy9pC0uxaV897C0vqKV07IptjQXPICOunI5rmfGs75NaOPai1dnUhhOu2XS8tuwwb6qZlt0Odpqn7I3hRvKjaQ5b4PMxn/G8O/wIRUB8TimuNhwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"03\"\n        title=\"03\"\n        src=\"/static/0dcc77c067f5a9aaed312de6c80af357/78d47/03.png\"\n        srcset=\"/static/0dcc77c067f5a9aaed312de6c80af357/56d15/03.png 200w,\n/static/0dcc77c067f5a9aaed312de6c80af357/d9f49/03.png 400w,\n/static/0dcc77c067f5a9aaed312de6c80af357/78d47/03.png 800w,\n/static/0dcc77c067f5a9aaed312de6c80af357/2ba58/03.png 1187w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>完成之後，再重新打一次，就可以享受喝奶茶的樂趣了 (誤)</p>\n<h2>後記</h2>\n<p>好吧，我不確定未來會不會修復此問題，如果未來還是沒修復，小弟可能會在想怎麼解決吧....</p>\n<h2>參考資料</h2>\n<ul>\n<li><a href=\"https://developercommunity.visualstudio.com/content/problem/326207/vsts-load-test-fails.html\">https://developercommunity.visualstudio.com/content/problem/326207/vsts-load-test-fails.html</a></li>\n</ul>","excerpt":"不重要的碎碎念 幾百年沒寫 Blog 了，上一篇文章已經一年前了 ( 遮臉 )，而沒寫文章的時間也收到很多 Fans (!?) 的鼓勵，都在詢問為啥沒更新 XDDD…"}},"pageContext":{"type":"posts","next":{"frontmatter":{"path":"/hello","title":"Hello Friend","tags":["rob____ot","hello friend"]},"fields":{"slug":"/hello"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/hello.md"},"previous":{"frontmatter":{"path":null,"title":"Docker - 在 Windows 10 底下不使用 Hyper-V 安裝 Docker","tags":["Docker","Container","Windows"]},"fields":{"slug":"/2019/03/30/Docker-Install_Docker_Without_HyperV_In_Windows_10/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/Docker-Install_Docker_Without_HyperV_In_Windows_10/Docker-Install_Docker_Without_HyperV_In_Windows_10.md"}}}}