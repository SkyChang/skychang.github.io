{"componentChunkName":"component---src-templates-page-js","path":"/2015/07/29/Azure-Use_DNS_Service/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Azure - 使用 Azure DNS Service","date":"29 July 2015","author":"Sky Chang","excerpt":null,"tags":["Azure","DNS"],"coverImage":null},"id":"187a1cdf-8e46-55df-914d-3fa8c94c11ad","html":"<h2>前言</h2>\n<p>很久很久以前，有了一個雲端服務，叫做 Azure ，但這個雲端服務在強大，卻還是少了一個關鍵的東西，那就是 DNS Service ，而在今年，這個東西終於出現了!! ( 不過目前還沒有UI介面就是了= =..)\n但不管怎樣，有了 DNS Service 後，終於可以把 VM 扔掉了~~</p>\n<p>這篇基本上是照著<a href=\"https://azure.microsoft.com/zh-tw/documentation/articles/dns-getstarted-create-dnszone/\">官方文件</a>進行操作，再補上自己的理解，有興趣的朋友，也可以直接參考原文。</p>\n<h2>設定 Azure DNS PowerShell</h2>\n<p>如官方文件一開始，因為我們目前沒有 UI ，所以只能透過 PowerShell 來進行管理，所以首先，我們必須先設定 PowerShell，我們可以先用以下指令切換到 ARM 模式。\n( ARM 模式 是新一代的 Azure 資源管理方案 )</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Switch-AzureMode -Name AzureResourceManager</code></pre></div>\n<p>完成後就會如下圖。</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c53ec942f99100d5134503931d1af1c5/8c258/01.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 35%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAA7EAAAOxAGVKw4bAAABTElEQVQoz6WQTUsCURSGrzqWSRlUCyslypk7amQUgh+DYkYhmfYxOobZIrCCfkWLqP/RIkgbgsgmoVaj06rf9HZnRnLTzsXDeeGF59x7iNo10O7oULUeHl91tN4NRh9trQ/1w8CzZuCl+23R6vTQetP/eBpg5gf1C5/6D4iYv4aQuQLNXiKYOMNcrAZfpI6ZtQb8m+fwRevwrp5iPFwHCRyCLB7YmDl4ZLMkg8zuYbtxAxLbKiIp5ZCS0sjmJGzEc4xdxJMFJFIFhNfz8Cyn4RMlTPIZTAkZTLM8IezAwdfgFBS4xROQhTJKF/cg3mgVJMQ2rMj2FMx5DMIP4WgFY6IMF+s4KsNNzVxhQsWCo0w4X8Z+8w6EowoTKHAOSkdIsTYPsfv/cPBVq3fR2lDotoTVkXAJTOgvoWgKvRHzyewOI+CJsC8H2A2bt/gFBUb3Rf1ldbQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"01\"\n        title=\"01\"\n        src=\"/static/c53ec942f99100d5134503931d1af1c5/78d47/01.png\"\n        srcset=\"/static/c53ec942f99100d5134503931d1af1c5/56d15/01.png 200w,\n/static/c53ec942f99100d5134503931d1af1c5/d9f49/01.png 400w,\n/static/c53ec942f99100d5134503931d1af1c5/78d47/01.png 800w,\n/static/c53ec942f99100d5134503931d1af1c5/8c258/01.png 963w\"\n        sizes=\"(max-width: 800px) 100vw, 800px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>眼尖的大家，應該會發現，為啥會出現這個警告!!</p>\n<p>The Switch-AzureMode cmdlet is deprecated and will be removed in a future release.</p>\n<p>是的，我們上面的這個指令，微軟預計在 2015年 9月 就會移除!!\n大家第一個直覺一定是..搞屁阿..那我未來該怎麼辦??\n有興趣的朋友可以參考<a href=\"https://github.com/Azure/azure-powershell/issues/428\">這篇</a>，這篇是微軟未來的規劃路線。\n簡單的說，就是未來不會有 Switch-AzureMode 這個指令了，會變成，以前的 ASM指令，會在前面加上前贅詞，例如 New-AsmVM ，而 ARM 的指令則不變...</p>\n<p>接下來，我們就可以登入帳號。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Add-AzureAccount</code></pre></div>\n<p>會很佛心地跳出一個視窗讓我們輸入帳號密碼~</p>\n<p><a href=\"02.png\"></a></p>\n<p>接著，因為每個帳號可能會有多個訂閱，所以這邊要選擇你要管理的訂閱。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Select-AzureSubscription -SubscriptionName &quot;MySubscription&quot;</code></pre></div>\n<p><a href=\"03.png\"></a></p>\n<p>接著，你可以建立一個新的資源群組，如下指令，資源群組的名稱為 MyAzureResourceGroup，位置在美西。\n當然你也可以用現有的資源群組，小弟這邊就使用 Study4 的資源群組，所以就不建立新的了。\n( 資源群組是為了讓你管理 Azure 資源的一個策略群組，你建立的 DNS 並不會被限制在你資源群組的地區，例如下面的資源群組是美西，但你的 DNS 還是可以服務全球。)</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">New-AzureResourceGroup -Name MyAzureResourceGroup -location &quot;West US&quot;</code></pre></div>\n<p>Azure DNS 服務目前是由 Microsoft.Network 來提供，所以 Azure 訂用帳戶必須註冊這個 Provider，這樣才能使用 DNS 。\n( 基本上這個只需要註冊一次即可 )</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Register-AzureProvider -ProviderNamespace Microsoft.Network</code></pre></div>\n<p><a href=\"04.png\"></a></p>\n<p>到這邊， PowerShell 就已經這定完成了!!</p>\n<h2>建立 DNS 區域</h2>\n<p>接下來，我們就可以掏錢來建立一個 DNS 區域了，我們可以輸入以下指令，建立一個 study4.tw 的區域，並且設定在 study4 的資源群組裡面。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">New-AzureDnsZone -Name study4.tw -ResourceGroupName study4</code></pre></div>\n<p><a href=\"05.png\"></a></p>\n<p>完成之後，我們可以用以下指令來查看，通常建立完成之後，就會有 SOA 與 NS。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Get-AzureDnsRecordSet -ZoneName study4.tw -ResourceGroupName study4</code></pre></div>\n<p><a href=\"06.png\"></a></p>\n<h2>設定父層的委派</h2>\n<p>簡單的說，以 Study4.tw 來說，要查到這個網址，會先從根開始查起，接下來會查到 tw 的 dns server，再從 tw Dns Server 查到 Study4.tw 的 DNS Server；我們剛剛已經建立了 Study4.tw 的 DNS Service，接下來，我們就要去父層那邊設定，告訴父層如果你要找 study4.tw ，應該要去哪個地方找相關的資訊。</p>\n<p>我們這邊可以從剛剛下的 Get-AzureDnsRecordSet 指令查到 NS 的資訊，或使用底下的指令。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Get-AzureDnsRecordSet -Name &quot;@&quot; -RecordType NS -zonename &quot;study4.tw&quot; -ResourceGroupName &quot;study4&quot;</code></pre></div>\n<p>裡面就會顯示 Microsoft 提供的節點。</p>\n<p>以小弟這邊來說，就會得到好幾台的節點，例如 :  ns3-02.azure-dns.org</p>\n<p>然後，我們就可以使用 ping 等工具，查到這台的 ip 位置，最後，我們就可以去父層做設定，如下圖，以 pchome 為案例，當然，你必須在 pchome 買網址，才能在 pchome 設定，如果你不是在 pchome 買的，就請到你購買網址的地方進行設定。</p>\n<p><a href=\"07.png\"></a></p>\n<p>完成後，( 最久會需要等 24hr )，我們就可以透過底下指令來進行測試。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">nslookup –type=SOA study4.tw</code></pre></div>\n<h2>設定紀錄</h2>\n<p>既然上面都準備好了，我們也可以查到 study4.tw 這個網域要去哪台 DNS Server 查詢了，接下來，我們的目標是希望 www.study4.tw 能對應到某台 web server ，而那台 web server 有獨立的 ip 位置，所以最後的步驟，當然就是要讓 www.study4.tw 能對應到相對的 ip 位置，也就是說，我們要在 DNS Service 上面加上 www ，來讓 DNS Service 能認得我們的 www ip位置，所以我們最後步驟，就把 www 加上去，就完工了!!</p>\n<p>首先，我們可以下以下指令，來建立一個變數。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">$rs = New-AzureDnsRecordSet -Name &quot;www&quot; -RecordType &quot;A&quot; -ZoneName &quot;study4.tw&quot; -ResourceGroupName &quot;study4&quot; -Ttl 60</code></pre></div>\n<p>接下來，我們就可以 add 剛剛的變數，並且加上對應的 ip 位置。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Add-AzureDnsRecordConfig -RecordSet $rs -Ipv4Address 134.170.185.46</code></pre></div>\n<p>完成之後，還要用 set 來通知 Azure DNS 更新。</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Set-AzureDnsRecordSet -RecordSet $rs</code></pre></div>\n<p>最後，我們就可以透過 Get 來查詢，看看是否完成嚕!~</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">Get-AzureDnsRecordSet –Name www –RecordType A -ZoneName study4.tw -ResourceGroupName study4</code></pre></div>\n<p>基本上就這樣，完成嚕!~</p>\n<h2>參考資料</h2>\n<ul>\n<li><a href=\"https://azure.microsoft.com/zh-tw/documentation/articles/dns-getstarted-create-dnszone/\">https://azure.microsoft.com/zh-tw/documentation/articles/dns-getstarted-create-dnszone/</a></li>\n<li><a href=\"https://github.com/Azure/azure-powershell/issues/428\">https://github.com/Azure/azure-powershell/issues/428</a></li>\n<li><a href=\"https://msdn.microsoft.com/en-us/library/mt163762.aspx\">https://msdn.microsoft.com/en-us/library/mt163762.aspx</a></li>\n</ul>","excerpt":"前言 很久很久以前，有了一個雲端服務，叫做 Azure ，但這個雲端服務在強大，卻還是少了一個關鍵的東西，那就是 DNS Service ，而在今年，這個東西終於出現了!! ( 不過目前還沒有UI介面就是了= =..)\n但不管怎樣，有了 DNS Service…"}},"pageContext":{"type":"posts","next":{"frontmatter":{"path":null,"title":"2015 軟體研發高峰會","tags":["Scrum","Sky的IT碎碎念","Visual Studio"]},"fields":{"slug":"/2015/03/21/2015-軟體研發高峰會/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/2015-軟體研發高峰會.md"},"previous":{"frontmatter":{"path":null,"title":"Azure上的Ubuntu與遠端桌面管理 VNC","tags":["Azure","Linux","Ubuntu","VM"]},"fields":{"slug":"/2015/07/30/Azure上的Ubuntu與遠端桌面管理-VNC/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Azure上的Ubuntu與遠端桌面管理-VNC.md"}}}}