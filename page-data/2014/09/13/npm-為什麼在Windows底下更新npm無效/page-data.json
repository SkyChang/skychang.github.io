{"componentChunkName":"component---src-templates-page-js","path":"/2014/09/13/npm-為什麼在Windows底下更新npm無效/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"npm -  為什麼在Windows底下更新npm無效","date":"13 September 2014","author":"Sky Chang","excerpt":null,"tags":["Node.js","npm"],"coverImage":null},"id":"1886e0f6-529e-51ad-9a0a-6012f6cf8c7a","html":"<p>這篇談論的是在Windows底下，使用Node.js msi檔安裝Node.js後，輸入npm update npm –g 無法更新的原因與解決方案 ( 其實也沒有解決方案啦… )</p>\n<p>透過Node.js的msi安裝的npm，是無法透過npm update npm -g來更新npm版本的，按下去是沒有反應的…那是因為用msi安裝的npm，預設是放在Program Files\\nodejs\\npm底下，然後透過PATH來指定到Program Files\\nodejs\\npm底下的npm，但真正Global的位置卻是在users\\skychang\\AppData\\Roaming\\npm底下，換言之，透過msi安裝的npm不是在Global，也因此透過-g指令，是無法更新的… ( 因為Global裡面本來就沒有npm，而是放在Program Files\\nodejs\\npm底下 )。</p>\n<p>當然，我們可以用npm install npm -g再安裝一次npm到global底下。( 但這也要小心…等下會解釋到…<font color=\"#ff0000\">平常沒事，也不建議這樣做</font>… )</p>\n<p>或是進入到c:\\program files\\nodejs，使用npm update npm來裝… ( 但是同上，<font color=\"#ff0000\">要小心</font>… )</p>\n<p><a href=\"http://lh3.ggpht.com/-VyqiIvyeTzs/VBPVFHpDvGI/AAAAAAAAJ7g/TH1ApGKD0xw/s1600-h/image%25255B3%25255D.png\"><img src=\"http://lh5.ggpht.com/-6SQZ220EVuE/VBPVF-EKjpI/AAAAAAAAJ7o/ZueUypIiteA/image_thumb%25255B1%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>當用npm install npm -g安裝到global，或是進入目錄更新npm，要注意第一件事情；必須使用專用的Node.js command prompt才能優先找到Global的npm，那是因為PATH路徑順序的問題，可以看下圖，下半段是Node.js command prompt PATH，上半段是一般的PATH，可以發現，下半段的順序，會先吃到Users\\skychang\\AppData\\Roaming\\npm；但上半段則是會先吃到Program Files\\nodesjs。</p>\n<p><a href=\"http://lh3.ggpht.com/-fRhPgmOQMhU/VBPVGcmuvJI/AAAAAAAAJ7w/bv96nkoI50Q/s1600-h/image_thumb24%25255B2%25255D.png\"><img src=\"http://lh6.ggpht.com/-7w7kG2UAg1g/VBPVHHcqe5I/AAAAAAAAJ74/C6qpf2bBwKI/image_thumb24_thumb.png?imgmax=800\" alt=\"image_thumb24\" title=\"image_thumb24\"></a></p>\n<p>另外，要注意的第二件事情，當使用了npm install npm –g 將npm裝到Global後，要重新於安裝npm的目錄下重新設定.npmrc這個檔案，不然你會發現，Globalconfig、prefix的路徑都不是指向原本的AppData\\Roaming底下了…( 變成Global是吃C:\\Program Files\\nodejs\\etc\\npmrc這個檔案 )</p>\n<p>另外…prefix這邊( 可以透過npm config ls –l 列出詳細資訊，詳細資訊請參考下圖 )，對應的是C:\\Program Files\\nodejs，也不是AppData\\Roaming底下了…</p>\n<p><a href=\"http://lh3.ggpht.com/--4frACCyJMg/VBPVH91UPtI/AAAAAAAAJ8A/Hp2YHZ-3yxQ/s1600-h/image_thumb2%25255B2%25255D.png\"><img src=\"http://lh6.ggpht.com/-KH2-nY3wkWw/VBPVIlHc1xI/AAAAAAAAJ8I/yfu87sf4O3w/image_thumb2_thumb.png?imgmax=800\" alt=\"image_thumb2\" title=\"image_thumb2\"></a></p>\n<p>換言之，就代表，如果你未設定.npmrc，那未來你安裝Global的套件，預設會變成安裝到C:\\Program Files\\nodejs底下…這是一件很可怕的事情啊XDD ( 而且整個可能會錯亂掉… )</p>\n<p>所以，當更新完npm後，要不就是針對User在C:\\Users\\skychang\\設定.npmrc，要不然就是要在C:\\Program Files\\nodejs\\node_modules\\npm底下重新改寫.npmrc，而且要調整一些Config…</p>\n<p>所以，在這邊還是建議，沒有特別必要更新npm的話，跟著msi版本就好…，當msi版本更新，在重裝就好…不然改錯、遺忘、或是又在一次更新npm的時候，放在C:\\Program Files\\nodejs\\node_modules\\npm底下的東西都會被刪除掉…</p>\n<p>最後，底下是沒更新時候，預設的設定檔；我們可以看到prefix已經被overridden了，所以會將Global安裝到Roaming底下…而Globalconfig等參數，也不是指向C:\\Program Files\\nodejs\\，而是指到AppData\\Roaming…</p>\n<p><a href=\"http://lh3.ggpht.com/-SJkJnWdpszM/VBPVJvEJzmI/AAAAAAAAJ8Q/Z-w2FCU4s6k/s1600-h/image_thumb4%25255B2%25255D.png\"><img src=\"http://lh4.ggpht.com/-s3ky1r-j2Js/VBPVKMnA07I/AAAAAAAAJ8Y/kb5xyMTUrBU/image_thumb4_thumb.png?imgmax=800\" alt=\"image_thumb4\" title=\"image_thumb4\"></a></p>\n<p>而實際上，因為用msi裝的，所以npm並非Global，所以他是吃自己底下的npmrc檔案，而裡面可以看到，他重新定義了prefix。</p>\n<p><a href=\"http://lh3.ggpht.com/-pArk3C9ejHs/VBPVKwp833I/AAAAAAAAJ8g/-CofvOo7Pic/s1600-h/image_thumb6%25255B2%25255D.png\"><img src=\"http://lh3.ggpht.com/-my5qZBQBr6M/VBPVLlgp_YI/AAAAAAAAJ8o/t14A9FT3w7I/image_thumb6_thumb.png?imgmax=800\" alt=\"image_thumb6\" title=\"image_thumb6\"></a></p>\n<p>但是因為我們更新了npm，所以上面那些東西在更新後，就全部都不見了XDD，所以都要重新設定…</p>\n<h4>結論</h4>\n<p>如果真的要更新…就別忘了去改.npmrc檔案，而這個.npmrc檔案，你可以放在User\\xxxx底下 ( 但就不能大家共用 )，或是C:\\Program Files\\nodejs\\node_modules\\npm底下.. ( 但更新的時候，就bye bye了… )。</p>\n<p>而更新檔的內容，也要調整Global等相關設定、Prefix等相關設定…</p>\n<p>所以其實滿吃力不討好的… ( 當然，如果你是神人階級的例外啦XDD )</p>\n<p>另外，就是完全不要使用msi安裝包來安裝…而是先下載nodejs.exe檔案，然後npm再從Github抓下來後編譯，也是一個辦法啦…但這就會要自己設定%PATH%等相關路徑… ( 老實說，小弟也很懶得搞這些… )</p>\n<p>So…除非必要，不然就不要更新npm吧，真的要更新，就透過msi檔來更新吧…是比較輕鬆的方法嚕…</p>\n<h4>參考資料</h4>\n<ul>\n<li><a href=\"https://www.npmjs.org/doc/files/npmrc.html\" title=\"https://www.npmjs.org/doc/files/npmrc.html\">https://www.npmjs.org/doc/files/npmrc.html</a>  <li><a href=\"https://www.npmjs.org/doc/misc/npm-config.html\" title=\"https://www.npmjs.org/doc/misc/npm-config.html\">https://www.npmjs.org/doc/misc/npm-config.html</a>  <li><a href=\"https://stackoverflow.com/questions/6685892/how-do-i-fix-npms-global-location\" title=\"https://stackoverflow.com/questions/6685892/how-do-i-fix-npms-global-location\">https://stackoverflow.com/questions/6685892/how-do-i-fix-npms-global-location</a>  <li><a href=\"http://stackoverflow.com/questions/19874582/change-default-global-installation-directory-for-node-js-modules-in-windows\" title=\"http://stackoverflow.com/questions/19874582/change-default-global-installation-directory-for-node-js-modules-in-windows\">http://stackoverflow.com/questions/19874582/change-default-global-installation-directory-for-node-js-modules-in-windows</a></li>\n</ul>","excerpt":"這篇談論的是在Windows底下，使用Node.js msi檔安裝Node.js後，輸入npm update npm –g 無法更新的原因與解決方案 ( 其實也沒有解決方案啦… ) 透過Node.js的msi安裝的npm，是無法透過npm update npm -g來更新npm…"}},"pageContext":{"type":"posts","next":{"frontmatter":{"path":null,"title":"Visual Studio - 安裝Node.js Tools","tags":["Node.js","npm","Visual Studio"]},"fields":{"slug":"/2014/09/12/Visual-Studio-安裝Node-js-Tools/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Visual-Studio-安裝Node-js-Tools.md"},"previous":{"frontmatter":{"path":null,"title":"TechDays 2014 遊記","tags":["Sky的IT碎碎念"]},"fields":{"slug":"/2014/09/14/TechDays-2014-遊記/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/TechDays-2014-遊記.md"}}}}