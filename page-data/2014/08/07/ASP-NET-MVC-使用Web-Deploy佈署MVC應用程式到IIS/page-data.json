{"componentChunkName":"component---src-templates-page-js","path":"/2014/08/07/ASP-NET-MVC-使用Web-Deploy佈署MVC應用程式到IIS/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"ASP.NET MVC -  使用Web Deploy佈署MVC應用程式到IIS","date":"07 August 2014","author":"Sky Chang","excerpt":null,"tags":["ASP.NET","ASP.NET MVC","IIS"],"coverImage":null},"id":"a7bff9c4-614d-59fb-b523-8c40d6ab9f1e","html":"<p>是的!!，大家沒看錯，這篇文章就是要寫很基本到基本不行的基本功；那為啥要寫這篇呢?因為小弟最近都佈署到Azure…久久才佈署一次到IIS上，但每次都會遇到一些小問題(翻)，所以為了一勞永逸，就直接把步驟記錄下了來= =…( 不然每次都會忘記東一點，忘記西一點 )</p>\n<p>既然如此，我們就開始吧!!首先，我們要先安裝IIS (廢話…)。</p>\n<p><a href=\"http://lh5.ggpht.com/-84gJrz0n0_4/U-JcB0wXUUI/AAAAAAAAJm0/oE4WWGhXeW0/s1600-h/image%25255B4%25255D.png\"><img src=\"http://lh5.ggpht.com/-zjTuUeaVi6Y/U-JcDEd-p7I/AAAAAAAAJm8/D20-V3gmB98/image_thumb%25255B2%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>然後功能這邊，要勾選ASP.NET 4.5!!，因為MVC 5都是拆開成一個又一個的DLL了，所以如果要佈署MVC 5，就直接勾選ASP.NET 4.5就可以了，不用再特別安裝獨立的MVC Package。</p>\n<p><a href=\"http://lh4.ggpht.com/-xMYC-J5T6X4/U-JcD2PyeII/AAAAAAAAJnE/4gxvySMM3_8/s1600-h/image%25255B9%25255D.png\"><img src=\"http://lh6.ggpht.com/-IEKj8fdZDfU/U-JcEg7lR0I/AAAAAAAAJnM/smlobQpxf5c/image_thumb%25255B5%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>因為我們會使用Web Deploy佈署，所以要把Management Service勾起來。</p>\n<p><a href=\"http://lh5.ggpht.com/-fFOfvbm5Z2s/U-JcFQbxKjI/AAAAAAAAJnU/MwFcuny6fJc/s1600-h/image%25255B14%25255D.png\"><img src=\"http://lh3.ggpht.com/-7mKuqXUXi44/U-JcGlyitQI/AAAAAAAAJnc/U7PA7eUS0Bc/image_thumb%25255B8%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>另外，我們也要在Application Development裡面勾選ASP.NET 4.5，通常勾ASP.NET 4.5，那.NET Extensibility 4.5、ISAPI Extensions、ISAPI Filters都會自動勾起來，另外，如果有使用到SignalR，那要把WebSocket Protocol勾起來喔~當然，其他的Windows驗證等等之類的，就看各位看官的需求了，這邊畢竟是針對Web Deploy和標準的MVC，有需要的朋友，就自行勾選吧。</p>\n<p><a href=\"http://lh4.ggpht.com/-_Hlc18_oxHw/U-JcHGOZljI/AAAAAAAAJnk/4JQ_UHbG2es/s1600-h/image%25255B19%25255D.png\"><img src=\"http://lh6.ggpht.com/-HP7gRx3NR5g/U-JcIKlnhcI/AAAAAAAAJns/Jg6Bm37jXs4/image_thumb%25255B11%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來要使用Web Platform來進行安裝Web Deploy，如果是新安裝的OS，進入IIS的時候，他就會問你要不要裝了，然後就會進入Web Platform的官網，這時選擇下載，並且安裝就可以。( p.s 如果IE的安全性沒關掉，不能下載喔…別忘了Win Server的IE預設會開安全性 )，或是進入IIS後，選擇下圖的按鈕也是可以。</p>\n<p><a href=\"http://lh6.ggpht.com/-tQgh-HjIL6E/U-JcJL1fsoI/AAAAAAAAJn0/h9SpuMqZv1s/s1600-h/image%25255B24%25255D.png\"><img src=\"http://lh6.ggpht.com/-DFJlu_70ARc/U-JcKUHi3rI/AAAAAAAAJn8/Q6WVRcc0LxI/image_thumb%25255B14%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>這邊要裝Web Deploy 3.5、Web Deploy 3.5 without bundled SQL support、Web Deploy 3.5 for Hosting Servers三個套件，除此之外，你也可以直接到Web Deploy的官網下載msi檔案來安裝，我們這邊就先用Web Platform來安裝。( 也有很多文章，是建議直接裝\"Recommended Server Configuration For Web Hosting Providers\"，但那裏面包含了PHP、MySQL等等東西，還要自己取消勾選，所以小弟是直接安裝Web Deploy啦~ )</p>\n<p><a href=\"http://lh3.ggpht.com/-cQlePzhY2UI/U-JcLW_3S-I/AAAAAAAAJoE/bJMGVFbNLPY/s1600-h/image%25255B29%25255D.png\"><img src=\"http://lh6.ggpht.com/-KfX1z1DkVCU/U-JcMYeSHMI/AAAAAAAAJoM/zYdDAzBLXNc/image_thumb%25255B17%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>完成後，重新開啟IIS管理介面，就可以看到如下圖位置，多了很多管理的東西~</p>\n<p><a href=\"http://lh3.ggpht.com/-bvHu0KnkvGE/U-JcNCXUKwI/AAAAAAAAJoU/s5jg-Ip_zrk/s1600-h/image%25255B34%25255D.png\"><img src=\"http://lh3.ggpht.com/-I1M9Zw9NfhE/U-JcOQdfRsI/AAAAAAAAJoc/ZEy0bavrxME/image_thumb%25255B20%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，我們要設定使用權限，通常我們不會使用administrator的權限來進行Deploy，所以在進行下圖這個步驟之前，請自行先去新增一個帳號；新增完畢後，就可以透過下圖的位置，來設定權限。</p>\n<p><a href=\"http://lh5.ggpht.com/-3okmOWl-srE/U-JcPXdVULI/AAAAAAAAJok/oDvgPMj62m4/s1600-h/image%25255B44%25255D.png\"><img src=\"http://lh3.ggpht.com/-7lkBqxFOL7w/U-JcQLQcqQI/AAAAAAAAJos/QMEwhIlxNCw/image_thumb%25255B26%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>這邊，我們使用skychang這個帳號，到時候在vs裡面，也是用這個帳號進行佈署。</p>\n<p><a href=\"http://lh6.ggpht.com/-hrbzhzIr3vA/U-JcQ9AMW3I/AAAAAAAAJo0/nfsMnJ_ecXY/s1600-h/image%25255B54%25255D.png\"><img src=\"http://lh6.ggpht.com/-y9kvSyMAKpA/U-JcRjcVYLI/AAAAAAAAJo8/cvl5ZW_1htQ/image_thumb%25255B32%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，我們要進入到下圖的位置，打開遠端佈署的功能。</p>\n<p><a href=\"http://lh5.ggpht.com/-gjTtmcKG0lQ/U-JcSh78wrI/AAAAAAAAJpE/389cy4qwrkA/s1600-h/image%25255B59%25255D.png\"><img src=\"http://lh5.ggpht.com/-FjHYDv8USdI/U-JcTnJom0I/AAAAAAAAJpM/AP3yJiHoSSQ/image_thumb%25255B35%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>要Enable，必須先停止後，才能勾選Enable，勾選完後，再啟動就可以了。</p>\n<p><a href=\"http://lh4.ggpht.com/-7kQQMqYUZ74/U-JcUgNfjBI/AAAAAAAAJpU/0M61W6G7fvU/s1600-h/image%25255B64%25255D.png\"><img src=\"http://lh6.ggpht.com/-K7_57iXw9FE/U-JcVkYt5pI/AAAAAAAAJpc/UJpBg3xJTcw/image_thumb%25255B38%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，我們要設定佈署的相關資訊，簡單的說，就是設定skychang擁有web目錄下的權限。(這樣才能塞網頁上去嘛~ )</p>\n<p><a href=\"http://lh4.ggpht.com/-cS89VS00ggQ/U-JcWuwfAfI/AAAAAAAAJpk/AMdyf81F814/s1600-h/image%25255B69%25255D.png\"><img src=\"http://lh3.ggpht.com/-mdXRq_TRxVw/U-JcXtFG_-I/AAAAAAAAJps/totNsh5VqEw/image_thumb%25255B41%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>這邊我們選則剛剛設定的帳號，然後按下setup，就會開始設定目錄的權限了~</p>\n<p><a href=\"http://lh4.ggpht.com/-MooDeToHMRs/U-JcYtHTKCI/AAAAAAAAJpw/EjcxVR2k0Aw/s1600-h/image%25255B74%25255D.png\"><img src=\"http://lh5.ggpht.com/-3OEDLpJtedA/U-JcZaZdrVI/AAAAAAAAJp4/5X-RfPdC6SA/image_thumb%25255B44%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>到這邊，其實還沒結束，也別忘記要把port 8172打開。</p>\n<p><a href=\"http://lh6.ggpht.com/-SvLsBoA4cqU/U-JcadSmfAI/AAAAAAAAJqA/Nywa5ftFcAo/s1600-h/image%25255B78%25255D.png\"><img src=\"http://lh5.ggpht.com/-64BM-cWpSro/U-JcbUFB49I/AAAAAAAAJqM/rRc4TO186gs/image_thumb%25255B46%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>另外，我們也順便從啟動服務這邊，看看Web Deployment Agent Service、Web Management Service啟動了沒。</p>\n<p><a href=\"http://lh3.ggpht.com/-m6Ewoj5lr7o/U-JcgYyjIZI/AAAAAAAAJqU/NAYIz18KwKk/s1600-h/image%25255B82%25255D.png\"><img src=\"http://lh3.ggpht.com/-WkPXpA_EN5g/U-JchITQAbI/AAAAAAAAJqc/Bzzyuoid5lk/image_thumb%25255B48%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>都完成之後，就回到Visual Studio裡面，設定發行；通常伺服器，用ip比較方便，他會自己去尋找Web Deploy的位置；網站名稱如果有需要，可以在Default Web Site後面再加上Application Name，例如Default Web Site\\MyApp；目的地URL，就是你佈署完之後，你這邊會用瀏覽器打開的URL。</p>\n<p><a href=\"http://lh6.ggpht.com/-xTWEn3RJC1Q/U-Jch9PcTdI/AAAAAAAAJqk/Q2wqQsTMX5Q/s1600-h/image%25255B87%25255D.png\"><img src=\"http://lh5.ggpht.com/-Sf1ZEpE4ZBo/U-JciuasT-I/AAAAAAAAJqo/UTQyAHfyYx8/image_thumb%25255B51%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>正常情況下，驗證連線就可以通過了，但今天不知道為啥，遇到了404錯誤，通常遇到這個錯誤，是因為Web Deploy沒有啟動監聽處理，也就是說Web Deploy的安裝沒安裝好，所以我們可以進Web Deploy的網站下，下載安裝檔；記住，如下圖，全部都要勾選。</p>\n<p><a href=\"http://lh3.ggpht.com/-hqdffeHihnQ/U-Jcjmh-a3I/AAAAAAAAJq0/dxg1mEb2ckI/s1600-h/image%25255B92%25255D.png\"><img src=\"http://lh5.ggpht.com/-w-CE9ru1xqc/U-JckWKJhrI/AAAAAAAAJq8/GBD9Ozsz3i0/image_thumb%25255B54%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>另外，今天也有遇到一個小問題，是Microsoft.Web.Infrastructure錯誤，這種錯誤通常都是因為使用到Windows Server上的GAC；解決方式很簡單；基本上，回到我們專案上，看一下Infrastructure這個DLL的路徑，是使用到下載NuGet的Package，還是參考到GAC路徑；如果是參考到GAC，大家可以參考<a href=\"http://stackoverflow.com/questions/12669206/error-microsoft-web-infrastructure-version-1-0-0-0-culture-neutral-publickeyt\">這篇</a>，或是參考<a href=\"http://www.dotblogs.com.tw/mantou1201/archive/2013/07/02/107625.aspx\">饅頭</a>這篇解法；如果是參考NuGet下載下來的路徑，那只要把複製到本機這個false改成True；到時候就會把這個dll給傳上去了。</p>\n<p><a href=\"http://lh4.ggpht.com/-brFPS_fSIkI/U-JclQyUuaI/AAAAAAAAJrE/kGr9YbMAIlw/s1600-h/image%25255B97%25255D.png\"><img src=\"http://lh3.ggpht.com/-6s9c9fvhhGM/U-JcmFGE8EI/AAAAAAAAJrM/1sB38PM36PA/image_thumb%25255B57%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>通常這樣應該就都會成功了!!~你的MVC 5應用程式，就可以順利佈署上去了~</p>\n<p>參考資料</p>\n<ul>\n<li><a href=\"http://www.iis.net/learn/install/installing-publishing-technologies/installing-and-configuring-web-deploy-on-iis-80-or-later\" title=\"http://www.iis.net/learn/install/installing-publishing-technologies/installing-and-configuring-web-deploy-on-iis-80-or-later\">http://www.iis.net/learn/install/installing-publishing-technologies/installing-and-configuring-web-deploy-on-iis-80-or-later</a></li>\n<li><a href=\"http://www.dotblogs.com.tw/mantou1201/archive/2013/07/02/107625.aspx\" title=\"http://www.dotblogs.com.tw/mantou1201/archive/2013/07/02/107625.aspx\">http://www.dotblogs.com.tw/mantou1201/archive/2013/07/02/107625.aspx</a></li>\n<li><a href=\"http://stackoverflow.com/questions/12669206/error-microsoft-web-infrastructure-version-1-0-0-0-culture-neutral-publickeyt\" title=\"http://stackoverflow.com/questions/12669206/error-microsoft-web-infrastructure-version-1-0-0-0-culture-neutral-publickeyt\">http://stackoverflow.com/questions/12669206/error-microsoft-web-infrastructure-version-1-0-0-0-culture-neutral-publickeyt</a></li>\n</ul>","excerpt":"是的!!，大家沒看錯，這篇文章就是要寫很基本到基本不行的基本功；那為啥要寫這篇呢?因為小弟最近都佈署到Azure…久久才佈署一次到IIS…"}},"pageContext":{"type":"posts","next":{"frontmatter":{"path":null,"title":"GitHub -  在本地端建立Jekyll Server以利測試Blog文章","tags":["Git","GitHub","Ruby"]},"fields":{"slug":"/2014/08/01/GitHub-在本地端建立Jekyll-Server以利測試Blog文章/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/GitHub-在本地端建立Jekyll-Server以利測試Blog文章.md"},"previous":{"frontmatter":{"path":null,"title":"Entity Framework -  為什麼修改的資料不用Attach","tags":["ASP.NET MVC","Entity Framework"]},"fields":{"slug":"/2014/08/21/Entity-Framework-為什麼修改的資料不用Attach/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Entity-Framework-為什麼修改的資料不用Attach.md"}}}}