{"componentChunkName":"component---src-templates-page-js","path":"/2014/08/24/Azure-儲存Session到Redis-Cache/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Azure - 儲存Session到Redis Cache","date":"24 August 2014","author":"Sky Chang","excerpt":null,"tags":["ASP.NET MVC","Azure","Redis"],"coverImage":null},"id":"6ebe3508-75fb-5d72-83fa-3dfa80391c5d","html":"<p>上一篇，我們快速地看到了Redis怎麼樣在Azure建立與使用，那同樣的，在Azure上，多個Instance最需要解決的還是Session問題；我們以前看了很多種解決方式，例如官方不建議的Table方式，或是早期的存放到SQL Database、貴貴的Azure Cache，或是拿Cloud Service的Work Role當作Cache。</p>\n<p>而這篇文章，我們就來看看，要怎樣使用超高速的Redis Cache當作Session的存放位置。</p>\n<p>首先，我們要在NuGet裝RedisSessionStateProvider，所以我們要在搜尋方塊打\"RedisSessionStateProvider”。( 目前這個Lib是屬於發行前版本，所以要切換到發行前版本進行搜尋才搜尋的到 )</p>\n<p><a href=\"http://lh5.ggpht.com/-4uErAxzP8c4/U_mzMroV1mI/AAAAAAAAJtg/_p4j98q2qPU/s1600-h/image%25255B4%25255D.png\"><img src=\"http://lh6.ggpht.com/-hwnggp09Zok/U_mzNqgS01I/AAAAAAAAJto/QCSXBEWIf-0/image_thumb%25255B2%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>完成之後，官方是寫說會將Lib載入，並且自動修改Web.config，但實際上，我沒有阿QQ..好啦，這個月人品持續有問題，那我們也只好自己加入了…下面是官方給的範例，我們就用這範例去做調整吧。</p>\n<p>基本上，只有retryTimeoutInMilliseconds要注意一下，因為是以毫秒為單位計算。( RetryTimeoutInMilliseconds是當有斷線，連不到的情況下，可以重試 )</p>\n<pre class=\"brush: xml;\">&lt;sessionState mode=\"Custom\" customProvider=\"MySessionStateStore\"&gt;\n  &lt;providers&gt;\n    &lt;!--\n      &lt;add name=\"MySessionStateStore\" \n        host = \"127.0.0.1\" [String]\n        port = \"\" [number]\n        accessKey = \"\" [String]\n        ssl = \"false\" [true|false]\n        throwOnError = \"true\" [true|false]\n        retryTimeoutInMilliseconds = \"0\" [number]\n      /&gt;\n    --&gt;\n    &lt;add name=\"MySessionStateStore\" type=\"Microsoft.Web.Redis.RedisSessionStateProvider\" host=\"127.0.0.1\" accessKey=\"\" ssl=\"false\" /&gt;\n  &lt;/providers&gt;\n&lt;/sessionState&gt;\n</pre>\n<p>那我們修改玩的Web.Config會長得像這樣，記得accessKey要填入Azure上Redis Cache的Key。</p>\n<pre class=\"brush: xml;\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;!--\n  如需如何設定 ASP.NET 應用程式的詳細資訊，請瀏覽\n  http://go.microsoft.com/fwlink/?LinkId=301880\n  --&gt;\n&lt;configuration&gt;\n  &lt;appSettings&gt;\n    &lt;add key=\"webpages:Version\" value=\"3.0.0.0\"/&gt;\n    &lt;add key=\"webpages:Enabled\" value=\"false\"/&gt;\n    &lt;add key=\"ClientValidationEnabled\" value=\"true\"/&gt;\n    &lt;add key=\"UnobtrusiveJavaScriptEnabled\" value=\"true\"/&gt;\n  &lt;/appSettings&gt;\n  &lt;system.web&gt;\n    &lt;compilation debug=\"true\" targetFramework=\"4.5\"/&gt;\n    &lt;httpRuntime targetFramework=\"4.5\"/&gt;\n\n    &lt;sessionState mode=\"Custom\" customProvider=\"MySessionStateStore\"&gt;\n      &lt;providers&gt;\n        &lt;!--\n      &lt;add name=\"MySessionStateStore\" \n        host = \"127.0.0.1\" [String]\n        port = \"\" [number]\n        accessKey = \"\" [String]\n        ssl = \"false\" [true|false]\n        throwOnError = \"true\" [true|false]\n        retryTimeoutInMilliseconds = \"0\" [number]\n      /&gt;\n    --&gt;\n        &lt;add name=\"MySessionStateStore\" type=\"Microsoft.Web.Redis.RedisSessionStateProvider\" \n             host=\"skyrediscache.redis.cache.windows.net\"\n        accessKey=\"...\" ssl=\"true\" /&gt;\n      &lt;/providers&gt;\n    &lt;/sessionState&gt;\n\n  &lt;/system.web&gt;\n  &lt;runtime&gt;\n    &lt;assemblyBinding xmlns=\"urn:schemas-microsoft-com:asm.v1\"&gt;\n      &lt;dependentAssembly&gt;\n        &lt;assemblyIdentity name=\"Newtonsoft.Json\" culture=\"neutral\" publicKeyToken=\"30ad4fe6b2a6aeed\"/&gt;\n        &lt;bindingRedirect oldVersion=\"0.0.0.0-6.0.0.0\" newVersion=\"6.0.0.0\"/&gt;\n      &lt;/dependentAssembly&gt;\n      &lt;dependentAssembly&gt;\n        &lt;assemblyIdentity name=\"System.Web.Optimization\" publicKeyToken=\"31bf3856ad364e35\"/&gt;\n        &lt;bindingRedirect oldVersion=\"1.0.0.0-1.1.0.0\" newVersion=\"1.1.0.0\"/&gt;\n      &lt;/dependentAssembly&gt;\n      &lt;dependentAssembly&gt;\n        &lt;assemblyIdentity name=\"WebGrease\" publicKeyToken=\"31bf3856ad364e35\"/&gt;\n        &lt;bindingRedirect oldVersion=\"1.0.0.0-1.5.2.14234\" newVersion=\"1.5.2.14234\"/&gt;\n      &lt;/dependentAssembly&gt;\n      &lt;dependentAssembly&gt;\n        &lt;assemblyIdentity name=\"System.Web.Helpers\" publicKeyToken=\"31bf3856ad364e35\"/&gt;\n        &lt;bindingRedirect oldVersion=\"1.0.0.0-3.0.0.0\" newVersion=\"3.0.0.0\"/&gt;\n      &lt;/dependentAssembly&gt;\n      &lt;dependentAssembly&gt;\n        &lt;assemblyIdentity name=\"System.Web.WebPages\" publicKeyToken=\"31bf3856ad364e35\"/&gt;\n        &lt;bindingRedirect oldVersion=\"1.0.0.0-3.0.0.0\" newVersion=\"3.0.0.0\"/&gt;\n      &lt;/dependentAssembly&gt;\n      &lt;dependentAssembly&gt;\n        &lt;assemblyIdentity name=\"System.Web.Mvc\" publicKeyToken=\"31bf3856ad364e35\"/&gt;\n        &lt;bindingRedirect oldVersion=\"1.0.0.0-5.2.0.0\" newVersion=\"5.2.0.0\"/&gt;\n      &lt;/dependentAssembly&gt;\n    &lt;/assemblyBinding&gt;\n  &lt;/runtime&gt;\n&lt;/configuration&gt;\n</pre>\n<p>最後，我們可以寫一個Session進去看看。</p>\n<pre class=\"brush: csharp;\">public ActionResult SessionTest()\n{\n    Session[\"Test\"] = \"Hello Redis\";\n\n    return View();\n}\n</pre>\n<p>基本上如果無報錯的話，就代表成功了喔!!</p>\n<p>參考資料</p>\n<ul>\n<li><a href=\"http://blogs.msdn.com/b/webdev/archive/2014/05/12/announcing-asp-net-session-state-provider-for-redis-preview-release.aspx?PageIndex=4\" title=\"http://blogs.msdn.com/b/webdev/archive/2014/05/12/announcing-asp-net-session-state-provider-for-redis-preview-release.aspx?PageIndex=4\">http://blogs.msdn.com/b/webdev/archive/2014/05/12/announcing-asp-net-session-state-provider-for-redis-preview-release.aspx?PageIndex=4</a></li>\n<li><a href=\"http://azure.microsoft.com/zh-tw/documentation/articles/cache-dotnet-how-to-use-azure-redis-cache/\" title=\"http://azure.microsoft.com/zh-tw/documentation/articles/cache-dotnet-how-to-use-azure-redis-cache/\">http://azure.microsoft.com/zh-tw/documentation/articles/cache-dotnet-how-to-use-azure-redis-cache/</a></li>\n</ul>","excerpt":"上一篇，我們快速地看到了Redis怎麼樣在Azure建立與使用，那同樣的，在Azure上，多個Instance最需要解決的還是Session問題；我們以前看了很多種解決方式，例如官方不建議的Table方式，或是早期的存放到SQL Database、貴貴的Azure Cache…"}},"pageContext":{"type":"posts","next":{"frontmatter":{"path":null,"title":"Azure - Redis Cache","tags":["ASP.NET MVC","Azure","Redis"]},"fields":{"slug":"/2014/08/24/Azure-Redis-Cache/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Azure-Redis-Cache.md"},"previous":{"frontmatter":{"path":null,"title":"Azure -  Resource Group","tags":["Azure"]},"fields":{"slug":"/2014/08/24/Azure-Resource-Group/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Azure-Resource-Group.md"}}}}