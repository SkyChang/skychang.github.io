{"componentChunkName":"component---src-templates-page-js","path":"/2014/08/24/Azure-Application-Insights/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Azure -  Application Insights","date":"24 August 2014","author":"Sky Chang","excerpt":null,"tags":["Azure","VSO"],"coverImage":null},"id":"e126448d-64cb-594b-a215-70eeffece3ae","html":"<p>其實寫這篇之前，真的想小小抱怨一下，大家就稍微聽小弟發個牢騷吧QQ…</p>\n<p>其實在Visual Studio Online推出Application Insights的時候，小弟就已經把圖片都整理好了，只是內文沒時間寫，後來小小的改版，圖也重新弄了一下，但那時候發現Application Insights Tools有一個Bug；那個Bug就是\"如果你在Visual Studio裡面使用Application Insights註冊後，並簽入版控，別人取出來後，可以輕鬆地透過Visual Studio來進入擁有者的Visual Studio，換言之，就是擁有了Visual Studio Online的管理權限；也因此，小弟又把這篇文章給保留了…</p>\n<p>直到Visual Studio 2013 Updata 3出了之後，基本上這個問題解決了…但整個部屬給我改到Azure去了…Orz… ( 雖說也是小弟的領域啦… )</p>\n<p>但是…圖…整個要重弄了，整個要重弄了，整個要重弄了…</p>\n<p>其次，佈署到Azure的Application Insights，和Visual Studio Online裡面的Application Insights是串不起來的!!!!換言之就是說，你可以在Azure看到Application Insights的資訊，但是Visual Studio Online裡面看不到!!</p>\n<p>於是，又花了快一個禮拜的時間，斷斷續續地找資料。</p>\n<p>結果在MSDN看到這段…</p>\n<blockquote>\n<p>Application Insights is moving! For a while, there will be two versions: </p>\n<ul>\n<li>\n<p>[Application Insights for Visual Studio Online](http://msdn.microsoft.com/en-us/library/dn481095.aspx) – the older version.\n<li>\n[Application Insights in Microsoft Azure Preview](http://go.microsoft.com/fwlink/?LinkId=506854) – the new version. \n</li>\n</ul>\n<p>We’re gradually building up features in the new version, and are doing no new development on the old one. </p>\n</blockquote>\n<p>你整個搬家到Azure是沒關係啦…但你至少要在Visual Studio Online上講一下吧QQ….</p>\n<p>唉，所以結論，小弟這邊就不介紹Visual Studio Online的部分了，直接看Azure上的Application Insights吧…( 下圖是 Visual Studio Online的畫面，就當作紀念留下吧… )</p>\n<p><a href=\"http://lh6.ggpht.com/-mvN_63sGeuU/U_oDfxe87NI/AAAAAAAAJvo/aBfuOJCz6fA/s1600-h/image31.png\"><img src=\"http://lh5.ggpht.com/-F2ba0yI6U9Y/U_oDhRVBBZI/AAAAAAAAJvw/hbsPLNM0fDU/image_thumb1%25255B1%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<h3>正文開始</h3>\n<p>上面抱怨完了，正文開始…Application Insights是Visual Studio Online很強的一個力作( 但目前被歸類到Azure上 )，他可以讓我們不用做啥事情(頂多設定)，就可以快速的收集Server上的資料、使用者的狀況等資訊，例如:使用者用了哪些瀏覽器、看了那些網頁，這些類似Google分析的事情；但除此之外，他還支援了Server層級的訊息，例如:最長的反應時間、請求與錯誤訊息、還可以設定檢查，檢查網站是否活著!!</p>\n<h3>安裝與使用 – 在應用程式啟用Application Insights</h3>\n<p>如果是剛開始建立應用程式的情況，那我們可以直接勾選下圖的位置；但小弟我相信，這個情況通常不高XDD</p>\n<p><a href=\"http://lh6.ggpht.com/-MKrGt8KPe_E/U_oDjSceTtI/AAAAAAAAJv4/pzn85JiVFfI/s1600-h/image%25255B5%25255D.png\"><img src=\"http://lh6.ggpht.com/-7JKGHsdTP94/U_oDki85-fI/AAAAAAAAJwA/_Aj7l731TJg/image_thumb%25255B3%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>通常我們都是已經有應用程式了；所以這邊，我們只要有安裝Visual Studio Updata 3，那就可以透過下圖的位置，輕易地安裝。</p>\n<p><a href=\"http://lh4.ggpht.com/-AAhvsBEwNZ8/U_oDmH-9KHI/AAAAAAAAJwI/W5P4HFI6I4I/s1600-h/image%25255B10%25255D.png\"><img src=\"http://lh6.ggpht.com/-RB28_fFQs_I/U_oDnnlVi6I/AAAAAAAAJwQ/EoK3Bc4YSps/image_thumb%25255B6%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，要使用Azure的帳號進行登入，如果這個應用程式已經在Azure上了，那可以選擇現有的Application Insights資源，因為現在建立新的Website，都會自己幫你建立一組…( 還好現在不收錢… )。</p>\n<p>但如果還沒有在Azure建立過Website，或是沒打算佈署到Azure，只想使用Azure上的Application Insights，就可以使用新的Application Insights資源。\n<a href=\"http://lh6.ggpht.com/-6K2eFl2v130/U_oDozyoFnI/AAAAAAAAJwY/ubtTKleKPjQ/s1600-h/image%25255B22%25255D.png\"><img src=\"http://lh4.ggpht.com/-YocSqdHI74E/U_oDqBJRD4I/AAAAAAAAJwg/CrQFdIdxIgQ/image_thumb%25255B12%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a> </p>\n<p>此外，如果要自己定義Resource Group，或是等資訊，可以先在Azure建立好Application Insights，然後再回到Visual Studio裡面進行輸入，也是可以的 ( 如下圖 )，這個步驟，小弟就不做了喔~</p>\n<p><a href=\"http://lh6.ggpht.com/-eckq_yKXZLY/U_oDrvn5gmI/AAAAAAAAJwo/afeViPHukKc/s1600-h/image%25255B15%25255D.png\"><img src=\"http://lh4.ggpht.com/-ikgFX-4McMg/U_oDtAqJ3zI/AAAAAAAAJww/BAHtbBALoCU/image_thumb%25255B9%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>完成之後，會出現如下的檔案。</p>\n<p><a href=\"http://lh4.ggpht.com/-n9rpmIdhZcw/U_oDuXRwumI/AAAAAAAAJw4/UvGXJ6S3UqU/s1600-h/image%25255B28%25255D.png\"><img src=\"http://lh3.ggpht.com/-rW-HXm08BDc/U_oDvx8JadI/AAAAAAAAJxA/y739QNWo7aE/image_thumb%25255B16%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>其實NuGet也自動的幫我們加了一些東西，如果未來不想監控了，也可以移除。</p>\n<p><a href=\"http://lh6.ggpht.com/-Rpfyve6hpdo/U_oDxztQ-zI/AAAAAAAAJxI/gs9J9oJo_lc/s1600-h/image%25255B33%25255D.png\"><img src=\"http://lh4.ggpht.com/-L5OR5zo_2UY/U_oDzTz84zI/AAAAAAAAJxQ/Ux16ZY1Ut-I/image_thumb%25255B19%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>完成之後，我們其實啟動偵錯模式，他就會幫我們把訊息送到雲端上了喔!!!</p>\n<p><a href=\"http://lh3.ggpht.com/-XdI-b8uHUAc/U_oD0oluwBI/AAAAAAAAJxY/O1DJNu_aXRw/s1600-h/image%25255B37%25255D.png\"><img src=\"http://lh3.ggpht.com/-7q5JNEStfDU/U_oD2G70D4I/AAAAAAAAJxg/VAIiCyIJpSQ/image_thumb%25255B21%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>這時候我們開啟Azure，其實就可以看到，已經把資料傳上來了，第一次的回應時間真久阿XDD</p>\n<p><a href=\"http://lh3.ggpht.com/-ZQQO-XTKmtw/U_oD3zmNGNI/AAAAAAAAJxo/I_MKRiff2Qo/s1600-h/image%25255B42%25255D.png\"><img src=\"http://lh5.ggpht.com/-2h_wY18_4LU/U_oD57XPo2I/AAAAAAAAJxw/5m6qzpy0dbA/image_thumb%25255B24%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>而且，如果Server有執行錯誤，也會被Application Insights吃到!!，只是現在Azure還不支援詳細的錯誤訊息… ( 未來會有，目前寫著Coming Soon… )</p>\n<p><a href=\"http://lh4.ggpht.com/-Nj-YdH3-AUw/U_oD7o0DE3I/AAAAAAAAJx4/GbBOt6DGads/s1600-h/image%25255B62%25255D.png\"><img src=\"http://lh5.ggpht.com/-5nTh6kXWpAc/U_oD9Ioy3yI/AAAAAAAAJx8/Ndxrg9PdUfc/image_thumb%25255B36%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>另外，大家可能會想到一件事情，那我這樣子，不是每次開發的時候，都會把錯誤等資訊往上面丟嗎!!?</p>\n<p>其實在ApplicationInsight.config檔案裡面可以進行設定，只要把下面那行改為false，就不會把資訊往上丟了；而真正佈署的時候，再改成true就可以了。</p>\n<pre class=\"brush: csharp;\">    &lt;!--\n      DeveloperMode setting controls Application Insights SDK behavior to optimize for local debugging. \n      This setting should be set to false before deploying your application.\n    --&gt;\n    &lt;DeveloperMode&gt;true&lt;/DeveloperMode&gt;\n</pre>\n<p>基本上，這樣基礎的功能就完成了，但還有兩個東西需要設定，才會得到更詳細的訊息。</p>\n<h3>建立Reponse測試</h3>\n<p>我們這邊可以建立Reponse測試來測試網站是否活著；如下圖。</p>\n<p>除了測試名稱外，基本上我們也要給他一個URL；然後選擇要從哪邊發出測試；也可以自己定義成功的條件，還有是否要收到通知等相關項目。</p>\n<p><a href=\"http://lh4.ggpht.com/-DYvaxBGwO8s/U_oD-NFFEkI/AAAAAAAAJyE/K8kVH9F53r0/s1600-h/image%25255B47%25255D.png\"><img src=\"http://lh6.ggpht.com/-A6ADxUgTKmQ/U_oD_V_KtrI/AAAAAAAAJyM/HeQK1dd0q9g/image_thumb%25255B27%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<h3>加入使用者分析</h3>\n<p>除此之外，我們也希望能看到使用者的分析(類似Google分析)，而要加入使用者分析，就必須加入JS，到你的應用程式裡面了，做法如下圖。</p>\n<p><a href=\"http://lh6.ggpht.com/-fSsZPc6D1MQ/U_oEA3XUEHI/AAAAAAAAJyY/x-Hvyf2-PDY/s1600-h/image%25255B52%25255D.png\"><img src=\"http://lh5.ggpht.com/-_NfKDD5-aBw/U_oECqEM-DI/AAAAAAAAJyg/BKer1UZDo8E/image_thumb%25255B30%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>是的，就是底下那些JS Code，把它複製到HTML的head裡面就可以了。</p>\n<p><a href=\"http://lh6.ggpht.com/-rQvFBy6CLMo/U_oEENO7ANI/AAAAAAAAJyo/xkU0aQhnCxU/s1600-h/image%25255B57%25255D.png\"><img src=\"http://lh6.ggpht.com/-Dkgc-0x2PL4/U_oEFmKptCI/AAAAAAAAJyw/v1HmfqdEnGY/image_thumb%25255B33%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>基本上，就這些嚕</p>\n<h4>參考資料</h4>\n<ul>\n<li><a href=\"http://msdn.microsoft.com/en-us/library/dn518124.aspx\" title=\"http://msdn.microsoft.com/en-us/library/dn518124.aspx\">http://msdn.microsoft.com/en-us/library/dn518124.aspx</a></li>\n<li><a href=\"http://msdn.microsoft.com/en-us/library/dn793604.aspx\" title=\"http://msdn.microsoft.com/en-us/library/dn793604.aspx\">http://msdn.microsoft.com/en-us/library/dn793604.aspx</a></li>\n</ul>","excerpt":"其實寫這篇之前，真的想小小抱怨一下，大家就稍微聽小弟發個牢騷吧QQ… 其實在Visual Studio Online推出Application Insights…"}},"pageContext":{"type":"posts","next":{"frontmatter":{"path":null,"title":"Azure -  Website Web Hosting Plans","tags":["Azure"]},"fields":{"slug":"/2014/08/24/Azure-Website-Web-Hosting-Plans/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Azure-Website-Web-Hosting-Plans.md"},"previous":{"frontmatter":{"path":null,"title":"Azure - 實作Azure上的AD與MVC進行驗證 - Azure設定篇 ( 二 )","tags":["Active Directory","ASP.NET MVC","Azure"]},"fields":{"slug":"/2014/09/02/Azure-實作Azure上的AD與MVC進行驗證-Azure設定篇-二/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Azure-實作Azure上的AD與MVC進行驗證-Azure設定篇-二.md"}}}}