{"componentChunkName":"component---src-templates-page-js","path":"/2014/02/26/Windows-Azure-建立ASP-NET-MVC專案時，使用Windows-Azure-AD驗證/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Windows Azure - 建立ASP.NET MVC專案時，使用Windows Azure AD驗證","date":"26 February 2014","author":"Sky Chang","excerpt":null,"tags":["Active Directory","ASP.NET MVC","Azure"],"coverImage":null},"id":"a83cb32f-a52c-54e6-bb76-49e88c18ec5d","html":"<p>我們持續前一篇的Windows Azure AD的後續應用，既然提到AD又提到應用程式，大家應該就會想到，要ASP.NET MVC使用Windows Azure AD驗證了，所以這篇，我們就來看看如何執行。</p>\n<p>在開始前，我們可以先看下圖，了解整個的流程。</p>\n<ol>\n<li>用戶請求，來了解要從哪裡去處理身份驗證的訪問權限，所以可以從這個步驟得知，要和Windows Azure AD進行驗證。</li>\n<li>透過Windows Azure AD進行驗證，當然，Windows Azure AD那邊要去建立帳號。</li>\n<li>一旦驗證成功，瀏覽器被重新導向，並且帶這個一個安全令牌（下面的圖形T）。</li>\n<li>然後就拿這個個令牌(Token)進入應用程式。 </li>\n</ol>\n<p> \n<img src=\"http://blogs.msdn.com/resized-image.ashx/__size/550x0/__key/communityserver-blogs-components-weblogfiles/00-00-01-15-70/3823.b.png\"> </p>\n<p>Image source: <a href=\"http://msdn.microsoft.com/en-us/library/windowsazure/dn151790.aspx\">http://msdn.microsoft.com/en-us/library/windowsazure/dn151790.aspx</a></p>\n<p>基本上和Local的AD驗證差不多啦…那該怎麼做呢?其實很簡單…</p>\n<p>首先，我們開啟一個新的ASP.NET MVC的專案，然後選擇變更驗證。</p>\n<p><a href=\"http://lh6.ggpht.com/-ZHHghWqGTFw/Uw4KROQ7YgI/AAAAAAAAIv4/HPGpNhfxHpY/s1600-h/image%25255B4%25255D.png\"><img src=\"http://lh3.ggpht.com/-I7T6MPKMh78/Uw4KSVs_FgI/AAAAAAAAIwA/HnuyQ-6zv1k/image_thumb%25255B2%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>這邊，因為我們要使用的是Windows Azure AD，所以要選擇組織帳戶；接下來，選擇雲端-單一組織(因為小弟我也只有一個阿QQ)；網域的部分，記得要Key Windows Azure AD的網域，小弟這邊因為自己有經過DNS處理了，不然預設的情況下通常是xxx.onmicrosoft.com；存取層級有一些選項可以選，因為我們只需要登入，所以選擇登入就好，如果想要讀寫等功能，可以選擇其他的選項；最後ID URI會自動建立，基本上不用去動( 這個到時候會自動在Windows Azure AD上建立，所以未來也可以自己重新改URI )</p>\n<p><a href=\"http://lh6.ggpht.com/-5Jro7nayUHY/Uw4KTFM7LkI/AAAAAAAAIwI/V4dOC0YClE8/s1600-h/image%25255B9%25255D.png\"><img src=\"http://lh5.ggpht.com/-7k1xis8B2o8/Uw4KT_7nzEI/AAAAAAAAIwQ/3LA7CZr-oGo/image_thumb%25255B5%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>完成之後，就可以看到右下角有組織驗證的選項出現了。</p>\n<p><a href=\"http://lh5.ggpht.com/-QyS0h5-zPN4/Uw4KUk1sK-I/AAAAAAAAIwY/0I6aM8tmvAY/s1600-h/image%25255B14%25255D.png\"><img src=\"http://lh5.ggpht.com/-xufQZ8YTTi8/Uw4KWQaRmaI/AAAAAAAAIwg/vztZrHvE0ps/image_thumb%25255B8%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>是的，其實這樣就完成了… ( 吐菸 )，但實際上做了哪些事情勒!?….</p>\n<p>首先，會於NuGet增加這個Microsoft Token validation的Libary。</p>\n<p><a href=\"http://lh6.ggpht.com/-V-hN6DBSwhM/Uw4KXG63U4I/AAAAAAAAIwo/2OXcMIULpCI/s1600-h/image%25255B19%25255D.png\"><img src=\"http://lh5.ggpht.com/-87p9a2p7_lA/Uw4KX2ZjFOI/AAAAAAAAIww/-Gr7yJczeIk/image_thumb%25255B11%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>然後會在Web.config加上 堆資訊。在Section那邊，加上了identityModel的東西，還有appSettings也加上了ida開頭的東西…</p>\n<p><a href=\"http://lh4.ggpht.com/-Ypb3UXJnZ7s/Uw4KY6JeAbI/AAAAAAAAIw4/7idQ6iNh56E/s1600-h/image%25255B24%25255D.png\"><img src=\"http://lh5.ggpht.com/-LEo1xU3DO_0/Uw4KZlMEG4I/AAAAAAAAIxA/y-zGVtjbGc0/image_thumb%25255B14%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>然後Golbal.asax也增加了IdentityConfig.ConfigureIdentity();還有底下名稱超長的方法。</p>\n<p><a href=\"http://lh4.ggpht.com/-XMYEp9cMgRI/Uw4KaRK48XI/AAAAAAAAIxI/dTxfnBchDyI/s1600-h/image%25255B34%25255D.png\"><img src=\"http://lh4.ggpht.com/-JRNJ9NDC4IQ/Uw4KbBeNNjI/AAAAAAAAIxQ/6IXfrMgt1hg/image_thumb%25255B20%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>此外，也起用了SSL。</p>\n<p><a href=\"http://lh4.ggpht.com/-ViakouxY87Q/Uw4KbnS3Q0I/AAAAAAAAIxY/2BPeX2ZGuDQ/s1600-h/image%25255B29%25255D.png\"><img src=\"http://lh4.ggpht.com/-4ujNtc7zbbA/Uw4KcSF0_rI/AAAAAAAAIxg/uKidTivKjqI/image_thumb%25255B17%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>處此之外，Windows Azure也自動地將此服務建立起來了。</p>\n<p><a href=\"http://lh6.ggpht.com/-x1GU_Bva7xI/Uw4Kc6iIeBI/AAAAAAAAIxo/eDZUIihulk4/s1600-h/image%25255B39%25255D.png\"><img src=\"http://lh4.ggpht.com/-PViBsJGgWJM/Uw4KdkhnufI/AAAAAAAAIxw/rsEDc4wtM8s/image_thumb%25255B23%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>當我們啟用MVC的時候，就可以發現，他自動地跳轉到登入的頁面。</p>\n<p><a href=\"http://lh5.ggpht.com/-EpxLHAyzTrY/Uw4KepXcl3I/AAAAAAAAIx4/VJ6DUns3-xg/s1600-h/SNAGHTML47254d7%25255B5%25255D.png\"><img src=\"http://lh3.ggpht.com/-8KF5N1Jr-5Y/Uw4KfQ1XnhI/AAAAAAAAIyA/NNF_6LB4MSA/SNAGHTML47254d7_thumb%25255B2%25255D.png?imgmax=800\" alt=\"SNAGHTML47254d7\" title=\"SNAGHTML47254d7\"></a></p>\n<p>登入之後，我們就可以從右上角看到，取得了帳號了!!</p>\n<p><a href=\"http://lh4.ggpht.com/-Uifpcu5EyyU/Uw4KgD5NQFI/AAAAAAAAIyI/pNXCicvIsMk/s1600-h/SNAGHTML47373c4%25255B5%25255D.png\"><img src=\"http://lh4.ggpht.com/-N7BhLUDbRY0/Uw4Kg6X-DPI/AAAAAAAAIyQ/rzYXa02lDiE/SNAGHTML47373c4_thumb%25255B2%25255D.png?imgmax=800\" alt=\"SNAGHTML47373c4\" title=\"SNAGHTML47373c4\"></a></p>\n<p>初步就先到這邊吧，下一篇，會介紹一下，如果已經有應用程式了，該怎樣啟動此功能!!</p>\n<h4>參考資料</h4>\n<ul>\n<li><a href=\"http://blogs.msdn.com/b/mvpawardprogram/archive/2014/01/20/identity-in-your-own-apps-with-windows-azure-active-directory.aspx\" title=\"http://blogs.msdn.com/b/mvpawardprogram/archive/2014/01/20/identity-in-your-own-apps-with-windows-azure-active-directory.aspx\">http://blogs.msdn.com/b/mvpawardprogram/archive/2014/01/20/identity-in-your-own-apps-with-windows-azure-active-directory.aspx</a></li>\n<li><a href=\"http://www.cloudidentity.com/blog/2013/12/11/setting-up-an-asp-net-project-with-organizational-authentication-requires-an-organizational-account/\" title=\"http://www.cloudidentity.com/blog/2013/12/11/setting-up-an-asp-net-project-with-organizational-authentication-requires-an-organizational-account/\">http://www.cloudidentity.com/blog/2013/12/11/setting-up-an-asp-net-project-with-organizational-authentication-requires-an-organizational-account/</a></li>\n</ul>","excerpt":"我們持續前一篇的Windows Azure AD的後續應用，既然提到AD又提到應用程式，大家應該就會想到，要ASP.NET MVC使用Windows Azure AD…"}},"pageContext":{"type":"posts","next":{"frontmatter":{"path":null,"title":"Windows Azure -  整合Office 365的AD目錄","tags":["Active Directory","Azure","Office"]},"fields":{"slug":"/2014/02/10/Windows-Azure-整合Office-365的AD目錄/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Windows-Azure-整合Office-365的AD目錄.md"},"previous":{"frontmatter":{"path":null,"title":"Azure - Web Site 的豆知識","tags":["Azure"]},"fields":{"slug":"/2014/03/27/Azure-Web-Site-的豆知識/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Azure-Web-Site-的豆知識.md"}}}}