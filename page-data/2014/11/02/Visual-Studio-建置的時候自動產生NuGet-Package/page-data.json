{"componentChunkName":"component---src-templates-page-js","path":"/2014/11/02/Visual-Studio-建置的時候自動產生NuGet-Package/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Visual Studio - 建置的時候自動產生NuGet Package","date":"02 November 2014","author":"Sky Chang","excerpt":null,"tags":["NuGet","Visual Studio"],"coverImage":null},"id":"7e669b6d-7bdb-5c8b-bdfc-33ae8db06994","html":"<p>最近因為在寫一些Framwork給公司使用，雖然透過DLL直接給大家用也很方便，但畢竟這個時代，已經是NuGet的時代了，所以理想的情況下，還是放在NuGet上，比較方便 ( 當然，給公司用的Framework是自行架立的NuGet私服… )</p>\n<p>而建立NuGet Package的過程中，我們可以透過NuGet的指令，或是NuGet Package Exploer，但NuGet指令要準備一堆東西…而NuGet Package Exploer則會遇到相依信套件要自己塞的窘境…而最最最理想的就是透過MSBuild的過程中，自動產生NuGet Package；這樣才符合懶人Sky的形象~~</p>\n<p>所以去網路上找了一下，有些人有寫了一些套件，有些人有準備了一些專案，但還是看到這篇最符合小弟…( 原文連結在底下… )，所以就在這邊敘述一下過程。</p>\n<p>首先，必須先啟用NuGet套件還原，是的，大家沒看錯，就是套件還原；這邊會使用套件還原的原因是因為，我們透過套件還原這個功能，可以幫我們把參數都給設定好，所以幾乎都不用做甚麼事情了… ( 懶人指數 + 1 )。</p>\n<p><a href=\"http://lh4.ggpht.com/-ca6EEe8xrqs/VFXIpbcRd5I/AAAAAAAAKNc/v-nDIRWn3dg/s1600-h/image%25255B3%25255D.png\"><img src=\"http://lh5.ggpht.com/-EAQG1l_8mIY/VFXIqdw-YtI/AAAAAAAAKNk/RI7oPBg94To/image_thumb%25255B1%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>而套件還原功能開啟之後，還必須先隨便的使用NuGet下載任一套件，並且編輯，小弟這邊下載的是Json.Net。</p>\n<p>為什麼要隨便下載一個套件勒!?，原因很簡單，因為<font color=\"#ff0000\">你隨便下載一個套件之後，並且重Build</font>，他才會自動的在專案檔下加入必要的參數。</p>\n<p>加入的項目如下，基本上裡面的參數都是和套件還原有關的。</p>\n<p><a href=\"http://lh6.ggpht.com/-tQDBjTRGYLg/VFXIrT8Lc3I/AAAAAAAAKNs/ZDRLzm83Z34/s1600-h/image%25255B7%25255D.png\"><img src=\"http://lh4.ggpht.com/-_rtQfYkgk_o/VFXIsacFH8I/AAAAAAAAKN0/49zOjCnFXow/image_thumb%25255B3%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>如下圖，我們可以看到，預設情況下，幫我們增加了NuGet的相關參數。</p>\n<p><a href=\"http://lh4.ggpht.com/-f4_HY7Sf2pQ/VFXItRFh5lI/AAAAAAAAKN8/1DJNN4bjk8A/s1600-h/image%25255B12%25255D.png\"><img src=\"http://lh3.ggpht.com/-9s5emf3XuRo/VFXIuW7sQ2I/AAAAAAAAKOA/404S7fViw5E/image_thumb%25255B6%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>而實際上，到上面為止，都是處於套件還原的功能，所以我們要在專案檔這邊，加入BuildPackage的標籤，並且改為true；沒錯，就是這樣而已，這樣就可以了!!</p>\n<p><a href=\"http://lh4.ggpht.com/-EQdTxZJH0y8/VFXIu1b79yI/AAAAAAAAKOM/kJERfJXZAVM/s1600-h/image%25255B16%25255D.png\"><img src=\"http://lh3.ggpht.com/-vv0F08iZ4oA/VFXIv77S68I/AAAAAAAAKOU/yOzlydb1AUU/image_thumb%25255B8%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>這邊是原始的專案xml，有興趣的大家可以自由貼上。</p>\n<pre class=\"brush: xml;\">&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;Project ToolsVersion=\"12.0\" DefaultTargets=\"Build\" xmlns=\"http://schemas.microsoft.com/developer/msbuild/2003\"&gt;\n  &lt;Import Project=\"$(MSBuildExtensionsPath)\\$(MSBuildToolsVersion)\\Microsoft.Common.props\" Condition=\"Exists('$(MSBuildExtensionsPath)\\$(MSBuildToolsVersion)\\Microsoft.Common.props')\" /&gt;\n  &lt;PropertyGroup&gt;\n    &lt;Configuration Condition=\" '$(Configuration)' == '' \"&gt;Debug&lt;/Configuration&gt;\n    &lt;Platform Condition=\" '$(Platform)' == '' \"&gt;AnyCPU&lt;/Platform&gt;\n    &lt;ProjectGuid&gt;{42ED14CC-0FAD-452C-966B-B484FE6BEDC2}&lt;/ProjectGuid&gt;\n    &lt;OutputType&gt;Library&lt;/OutputType&gt;\n    &lt;AppDesignerFolder&gt;Properties&lt;/AppDesignerFolder&gt;\n    &lt;RootNamespace&gt;ClassLibrary2&lt;/RootNamespace&gt;\n    &lt;AssemblyName&gt;ClassLibrary2&lt;/AssemblyName&gt;\n    &lt;TargetFrameworkVersion&gt;v4.5.1&lt;/TargetFrameworkVersion&gt;\n    &lt;FileAlignment&gt;512&lt;/FileAlignment&gt;\n    &lt;SolutionDir Condition=\"$(SolutionDir) == '' Or $(SolutionDir) == '*Undefined*'\"&gt;..\\&lt;/SolutionDir&gt;\n    &lt;RestorePackages&gt;true&lt;/RestorePackages&gt;\n    &lt;BuildPackage&gt;true&lt;/BuildPackage&gt;\n  &lt;/PropertyGroup&gt;\n  &lt;PropertyGroup Condition=\" '$(Configuration)|$(Platform)' == 'Debug|AnyCPU' \"&gt;\n    &lt;DebugSymbols&gt;true&lt;/DebugSymbols&gt;\n    &lt;DebugType&gt;full&lt;/DebugType&gt;\n    &lt;Optimize&gt;false&lt;/Optimize&gt;\n    &lt;OutputPath&gt;bin\\Debug\\&lt;/OutputPath&gt;\n    &lt;DefineConstants&gt;DEBUG;TRACE&lt;/DefineConstants&gt;\n    &lt;ErrorReport&gt;prompt&lt;/ErrorReport&gt;\n    &lt;WarningLevel&gt;4&lt;/WarningLevel&gt;\n  &lt;/PropertyGroup&gt;\n  &lt;PropertyGroup Condition=\" '$(Configuration)|$(Platform)' == 'Release|AnyCPU' \"&gt;\n    &lt;DebugType&gt;pdbonly&lt;/DebugType&gt;\n    &lt;Optimize&gt;true&lt;/Optimize&gt;\n    &lt;OutputPath&gt;bin\\Release\\&lt;/OutputPath&gt;\n    &lt;DefineConstants&gt;TRACE&lt;/DefineConstants&gt;\n    &lt;ErrorReport&gt;prompt&lt;/ErrorReport&gt;\n    &lt;WarningLevel&gt;4&lt;/WarningLevel&gt;\n  &lt;/PropertyGroup&gt;\n  &lt;ItemGroup&gt;\n    &lt;Reference Include=\"Newtonsoft.Json, Version=6.0.0.0, Culture=neutral, PublicKeyToken=30ad4fe6b2a6aeed, processorArchitecture=MSIL\"&gt;\n      &lt;SpecificVersion&gt;False&lt;/SpecificVersion&gt;\n      &lt;HintPath&gt;..\\packages\\Newtonsoft.Json.6.0.6\\lib\\net45\\Newtonsoft.Json.dll&lt;/HintPath&gt;\n    &lt;/Reference&gt;\n    &lt;Reference Include=\"System\" /&gt;\n    &lt;Reference Include=\"System.Core\" /&gt;\n    &lt;Reference Include=\"System.Xml.Linq\" /&gt;\n    &lt;Reference Include=\"System.Data.DataSetExtensions\" /&gt;\n    &lt;Reference Include=\"Microsoft.CSharp\" /&gt;\n    &lt;Reference Include=\"System.Data\" /&gt;\n    &lt;Reference Include=\"System.Xml\" /&gt;\n  &lt;/ItemGroup&gt;\n  &lt;ItemGroup&gt;\n    &lt;Compile Include=\"Class1.cs\" /&gt;\n    &lt;Compile Include=\"Properties\\AssemblyInfo.cs\" /&gt;\n  &lt;/ItemGroup&gt;\n  &lt;ItemGroup&gt;\n    &lt;None Include=\"packages.config\" /&gt;\n  &lt;/ItemGroup&gt;\n  &lt;Import Project=\"$(MSBuildToolsPath)\\Microsoft.CSharp.targets\" /&gt;\n  &lt;Import Project=\"$(SolutionDir)\\.nuget\\NuGet.targets\" Condition=\"Exists('$(SolutionDir)\\.nuget\\NuGet.targets')\" /&gt;\n  &lt;Target Name=\"EnsureNuGetPackageBuildImports\" BeforeTargets=\"PrepareForBuild\"&gt;\n    &lt;PropertyGroup&gt;\n      &lt;ErrorText&gt;此專案參照此電腦中缺少的  NuGet 套件。啟用「NuGet 套件還原」\n      以便下載。如需詳細資訊，請參閱 http://go.microsoft.com/fwlink/?LinkID=322105。缺少的檔案為 {0}。&lt;/ErrorText&gt;\n    &lt;/PropertyGroup&gt;\n    &lt;Error Condition=\"!Exists('$(SolutionDir)\\.nuget\\NuGet.targets')\" Text=\"$([System.String]::Format('$(ErrorText)', '$(SolutionDir)\\.nuget\\NuGet.targets'))\" /&gt;\n  &lt;/Target&gt;\n  &lt;!-- To modify your build process, add your task inside one of the targets below and uncomment it. \n       Other similar extension points exist, see Microsoft.Common.targets.\n  &lt;Target Name=\"BeforeBuild\"&gt;\n  &lt;/Target&gt;\n  &lt;Target Name=\"AfterBuild\"&gt;\n  &lt;/Target&gt;\n  --&gt;\n&lt;/Project&gt;\n</pre>\n<p>當加入那行之後，我們重新Build後，就可以在bin底下的debug看到nupkg的檔案產生了!!其中symbols是提供偵錯用途的，裡面包含了source喔~</p>\n<p><a href=\"http://lh4.ggpht.com/-oCB_3QNPGuk/VFXIwmjwE_I/AAAAAAAAKOc/-ec9YHVJz94/s1600-h/image%25255B19%25255D.png\"><img src=\"http://lh5.ggpht.com/-uAdY2_fN5e0/VFXIxtl1hwI/AAAAAAAAKOk/6JwZyFMnw4I/image_thumb%25255B9%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>第一步驟就到這邊，就是那麼簡單~~</p>\n<p>參考資料</p>\n<ul>\n<li><a href=\"http://ihadthisideaonce.com/2014/02/24/nuget-like-a-pro-the-msbuild-way/\" title=\"http://ihadthisideaonce.com/2014/02/24/nuget-like-a-pro-the-msbuild-way/\">http://ihadthisideaonce.com/2014/02/24/nuget-like-a-pro-the-msbuild-way/</a></li>\n</ul>","excerpt":"最近因為在寫一些Framwork給公司使用，雖然透過DLL直接給大家用也很方便，但畢竟這個時代，已經是NuGet的時代了，所以理想的情況下，還是放在NuGet上，比較方便 ( 當然，給公司用的Framework是自行架立的NuGet私服… ) 而建立NuGet Package…"}},"pageContext":{"type":"posts","next":{"frontmatter":{"path":null,"title":"紀錄文 - Windows 10 Technical Preview","tags":["Sky的IT碎碎念","Windows"]},"fields":{"slug":"/2014/10/04/紀錄文-Windows-10-Technical-Preview/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/紀錄文-Windows-10-Technical-Preview.md"},"previous":{"frontmatter":{"path":null,"title":"Visual Studio - 使用Nuspec來自動產生NuGet Package","tags":["NuGet","Visual Studio"]},"fields":{"slug":"/2014/11/02/Visual-Studio-使用Nuspec來自動產生NuGet-Package/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Visual-Studio-使用Nuspec來自動產生NuGet-Package.md"}}}}