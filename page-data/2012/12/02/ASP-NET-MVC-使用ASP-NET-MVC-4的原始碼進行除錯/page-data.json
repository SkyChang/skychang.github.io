{"componentChunkName":"component---src-templates-page-js","path":"/2012/12/02/ASP-NET-MVC-使用ASP-NET-MVC-4的原始碼進行除錯/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"ASP.NET MVC - 使用ASP.NET MVC 4的原始碼進行除錯","date":"02 December 2012","author":"Sky Chang","excerpt":null,"tags":["ASP.NET MVC"],"coverImage":null},"id":"5c3a61ec-833e-55ca-9bdb-e0f85f2fad62","html":"<p>當然，這篇也不是甚麼大新聞了，如果常追蹤一些前輩Blog的人，因該已經有很多類似的文章，例如<a href=\"http://blog.darkthread.net/post-2011-04-09-trace-asp-net-mvc-3-source.aspx\">黑暗大大</a>、<a href=\"http://blog.miniasp.com/post/2009/02/ASPNET-MVC-Developer-Note-Part-2.aspx\">保哥</a>、<a href=\"http://blog.kkbruce.net/2011/04/aspnet-mvc-3-rtm.html#.ULtNWtd2Jbo\">KKBruce哥</a>、<a href=\"http://kevintsengtw.blogspot.tw/2012/09/aspnet-mvc-3-aspnet-mvc-3.html#.ULtNXtd2Jbo\">Kevin哥</a>，都寫得詳細到爆炸。</p>\n<p>但是小弟基於自己筆記自己紀錄的立場XDD，所以還是稍微紀錄一下自己的過程。</p>\n<p>首先，我們要先下載Source Code，可以到<a href=\"http://aspnetwebstack.codeplex.com/SourceControl/changeset/view/ae31d2579b9a\">這邊下載</a>。</p>\n<p><a href=\"http://lh3.ggpht.com/-G6DR2gPdNVU/ULtfUULGhZI/AAAAAAAAFfw/J6HqbbRDuvc/s1600-h/image%25255B4%25255D.png\"><img src=\"http://lh4.ggpht.com/-d93ZjmXwVMg/ULtfVSlDIeI/AAAAAAAAFf4/_6te9ZZocyo/image_thumb%25255B2%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>如果有使用Git的人，也可以使用Git來進行下載，沒使用Git的人可以跳過這段落，直接按上面的連結就可以，並直接跳過此段，看後面的步驟；如果有使用Git的人，我們可以使用以下命令，把Source Code下載回Local端。</p>\n<blockquote>\n<pre>git clone [https://git01.codeplex.com/aspnetwebstack.git](https://git01.codeplex.com/aspnetwebstack.git)</pre>\n</blockquote>\n<p>而clone後面接的網址，可以從ASP.NET CodePlex專案的頁面得知。</p>\n<p><a href=\"http://lh4.ggpht.com/-vBC1NXxonbc/ULtfWuuSWJI/AAAAAAAAFgA/DH5LOhtV2ZE/s1600-h/image%25255B8%25255D.png\"><img src=\"http://lh5.ggpht.com/-WNxqt87PsvE/ULtfXr5jWXI/AAAAAAAAFgI/j8quPvDurcg/image_thumb%25255B4%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>下載完成後，我們要的專案，主要都在src這個目錄下。</p>\n<p><a href=\"http://lh6.ggpht.com/-_L65ggQwWXk/ULtfYpmoJuI/AAAAAAAAFgM/-of21XyOrpg/s1600-h/image%25255B12%25255D.png\"><img src=\"http://lh6.ggpht.com/-aY9qB8A6XpI/ULtfZeLVNWI/AAAAAAAAFgY/NDaXCoz6CKI/image_thumb%25255B6%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，我們就可以開一個專案，無論是要用空白專案範本，或是網際網路專案範本，或是現在開發中的專案 ( 只要心臟夠大顆的話= =+ )都可以來進行Trace；我們只要在要進行Trace的方案上面，使用加入現有專案。</p>\n<p><a href=\"http://lh6.ggpht.com/-AFT_Rc5oJsw/ULtfaXBFmtI/AAAAAAAAFgg/E5tDqAs8XZ8/s1600-h/image%25255B17%25255D.png\"><img src=\"http://lh3.ggpht.com/-h5df6aReJX4/ULtfb7lUYJI/AAAAAAAAFgo/tb9WGk_6oT8/image_thumb%25255B9%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>主要準備加入的是以下五個專案：</p>\n<ul>\n<li>System.Web.Mvc<li>System.Web.Razor<li>System.Web.WebPages<li>System.Web.WebPages.Deployment<li>System.Web.WebPages.Razor</li>\n</ul>\n<p>不過，事情就是沒想想中的順利= =…</p>\n<p><a href=\"http://lh3.ggpht.com/-GSZR5ct8gOI/ULtfcvy9ccI/AAAAAAAAFgw/LC1sXac9A4Q/s1600-h/image%25255B21%25255D.png\"><img src=\"http://lh3.ggpht.com/-oxM4sheNmng/ULtfd9MkdXI/AAAAAAAAFg4/O0gJ1A8h5Go/image_thumb%25255B11%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>加入的時候，可能會碰到這個問題，主要是因為現在的MVC Source Code也有用到NuGet了，而且有使用到NuGet的套件還原功能，而目前我們準備的專案(MvcApplication2)還沒啟用此功能。錯誤訊息如下：</p>\n<blockquote>\n<p>找不到匯入的專案 \"c:\\xxx.nuget\\nuget.targets\"`。請確認&#x3C;Import>宣告中的路徑正確，而且檔案存在磁碟上。c:\\xxx\\src\\System.Web.Mvc\\System.Web.Mvc.csproj</p>\n</blockquote>\n<p><a href=\"http://lh3.ggpht.com/-E2LMheLlHCA/ULtfe84okjI/AAAAAAAAFhA/GlAncBGSogM/s1600-h/image%25255B25%25255D.png\"><img src=\"http://lh3.ggpht.com/-A98Sin8GRH4/ULtff5QM6oI/AAAAAAAAFhI/w3u-fNsRzIU/image_thumb%25255B13%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>這時候，我們只要去方案的地方，啟用NuGet套件還原。</p>\n<p><a href=\"http://lh5.ggpht.com/-nLscUpTn74E/ULtfg43q4PI/AAAAAAAAFhQ/vTHGzSRIGFQ/s1600-h/image%25255B29%25255D.png\"><img src=\"http://lh6.ggpht.com/-ePTMoUQ98bg/ULtfh0VHc5I/AAAAAAAAFhY/XQM_RB8PJCk/image_thumb%25255B15%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>完成後，就可以看到NuGet.targets已經加上去了。</p>\n<p><a href=\"http://lh3.ggpht.com/-m6s6hKSQ3Io/ULtfjP6rIZI/AAAAAAAAFhc/NqZj8cVDGSg/s1600-h/image%25255B33%25255D.png\"><img src=\"http://lh6.ggpht.com/-e2dH6x6IVlY/ULtfkCCySyI/AAAAAAAAFho/SQNu5FyQ3x4/image_thumb%25255B17%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>在一次，就可以順利加上去了。</p>\n<p><a href=\"http://lh4.ggpht.com/-SdYUykPWyjI/ULtflPuYmbI/AAAAAAAAFhs/ubiJ_QANiNQ/s1600-h/image%25255B37%25255D.png\"><img src=\"http://lh5.ggpht.com/-Uri3DkAtyiI/ULtfmFdJDCI/AAAAAAAAFh4/xU7nhX9j17A/image_thumb%25255B19%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，我們要把MvcApplication2原本參考的dll移除，換上我們剛剛加的專案。( 因為MvcApplication2的參考太長，所以下圖是新開了一個MvcApplicaiton1的專案來解釋。 )；一樣移除那五個。</p>\n<p><a href=\"http://lh3.ggpht.com/-WFdQeZ84r6E/ULtfnJqvtQI/AAAAAAAAFiA/hf_HOE8b9-o/s1600-h/image%25255B41%25255D.png\"><img src=\"http://lh6.ggpht.com/-9xk21fpMj7g/ULtfoJW-nNI/AAAAAAAAFiI/E-VvZojy6BE/image_thumb%25255B21%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，我們把剛剛加入進來的專案，參考進來。</p>\n<p><a href=\"http://lh4.ggpht.com/-bFds8y4mSVo/ULtfpRaXuaI/AAAAAAAAFiQ/e9Gdnj0rFSs/s1600-h/image%25255B45%25255D.png\"><img src=\"http://lh4.ggpht.com/-PO5MSzU4uBs/ULtfqoAu9LI/AAAAAAAAFiY/l-8ITiMKnGs/image_thumb%25255B23%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，我們要修改View目錄底下的web.config。</p>\n<p><a href=\"http://lh4.ggpht.com/-jmdA_0XFKmI/ULtfr3j5JhI/AAAAAAAAFig/jBGqwufBBR4/s1600-h/image%25255B49%25255D.png\"><img src=\"http://lh3.ggpht.com/-HyGn9RR773E/ULtfst5B1aI/AAAAAAAAFik/GpnSROofzI8/image_thumb%25255B25%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>原本是長這樣( web.config後面不重要的就省略了 )</p>\n<pre class=\"brush: xml;\">&lt;?xml version=\"1.0\"?&gt;\n\n&lt;configuration&gt;\n  &lt;configSections&gt;\n    &lt;sectionGroup name=\"system.web.webPages.razor\" type=\"System.Web.WebPages.Razor.Configuration.RazorWebSectionGroup, System.Web.WebPages.Razor, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35\"&gt;\n      &lt;section name=\"host\" type=\"System.Web.WebPages.Razor.Configuration.HostSection, System.Web.WebPages.Razor, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35\" requirePermission=\"false\" /&gt;\n      &lt;section name=\"pages\" type=\"System.Web.WebPages.Razor.Configuration.RazorPagesSection, System.Web.WebPages.Razor, Version=2.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35\" requirePermission=\"false\" /&gt;\n    &lt;/sectionGroup&gt;\n  &lt;/configSections&gt;\n\n  &lt;system.web.webPages.razor&gt;\n    &lt;host factoryType=\"System.Web.Mvc.MvcWebRazorHostFactory, System.Web.Mvc, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35\" /&gt;\n    &lt;pages pageBaseType=\"System.Web.Mvc.WebViewPage\"&gt;\n      &lt;namespaces&gt;\n        &lt;add namespace=\"System.Web.Mvc\" /&gt;\n        &lt;add namespace=\"System.Web.Mvc.Ajax\" /&gt;\n        &lt;add namespace=\"System.Web.Mvc.Html\" /&gt;\n        &lt;add namespace=\"System.Web.Optimization\"/&gt;\n        &lt;add namespace=\"System.Web.Routing\" /&gt;\n      &lt;/namespaces&gt;\n    &lt;/pages&gt;\n  &lt;/system.web.webPages.razor&gt;\n</pre>\n<p>而現在，我們要修改如下圖這四個地方，從逗點，把Version、Culture、PublicKeyToken通通移除。(最後面的引號要留下喔!!)</p>\n<p><a href=\"http://lh4.ggpht.com/-gQw7cMpLlUs/ULtfto86-6I/AAAAAAAAFis/KJQpxlOojXw/s1600-h/image%25255B57%25255D.png\"><img src=\"http://lh4.ggpht.com/-BgTJWViRPaM/ULtfumy-7EI/AAAAAAAAFi4/g1RIcks51t8/image_thumb%25255B29%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>改完後，web.config變成這樣</p>\n<pre class=\"brush: xml;\">&lt;?xml version=\"1.0\"?&gt;\n\n&lt;configuration&gt;\n  &lt;configSections&gt;\n    &lt;sectionGroup name=\"system.web.webPages.razor\" \n                  type=\"System.Web.WebPages.Razor.Configuration.RazorWebSectionGroup, \n                  System.Web.WebPages.Razor\"&gt;\n      &lt;section name=\"host\" \n               type=\"System.Web.WebPages.Razor.Configuration.HostSection, \n               System.Web.WebPages.Razor\" \n               requirePermission=\"false\" /&gt;\n      &lt;section name=\"pages\" \n               type=\"System.Web.WebPages.Razor.Configuration.RazorPagesSection, \n               System.Web.WebPages.Razor\" \n               requirePermission=\"false\" /&gt;\n    &lt;/sectionGroup&gt;\n  &lt;/configSections&gt;\n\n  &lt;system.web.webPages.razor&gt;\n    &lt;host factoryType=\"System.Web.Mvc.MvcWebRazorHostFactory, \n          System.Web.Mvc\" /&gt;\n    &lt;pages pageBaseType=\"System.Web.Mvc.WebViewPage\"&gt;\n      &lt;namespaces&gt;\n        &lt;add namespace=\"System.Web.Mvc\" /&gt;\n        &lt;add namespace=\"System.Web.Mvc.Ajax\" /&gt;\n        &lt;add namespace=\"System.Web.Mvc.Html\" /&gt;\n        &lt;add namespace=\"System.Web.Optimization\"/&gt;\n        &lt;add namespace=\"System.Web.Routing\" /&gt;\n      &lt;/namespaces&gt;\n    &lt;/pages&gt;\n  &lt;/system.web.webPages.razor&gt;\n</pre>\n<p>就如同下圖：</p>\n<p><a href=\"http://lh4.ggpht.com/-_NUP_h3GN3o/ULtfvdhH7nI/AAAAAAAAFjA/ccgW9sCLGgA/s1600-h/image%25255B61%25255D.png\"><img src=\"http://lh5.ggpht.com/--UGMq3gRrdg/ULtfwijn2fI/AAAAAAAAFjI/rUkRHzDu5oo/image_thumb%25255B31%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>而之前MVC 3的時代，還需要修改根目錄的web.config，現在不用修改了；所以改到這邊就算完成了。</p>\n<p>另外，如果打開任何一個View，可能會發現，有許多的小蚯蚓。</p>\n<p><a href=\"http://lh6.ggpht.com/-W_pNABgt7aM/ULtfxlhQXZI/AAAAAAAAFjQ/-hoB_Jk63Xw/s1600-h/image%25255B65%25255D.png\"><img src=\"http://lh3.ggpht.com/-WSaes0xEbnc/ULtfy3zUEVI/AAAAAAAAFjY/m_IKgywf_fY/image_thumb%25255B33%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>關於這個問題，<a href=\"http://blog.miniasp.com/\">保哥</a>有在MSDN反映過，最簡單的方法，就是在每個View上Using進來，大家可以參考<a href=\"http://forums.asp.net/t/1857937.aspx/1?How+to+debug+asp+net+mvc+4+source+code+with+Intellisense+enabled+\">這篇</a>。</p>\n<h4>後記</h4>\n<p>其實和各個前輩所寫的內容大同小異，也很感謝之前就有很多前輩分享過，而最近剛好想看一下MVC 4的Source Code，所以也順便把MVC 4的Source Code使用過程簡單整理一下，也希望讓真的有遇到問題的人，可以節省尋找解法的時間。</p>\n<h4>參考網址</h4>\n<ul>\n<li><a href=\"http://blog.darkthread.net/post-2011-04-09-trace-asp-net-mvc-3-source.aspx\" title=\"http://blog.darkthread.net/post-2011-04-09-trace-asp-net-mvc-3-source.aspx\">http://blog.darkthread.net/post-2011-04-09-trace-asp-net-mvc-3-source.aspx</a><li><a href=\"http://blog.kkbruce.net/2011/04/aspnet-mvc-3-rtm.html#.ULtNWtd2Jbo\" title=\"http://blog.kkbruce.net/2011/04/aspnet-mvc-3-rtm.html#.ULtNWtd2Jbo\">http://blog.kkbruce.net/2011/04/aspnet-mvc-3-rtm.html#.ULtNWtd2Jbo</a><li><a href=\"http://kevintsengtw.blogspot.tw/2012/09/aspnet-mvc-3-aspnet-mvc-3.html#.ULtNXtd2Jbo\" title=\"http://kevintsengtw.blogspot.tw/2012/09/aspnet-mvc-3-aspnet-mvc-3.html#.ULtNXtd2Jbo\">http://kevintsengtw.blogspot.tw/2012/09/aspnet-mvc-3-aspnet-mvc-3.html#.ULtNXtd2Jbo</a><li><a href=\"http://blog.miniasp.com/post/2009/02/ASPNET-MVC-Developer-Note-Part-2.aspx\" title=\"http://blog.miniasp.com/post/2009/02/ASPNET-MVC-Developer-Note-Part-2.aspx\">http://blog.miniasp.com/post/2009/02/ASPNET-MVC-Developer-Note-Part-2.aspx</a><li><a href=\"http://forums.asp.net/t/1857937.aspx/1?How+to+debug+asp+net+mvc+4+source+code+with+Intellisense+enabled+\" title=\"http://forums.asp.net/t/1857937.aspx/1?How+to+debug+asp+net+mvc+4+source+code+with+Intellisense+enabled+\">http://forums.asp.net/t/1857937.aspx/1?How+to+debug+asp+net+mvc+4+source+code+with+Intellisense+enabled+</a><li><a href=\"http://vibrantcode.com/2012/06/06/look-ma-no-gac/\" title=\"http://vibrantcode.com/2012/06/06/look-ma-no-gac/\">http://vibrantcode.com/2012/06/06/look-ma-no-gac/</a></li>\n</ul>","excerpt":"當然，這篇也不是甚麼大新聞了，如果常追蹤一些前輩Blog的人，因該已經有很多類似的文章，例如黑暗大大、保哥、KKBruce哥、Kevin哥，都寫得詳細到爆炸。 但是小弟基於自己筆記自己紀錄的立場XDD，所以還是稍微紀錄一下自己的過程。 首先，我們要先下載Source Code…"}},"pageContext":{"type":"posts","next":{"frontmatter":{"path":null,"title":"Windows Azure - 升級Cloud Service到Windows Server 2012","tags":["Azure","Windows Server"]},"fields":{"slug":"/2012/11/27/Windows-Azure-升級Cloud-Service到Windows-Server-2012/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Windows-Azure-升級Cloud-Service到Windows-Server-2012.md"},"previous":{"frontmatter":{"path":null,"title":"Visual Studio -  超強的程式碼分析功能Code Map","tags":["Visual Studio"]},"fields":{"slug":"/2012/12/02/Visual-Studio-超強的程式碼分析功能Code-Map/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Visual-Studio-超強的程式碼分析功能Code-Map.md"}}}}