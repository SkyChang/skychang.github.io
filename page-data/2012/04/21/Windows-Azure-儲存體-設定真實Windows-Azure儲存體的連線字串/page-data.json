{"componentChunkName":"component---src-templates-page-js","path":"/2012/04/21/Windows-Azure-儲存體-設定真實Windows-Azure儲存體的連線字串/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Windows Azure 儲存體 -  設定真實Windows Azure儲存體的連線字串","date":"21 April 2012","author":"Sky Chang","excerpt":null,"tags":["Azure","Visual Studio"],"coverImage":null},"id":"040f245c-e62d-526f-bc3e-4ae836f3a529","html":"<p>如<a href=\"http://studyhost.blogspot.com/\">Davia</a>老師所說，當開始繳錢，使用Windows Azure後，第一個會遇到的問題一定就是連線字串的問題；我們在本機模擬的時候，其實都不會考慮到這些問題，但當程式發佈到雲端後，總不可能還在繼續存取我們本地端的Storage吧，所以我們這時候，就必須設定真正在雲端上的連線字串；老實說，這部分其實也不困難啦，但是有一些梅梅角角的地方，相信有圖好做事，所以就在這邊紀錄一下。</p>\n<h4>開始設定</h4>\n<p>首先，我們要先設定連線字串，選擇Azure的服務定義檔 ( 這邊是WebApplicationRole )，然後選擇屬性。</p>\n<p><a href=\"http://lh3.ggpht.com/-BsRwCSVI4tQ/T5JI2Y1nzCI/AAAAAAAACUc/2_Ruh3G8f0w/s1600-h/image%25255B9%25255D.png\"><img src=\"http://lh5.ggpht.com/-EOWUGlQLAtU/T5JI3SJN0_I/AAAAAAAACUk/ArrIZqnryCo/image_thumb%25255B5%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，我們就可以看到整個貼心的設定畫面；我們選擇第二個設定，然後\"服務組態\"的地方，要選擇\"所有組態\"，接下來，再按下加入設定。( 這邊要注意一下，如果服務組態的地方，不是所有組態，那就沒辦法進行加入與移除的動作。 )</p>\n<p><a href=\"http://lh6.ggpht.com/-6qXLRMep2uo/T5JI4QL6WpI/AAAAAAAACUs/A4uQVjUgUr4/s1600-h/image%25255B14%25255D.png\"><img src=\"http://lh4.ggpht.com/-0ItYJAgnHy0/T5JI5wfy6wI/AAAAAAAACU0/3Hr0w7koBp0/image_thumb%25255B8%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>按下加入設定後，會出現新的設定框，我們先給個好記的名稱，這裡小弟就使用TestConnectionString當名稱吧，然後\"類型\"要選擇\"連線字串\"，最後再按一下旁邊的\"…按鈕\"。( 或許有人會想把預設的Microsoft.WindowsAzure.Plugins.Diagnostics.ConnectionString刪除，但建議不要這麼做，這個連線字串是拿來偵錯使用的。 )</p>\n<p><a href=\"http://lh6.ggpht.com/-Dt6p2Y8xJuU/T5JI6ixxGdI/AAAAAAAACU4/7uX13Bot4S8/s1600-h/image%25255B19%25255D.png\"><img src=\"http://lh5.ggpht.com/-JiL74E4mC9o/T5JI7gOo6tI/AAAAAAAACVE/lC4k3v76k-c/image_thumb%25255B11%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>然後他會出現儲存體帳戶連接字串對話框，我們要選擇\"輸入儲存體帳戶認證\"，然後Key上\"帳戶名稱\"和\"帳戶金鑰\"，那這兩個值在哪邊呢，繼續看下去。</p>\n<p><a href=\"http://lh3.ggpht.com/-sGQbhDAHwuo/T5JI8nH-KSI/AAAAAAAACVM/TOjd3oeVZXI/s1600-h/image%25255B24%25255D.png\"><img src=\"http://lh4.ggpht.com/-91FhzCns66M/T5JI97Rm_1I/AAAAAAAACVU/UCkr9Ooh1_I/image_thumb%25255B14%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>帳戶金鑰的位置，就從\"儲存體帳號\"，選擇好要\"儲存的儲存體\"，然後右邊會有一個\"主要存取金鑰\"，按下\"檢視\"，就會跳出\"檢視儲存體存取金鑰對話框\"，按下最右邊的\"複製按鈕\"，Silverlight就會幫忙複製起來；而右邊的\"名稱\"，其實就是帳號；我們把這兩個值，填入到上面的對話框，就完成了!</p>\n<p><a href=\"http://lh4.ggpht.com/-n1OD0c2GkA0/T5JI_WXAfeI/AAAAAAAACVc/QOKVrnt8Jq0/s1600-h/image%25255B29%25255D.png\"><img src=\"http://lh4.ggpht.com/-W4yqUNXlURM/T5JJBFOx7yI/AAAAAAAACVk/_AM8bI_XmGc/image_thumb%25255B17%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<h4>讓Local和Azure使用不同的儲存體</h4>\n<p>聰明的你，一定會發現一件事情!沒錯，現在這樣設定的話，Local測試的時候，也會變成要去存取雲端的Storage，所以我們要再做一個簡單的修改，讓Local和Azure使用相同名稱，但連線內容不同的設定檔。</p>\n<p>我們回到剛剛設定連線字串的頁面，這次我們將\"服務組態\"設定成Local，並且按一下TestConnectionString的\"…按鈕\"。</p>\n<p><a href=\"http://lh6.ggpht.com/-wiJLYcF-7Lo/T5JJCLG_NKI/AAAAAAAACVs/d57xmRWO4ys/s1600-h/image%25255B34%25255D.png\"><img src=\"http://lh3.ggpht.com/-Nt00SzNZ_4c/T5JJDFAs5XI/AAAAAAAACV0/JHXUSssxE14/image_thumb%25255B20%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>但我們這次選擇\"使用Windows Azure儲存體模擬器\"，這樣就可以了。</p>\n<p><a href=\"http://lh6.ggpht.com/-mjy86EwPwSw/T5JJEU3WukI/AAAAAAAACV8/FB-O6AsIXQA/s1600-h/image%25255B39%25255D.png\"><img src=\"http://lh5.ggpht.com/-ITTcS4TG9uE/T5JJFtRUB6I/AAAAAAAACWE/p5isyufPKfo/image_thumb%25255B23%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>我們可以從這兩個檔案來看到設定，其實從名子就可以發現，一個是Cloud，一個是Local。</p>\n<p><a href=\"http://lh5.ggpht.com/-U1M7ZVBL_vU/T5JJGh90OJI/AAAAAAAACWI/ewrxCWnfWL0/s1600-h/image%25255B43%25255D.png\"><img src=\"http://lh6.ggpht.com/-Shd1lCLWCNg/T5JJH9JcdyI/AAAAAAAACWQ/vm_n15MBE2E/image_thumb%25255B25%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>我們先看ServiceConfiguration.Cloud.cscfg，我們可以看到TestConnectionString的設定是Cloud的設定了。( 以下空空，是因為我塗白了.. )</p>\n<p><a href=\"http://lh4.ggpht.com/-CdJJNXyw9WE/T5JJIrhbd0I/AAAAAAAACWc/rawkgYSGOaA/s1600-h/image%25255B50%25255D.png\"><img src=\"http://lh5.ggpht.com/-PxxtDHPOJ3w/T5JJJ2pLLZI/AAAAAAAACWk/v72WQEm3boU/image_thumb%25255B28%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>如果是ServiceConfiguration.Local.cscfg，則就是預設本機的UseDevelopmentStorage=true的設定，也就是使用本機模擬的Azure Storage。</p>\n<p><a href=\"http://lh3.ggpht.com/-4rW9m52ZW8k/T5JJK_NtrgI/AAAAAAAACWs/-Kkoi1fIlVk/s1600-h/image%25255B54%25255D.png\"><img src=\"http://lh3.ggpht.com/-_w0OE-TY6_c/T5JJL9rtS1I/AAAAAAAACW0/tirZLTgd5e0/image_thumb%25255B30%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<h4>稍微改一下程式吧!</h4>\n<p>最後一個步驟，就是程式的地方，當然還是要稍微修改一下嚕，以下是片段的程式碼，至於如何存取的議題，可以<a href=\"http://blog.sanc.idv.tw/p/windows-azure.html\">參考這邊</a>。</p>\n<pre class=\"brush: csharp;\">//如果想使用本地端的Storage Account，而不使用連線字串，可以這樣寫，\n//這邊我就註解掉了，因為我們現在要使用連線字串。\n//CloudStorageAccount account = CloudStorageAccount.DevelopmentStorageAccount;\n//如果是使用連線字串，就可以這樣寫。\nCloudStorageAccount account = CloudStorageAccount.Parse(RoleEnvironment.GetConfigurationSettingValue(\"TestConnectionStrting\"));\n</pre>\n<p>沒錯!這樣就完成了!，有沒有很簡單啊!</p>\n<h4>參考資料</h4>\n<ul>\n<li><a href=\"http://msdn.microsoft.com/zh-tw/library/gg494982.aspx\" title=\"http://msdn.microsoft.com/zh-tw/library/gg494982.aspx\">http://msdn.microsoft.com/zh-tw/library/gg494982.aspx</a></li>\n<li><a href=\"http://msdn.microsoft.com/zh-tw/library/hh225339.aspx\" title=\"http://msdn.microsoft.com/zh-tw/library/hh225339.aspx\">http://msdn.microsoft.com/zh-tw/library/hh225339.aspx</a></li>\n<li><a href=\"http://msdn.microsoft.com/zh-tw/library/ee758697.aspx\" title=\"http://msdn.microsoft.com/zh-tw/library/ee758697.aspx\">http://msdn.microsoft.com/zh-tw/library/ee758697.aspx</a></li>\n<li><a href=\"http://msdn.microsoft.com/zh-tw/library/hh369931.aspx\" title=\"http://msdn.microsoft.com/zh-tw/library/hh369931.aspx\">http://msdn.microsoft.com/zh-tw/library/hh369931.aspx</a></li>\n</ul>","excerpt":"如Davia老師所說，當開始繳錢，使用Windows Azure後，第一個會遇到的問題一定就是連線字串的問題；我們在本機模擬的時候，其實都不會考慮到這些問題，但當程式發佈到雲端後，總不可能還在繼續存取我們本地端的Storage…"}},"pageContext":{"type":"posts","next":{"frontmatter":{"path":null,"title":"ASP.NET MVC - 第一個Web API,Hello Web API","tags":["ASP.NET MVC"]},"fields":{"slug":"/2012/04/19/ASP-NET-MVC-第一個Web-API-Hello-Web-API/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/ASP-NET-MVC-第一個Web-API-Hello-Web-API.md"},"previous":{"frontmatter":{"path":null,"title":"Windows Azure - 使用Windows Azure Storage解決Sessios問題","tags":["ASP.NET","Azure"]},"fields":{"slug":"/2012/04/21/Windows-Azure-使用Windows-Azure-Storage解決Sessios問題/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Windows-Azure-使用Windows-Azure-Storage解決Sessios問題.md"}}}}