{"componentChunkName":"component---src-templates-page-js","path":"/2012/11/27/Windows-Azure-Cloud-Service的佈署方式/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Windows Azure - Cloud Service的佈署方式","date":"27 November 2012","author":"Sky Chang","excerpt":null,"tags":["Azure"],"coverImage":null},"id":"cc236c49-ad55-54dc-8f1d-55cad2f00f92","html":"<p>今天剛好有人問到，問我Cloud Service是怎樣佈署的，本來想說，把Blog網址丟過去交差了事( 疑!? 當然是開玩笑的XDD，我怎麼可能會做這種事情!! )，但後來發現，原來，我根本還沒寫過類似的文章 ( 所以也不能丟丟網址交差了事了…QQ )，所以這篇，教大家，幾個Cloud Service佈署的方式，另外，如果有去今年TechDays的朋友們，John哥那場也有介紹到這幾種方式喔!!</p>\n<h4>第一種 建立兩個Cloud Server</h4>\n<p>嗯，這也是小弟一開始使用的方式，假如正是網址為sky.com；簡單的說，就是準備兩個Cloud Service，A和B，當A是正式環境的時候，就把程式佈署到B，然後再利用自己架設的DNS，改變DNS，讓sky.com指向B的ip位置；所以Cloud Service B就變成正式的環境；同理，下次要佈署的時候，就佈署到A，然後再取改變DNS，讓sky.com指向A…嗯，當然小弟我就直接講結論了，基本上，除非不得已，不然真的不要用這種佈署方式…</p>\n<h4>第二種 直接覆蓋</h4>\n<p>其實在Cloud Service上，是可以直接覆蓋的，而且覆蓋期間，服務是不會中斷的( 官方文件是寫，如果有兩個Role以上，就不會中斷 )，簡單的說，就是只有一台Cloud Server A，而我們直接使用UpDate的方式，如下圖。</p>\n<p><a href=\"http://lh3.ggpht.com/-vJd1ld8dfWA/ULTTX5bvlvI/AAAAAAAAFa4/8XCEngH8O-E/s1600-h/image%25255B4%25255D.png\"><img src=\"http://lh4.ggpht.com/-Ll0WRuBE9C8/ULTTYubxC4I/AAAAAAAAFbA/tKGmb602j54/image_thumb%25255B2%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>如果有多台Role，其實也不用擔心UPDATE會一口氣全部升級，我們可以從INSTANCES的地方看到UPDATE DOMAIN，簡單的說，Azure的升級，根據UPDATE DOMAIN的區塊進行升級，不過因為小弟這邊只用一個Web Role和Work Role，所以都是0，如果有兩個以上，就會發現有0，1，2等等不同的區段。</p>\n<p><a href=\"http://lh3.ggpht.com/-NrpLDKDKCB0/ULTTZ0ZHR9I/AAAAAAAAFbI/KYKLuNYo9oE/s1600-h/image%25255B11%25255D.png\"><img src=\"http://lh3.ggpht.com/-A5ZSxduSRH0/ULTTas5wTlI/AAAAAAAAFbQ/ZgmJ-NRxXRM/image_thumb%25255B5%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>當然，這是一種升級方式，也是小弟後來使用的升級方式。</p>\n<h4>第三種方式 SWAP VIP</h4>\n<p>當然，小弟還是主推這種方式，因為這種方式真的是超級方便，不知道大家還記不記得，其實Cloud Service有分兩種Production和Staging ( 雖然兩個都要收錢… )，但是他既然這樣分，就自然有它的用意；所以這種佈署的方式，就是我們正式的Web頁面在Production上，而將我們準備要佈署新的頁面先佈署到Staging( 一個Cloud Service可以同時佈署不同的Production和Staging )，我們只要在DASHBOARD按下Staging，就可以切換到Staging，然後再按下下面的佈署，就可以佈署到Staging，而Production完全不會受到影響。<a href=\"http://lh4.ggpht.com/-_lf3yt-wp8Y/ULTTbrCZ23I/AAAAAAAAFbU/7lz4EonDzp8/s1600-h/image%25255B16%25255D.png\"><img src=\"http://lh5.ggpht.com/-2b_alUqYv6o/ULTTdLmQzlI/AAAAAAAAFbg/f4YZzfNpyV8/image_thumb%25255B8%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>當Staging佈署完成後，進入下一步之前，我們稍微回顧一下，現在我們的Production是正式環境，Staging是測試環境；如果依據版本來看，Staging目前放的是比較新的版本 ( 因為準備要替換掉目前Prodction線上的頁面嘛 )，那要如何做呢?我們只要按下SWAP按鈕，接下來按下ok。</p>\n<p><a href=\"http://lh6.ggpht.com/-psAEIdDYCjw/ULTTedq8XdI/AAAAAAAAFbo/7OOXgjt_pe0/s1600-h/image%25255B20%25255D.png\"><img src=\"http://lh3.ggpht.com/-fSkvGtAJhcs/ULTTfmOQSzI/AAAAAAAAFbs/puzvHYuMNNo/image_thumb%25255B10%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>是的，神奇的事情就這樣發生了SWAP的作用，就是將Prodction和Staging互換，簡單的說，原本準備卸下來，在Prodction的頁面，會變成Staging，而準備換上去，在Staging的新網站，會變成Production，所以，按下去後，我們放在Staging的新網站，就自動地被切換成新網站了!!當然，過程中，也不會中斷，全部交由Azure完成。</p>\n<p>當然，後面的機制都是由Azure完成，主要是透過Role前面的Load Blance來切換位置，當然，這和我們使用者一點關係都沒有。</p>\n<h4>後記</h4>\n<p>是的，不用說，當然要用第三種方式，但也別忘記，放在Staging的網站，也是要算錢的，所以如果被換下來的舊網站，真的不需要的話，也別忘記砍掉，而第一二種方式就完全沒用了嗎?其實也不一定，或許某些場合，還是需要=v=，不管如何，這三種是Cloud Service佈署的一些小技巧，也給大家參考看看。</p>\n<h4>參考網址</h4>\n<ul>\n<li><a href=\"http://msdn.microsoft.com/en-us/library/windowsazure/hh472157.aspx\" title=\"http://msdn.microsoft.com/en-us/library/windowsazure/hh472157.aspx\">http://msdn.microsoft.com/en-us/library/windowsazure/hh472157.aspx</a></li>\n</ul>","excerpt":"今天剛好有人問到，問我Cloud Service是怎樣佈署的，本來想說，把Blog網址丟過去交差了事( 疑!? 當然是開玩笑的XDD，我怎麼可能會做這種事情!! )，但後來發現，原來，我根本還沒寫過類似的文章 ( 所以也不能丟丟網址交差了事了…QQ…"}},"pageContext":{"type":"posts","next":{"frontmatter":{"path":null,"title":"TFS -  刪除不需要的使用者","tags":["TFS"]},"fields":{"slug":"/2012/11/27/TFS-刪除不需要的使用者/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/TFS-刪除不需要的使用者.md"},"previous":{"frontmatter":{"path":null,"title":"Windows Azure -  佈署Cloud Service時，直接選擇想要的OS","tags":["Azure"]},"fields":{"slug":"/2012/11/27/Windows-Azure-佈署Cloud-Service時，直接選擇想要的OS/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Windows-Azure-佈署Cloud-Service時，直接選擇想要的OS.md"}}}}