{"componentChunkName":"component---src-templates-page-js","path":"/2012/05/24/ASP-NET-MVC-Web-API-利用jQuery進行CRUD-番外篇-丟去Azure吧/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"ASP.NET MVC Web API - 利用jQuery進行CRUD! 番外篇 丟去Azure吧!","date":"24 May 2012","author":"Sky Chang","excerpt":null,"tags":["ASP.NET MVC","Azure","Visual Studio"],"coverImage":null},"id":"0ffad6f0-d0fc-5472-8a17-d33bf3553a84","html":"<p><font color=\"#ff0000\">5/31 新增Namespace和設定錯誤訊息。</font></p>\n<p>前面花了很多時間寫了<a href=\"http://blog.sanc.idv.tw/p/aspnet-mvc.html\">三篇</a>ASP.NET MVC Web API的教學，這篇我們來稍微玩一下輕鬆的話題，不然Windows Azure快要過期了QQ，再不趕快給他玩一下，太對不起自己了。</p>\n<p>好，這篇其實很簡單，我們主要的目標是希望把前面寫的東西佈署到雲端上去；當然同樣的技巧也適用於ASP.NET和ASP.NET MVC。</p>\n<p>或許有人會說，我之前的程式都沒有寫，那我要怎樣練習!?，首先，如果你沒有申請到帳號，基本上也沒機會傳到Azure上面去，但目前台灣地區還沒開放( 寫這篇文章的時間是5/24，未來這篇文章不見得會記得更新，所以要練習的朋友，可以去看看目前開放了沒 )，台灣地區目前也快要開放了，大家可以稍等一下；如果真的受不了，想和暗黑破壞神3一樣，選擇美服的玩家，也請注意，需要當地的手機，才能進行驗證；但不管怎樣，模擬器都還是可以正常運作的。</p>\n<h4>增加雲端專案</h4>\n<p>下面是我們之前已經寫好的程式，如果沒有寫的人，可以自己新增一個ASP.NET 或是ASP.NET MVC的專案。</p>\n<p><a href=\"http://lh5.ggpht.com/-auqloNd0tU4/T7462WEFIJI/AAAAAAAACqE/CS9cACcaRFQ/s1600-h/image2.png\"><img src=\"http://lh5.ggpht.com/-UIJd2EyexAo/T7463gEUx8I/AAAAAAAACqM/dE-A5ud2SuQ/image_thumb.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>然後我們新增一個專案。</p>\n<p><a href=\"http://lh3.ggpht.com/-eLlA3MHaQQU/T7464qyuYuI/AAAAAAAACqU/VxbRpSeE-qE/s1600-h/image6.png\"><img src=\"http://lh5.ggpht.com/-lbtK67lBpj0/T7466HaiRzI/AAAAAAAACqc/wpsXejNwWxk/image_thumb2.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，我們選擇雲端的專案，也請記得，要把專案名稱改成有意義的。</p>\n<p><a href=\"http://lh6.ggpht.com/-HPMGYL33g2Y/T7468Mhj7PI/AAAAAAAACqk/Q-eZ1SimyQY/s1600-h/image10.png\"><img src=\"http://lh6.ggpht.com/-5CnpMj9ufuU/T7469Zr6NpI/AAAAAAAACqs/stbHjVBVyFw/image_thumb4.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>這裡甚麼都不用選，直接按下確定就可以了，因為我們不需要再多增加其他的專案。</p>\n<p><a href=\"http://lh5.ggpht.com/-oa8tD7ZLlTs/T746-HBuHaI/AAAAAAAACq0/pVd3iTzoL38/s1600-h/image16.png\"><img src=\"http://lh5.ggpht.com/-puRZUHYVEkA/T746_KO-dLI/AAAAAAAACq8/Uf6lwGKkKeg/image_thumb8.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>完成後會如下圖。</p>\n<p><a href=\"http://lh4.ggpht.com/-wntPy9cqH5E/T747AXr4sRI/AAAAAAAACrE/8Pl5jj0WRVk/s1600-h/image24.png\"><img src=\"http://lh3.ggpht.com/-zNmtoB8EJXI/T747B6853II/AAAAAAAACrM/pzmYyv4q8O0/image_thumb12.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，我們要把現有的MvcWebApiCRUDDemo這個專案，設定成Windows Azure的Web Role；選擇Windows Azure專案底下的角色，然後按下滑鼠右鍵，選擇加入，在選擇方案中的Web角色專案。</p>\n<p><a href=\"http://lh4.ggpht.com/-Wr4avaKcsP0/T747Cvtf-1I/AAAAAAAACrU/wYJCtuDCAnc/s1600-h/image28.png\"><img src=\"http://lh3.ggpht.com/-_wrfy38-gl4/T747FECsKuI/AAAAAAAACrc/ne3HRoQDcFQ/image_thumb14.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，按下確定就可以了，原本的我們寫好的Web API就會和Windows Azure的Web Role進行關聯。</p>\n<p><a href=\"http://lh5.ggpht.com/-q84a5LYzRW8/T747GHwC9gI/AAAAAAAACrk/mOO85WSEZqQ/s1600-h/image33.png\"><img src=\"http://lh6.ggpht.com/-GGxwbIW4oTs/T747HP6DZPI/AAAAAAAACrs/9Fzz90CMwHQ/image_thumb17.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>完成後就會如下圖。</p>\n<p><a href=\"http://lh4.ggpht.com/-pbGH-qV7_lU/T747IB4BRII/AAAAAAAACr0/1N-H-0uCDcg/s1600-h/image38.png\"><img src=\"http://lh5.ggpht.com/-b5V6Lj04CB8/T747JEuauTI/AAAAAAAACr4/vTXuYyjVkEw/image_thumb20.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，我們可以Run一下模擬器看看，有沒有任何問題。</p>\n<p><a href=\"http://lh4.ggpht.com/-ucic3NcfaXs/T747KM1B9SI/AAAAAAAACsE/ZbAnj1NmcMw/s1600-h/image43.png\"><img src=\"http://lh5.ggpht.com/-kTA_15rg9b4/T747LFeiOYI/AAAAAAAACsM/8I6ZukDYjX0/image_thumb23.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<h4>增加NameSpace ( 2012/5/31 新增 )</h4>\n<p>到這邊，就如上圖一樣，其實就可以順利的運作在Azure了，但是，那是因為整個應用程式裡面也沒用到Azure Storage，所以當然可以順利執行，但假設今天想利用Table儲存的話呢?就需要添加三個NameSpace。</p>\n<p><a href=\"http://lh6.ggpht.com/-3Zi1v6DuC4Q/T8eNBZDpkqI/AAAAAAAAC2s/ShA7ciriI7A/s1600-h/image%25255B4%25255D.png\"><img src=\"http://lh6.ggpht.com/-oIu7iEqVNYk/T8eNCa_p1UI/AAAAAAAAC20/XGcmhjiiU8M/image_thumb%25255B2%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<h4>增加DiaqnosticMonitorTraceListener Class ( 2012/5/31更新 )</h4>\n<p>另外，平常沒事就沒事，如果有bug，在雲端的程式其實是很難除錯的，所以我們可以在Web.Config加上DiaqnosticmonitorTraceListener Class，未來我們就可以在程式裡面，Trace Log到Azure Storage。( 這邊就沒示範了，有興趣的可以參考<a href=\"http://msdn.microsoft.com/zh-tw/library/microsoft.windowsazure.diagnostics.diagnosticmonitortracelistener.aspx\">這篇</a>。 )</p>\n<pre class=\"brush: xml;\">&lt;configuration&gt;\n    &lt;system.diagnostics&gt;\n        &lt;trace&gt;\n            &lt;listeners&gt;\n                &lt;add type=\"Microsoft.WindowsAzure.Diagnostics.DiagnosticMonitorTraceListener, Microsoft.WindowsAzure.Diagnostics, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35\"\n                  name=\"AzureDiagnostics\"&gt;\n                &lt;/add&gt;\n            &lt;/listeners&gt;\n        &lt;/trace&gt;\n    &lt;/system.diagnostics&gt;\n</pre>\n<p>基本上，如果一開始就是開Cloud專案的話，也會自動的修改Web Role專案的Web.Config喔。</p>\n<p>如果沒有Azure帳號，那就只能測試到這邊為止了，接下來，我們來看看怎樣放到Windows Azure。</p>\n<h4>部屬到Windows Azure</h4>\n<p>我們選擇Windows Azure專案，並且選擇封裝，當然如果想使用\"發行\"也是可以的，但使用發行需要做比較多的設定，大家可以<a href=\"http://blog.sanc.idv.tw/2012/04/windows-azure-visual-studiowindows.html\">參考這篇</a>。</p>\n<p><a href=\"http://lh6.ggpht.com/-yEZaZprXLEc/T747MG3j3HI/AAAAAAAACsU/doNgQFqiB2g/s1600-h/image48.png\"><img src=\"http://lh4.ggpht.com/-tf2f5sNDGMc/T747M9F-BKI/AAAAAAAACsc/rYH4paoMc1Q/image_thumb26.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，按下封裝就可以，這邊有服務組態和組件組態可以設定，這些設定其實會對應到Windows Azure的設定檔，但這裡再談這個就會離題太遠了，基本上，如果沒有特別修改設定，用預設的就可以。</p>\n<p><a href=\"http://lh4.ggpht.com/-cmFapKXIyaM/T747N41aBzI/AAAAAAAACsg/uln6BQ0Xef0/s1600-h/image52.png\"><img src=\"http://lh5.ggpht.com/-rafBlue7Ghs/T747OtHk85I/AAAAAAAACss/13wP9SRy8wI/image_thumb28.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>完成後，就會套出此視窗，然後Visual Studio會幫我們把東西都給包好。</p>\n<p><a href=\"http://lh5.ggpht.com/-YUltaZYrGwo/T747PvpU4gI/AAAAAAAACs0/f2XTa6EZPcg/s1600-h/image57.png\"><img src=\"http://lh5.ggpht.com/-HO3GVkiQCRs/T747Qq9Y6bI/AAAAAAAACs8/yH6rb5g_Rp8/image_thumb31.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，我們在Windows Azure管理平台的首頁，可以看到新增託管服務。</p>\n<p><a href=\"http://lh5.ggpht.com/-dx6rRFDtAHY/T747RXA50cI/AAAAAAAACtA/Evi7AjlVoxU/s1600-h/image62.png\"><img src=\"http://lh3.ggpht.com/-WcZJW_rNunE/T747ScELdGI/AAAAAAAACtM/zRSpkkUyXlk/image_thumb34.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>然後我們就要打一堆東西，比較值得注意的是，不管是佈署到預備環境還是生產環境，只要佈署上去，就開始收費；另外，像小弟我佈署上去的時間點剛好是五十幾分，所以過了整點，就算兩個小時的費用了…</p>\n<p><a href=\"http://lh5.ggpht.com/-fs4ax2T4jqY/T747TMqiYDI/AAAAAAAACtU/LUgvD9EHhoQ/s1600-h/image68.png\"><img src=\"http://lh4.ggpht.com/-eYvZ8vVUIqI/T747UDLFFJI/AAAAAAAACtc/U1_ccCA7Gig/image_thumb38.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>按下確定後，會出現一個警告，但不用擔心，這只是在告訴我們，如果只設定一個Web Role，可能沒辦法達到99.95%的高可用性 ( 簡單的說，就是有可能遇到服務中斷的情況啦 )，所以微軟建議我們使用兩個Web Role..當然，錢也變成兩倍。</p>\n<p><a href=\"http://lh4.ggpht.com/-akeq7NxKVk0/T747U9xyfhI/AAAAAAAACuI/nCI9ZJUKI3c/s1600-h/image%25255B2%25255D.png\"><img src=\"http://lh6.ggpht.com/-0dvNCI-wi38/T747Vxok2_I/AAAAAAAACuM/QQISGu2HqIU/image_thumb%25255B2%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來就是進入漫長的等待，通常需要10分鐘左右，等到資訊變成下圖，就表示已經完成了。</p>\n<p><a href=\"http://lh3.ggpht.com/-rLN_JqrG10o/T747WtmWJBI/AAAAAAAACtw/BefZF5qk70U/s1600-h/image77.png\"><img src=\"http://lh3.ggpht.com/-_q9-PMtoQGY/T747XY532tI/AAAAAAAACt4/MzjE4sErHPc/image_thumb43.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>完成後，我們就可以利用剛剛設定好的網址進行測試，看看有沒有問題，當然，如果有DNS，也可以自行設定轉址的動作。</p>\n<p><a href=\"http://lh5.ggpht.com/-U5ZD02YLbaI/T7495SzBcDI/AAAAAAAACuQ/wCN9FqGVD2A/s1600-h/image%25255B7%25255D.png\"><img src=\"http://lh3.ggpht.com/-QHkJwqQiK0Y/T7496YYzFOI/AAAAAAAACuY/sZ-3CjyiMTY/image_thumb%25255B5%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>就這樣，整個就佈署上去了。</p>\n<h4>後記</h4>\n<p>當然，這是一個很簡單的程式，所以其實不會遇到甚麼很大的問題，所以這邊也只簡單的介紹基本的原則，未來如果剛好有碰到不好處理的案子，小弟我再放上來給大家參考吧=V=。</p>\n<p>參考資料</p>\n<ul>\n<li><a href=\"http://msdn.microsoft.com/zh-tw/library/microsoft.windowsazure.diagnostics.diagnosticmonitortracelistener.aspx\">http://msdn.microsoft.com/zh-tw/library/microsoft.windowsazure.diagnostics.diagnosticmonitortracelistener.aspx</a><li><a href=\"http://blogs.msdn.com/b/azchina/archive/2010/06/18/windows-azure-diagnostic.aspx\">http://blogs.msdn.com/b/azchina/archive/2010/06/18/windows-azure-diagnostic.aspx</a></li>\n</ul>","excerpt":"5/31 新增Namespace和設定錯誤訊息。 前面花了很多時間寫了三篇ASP.NET MVC Web API的教學，這篇我們來稍微玩一下輕鬆的話題，不然Windows Azure快要過期了QQ…"}},"pageContext":{"type":"posts","next":{"frontmatter":{"path":null,"title":"ASP.NET MVC Web API - 利用jQuery進行CRUD! (三) View篇","tags":["ASP.NET MVC","CSS","HTML","JavaScript","jQuery"]},"fields":{"slug":"/2012/05/24/ASP-NET-MVC-Web-API-利用jQuery進行CRUD-三-View篇/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/ASP-NET-MVC-Web-API-利用jQuery進行CRUD-三-View篇.md"},"previous":{"frontmatter":{"path":null,"title":"ASP.NET MVC - MVC和Web API之Model Binder的陷阱","tags":["ASP.NET MVC","Silveright"]},"fields":{"slug":"/2012/05/26/ASP-NET-MVC-MVC和Web-API之Model-Binder的陷阱/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/ASP-NET-MVC-MVC和Web-API之Model-Binder的陷阱.md"}}}}