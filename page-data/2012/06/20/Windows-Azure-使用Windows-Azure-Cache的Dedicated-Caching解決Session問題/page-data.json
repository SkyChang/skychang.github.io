{"componentChunkName":"component---src-templates-page-js","path":"/2012/06/20/Windows-Azure-使用Windows-Azure-Cache的Dedicated-Caching解決Session問題/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Windows Azure - 使用Windows Azure Cache的Dedicated Caching解決Session問題","date":"20 June 2012","author":"Sky Chang","excerpt":null,"tags":["ASP.NET","ASP.NET MVC","Azure"],"coverImage":null},"id":"d0279ba2-0534-5745-a146-b2b147098e5b","html":"<p>最近忙著處理一些事情，所以這短篇到現在才出來，基本上使用Dedicated Role來當Cache也和<a href=\"http://blog.sanc.idv.tw/2012/06/windows-azure-windows-azure-co-located.html\">前一篇</a>差不多，如果不清楚此機制的人，可以先參考<a href=\"http://blog.sanc.idv.tw/2012/06/windows-azure-overview-of-caching-in.html\">小弟這篇</a>，或是小朱前輩<a href=\"http://www.dotblogs.com.tw/regionbbs/archive/2012/06/10/windows.azure.spring.release.part4.caching.improvements.aspx\">這篇</a>。</p>\n<p><a href=\"http://blog.sanc.idv.tw/2012/06/windows-azure-windows-azure-co-located.html\">前篇</a>我們是使用Co-located Cache( Existing Roles )的機制來放當作Cache使用，Co-located Cache( Existing Roles )也就是拿目前現有的Role中，一部分的記憶體，來當作Cache，但有的時候，網站真的附載太大了，我們就可以使用新的Role來當作Cache，也就是Dedicated Caching ( Dedicated Roles )。</p>\n<h4>增加Dedicated Roles ( Cache Worker Role )</h4>\n<p>我們可以從Azure專案裡面的Roles來新增，如下圖。</p>\n<p><a href=\"http://lh4.ggpht.com/-PF2iuVYkF_w/T-CiG5A84sI/AAAAAAAADOI/QHhJ-haq9T0/s1600-h/image%25255B3%25255D.png\"><img src=\"http://lh6.ggpht.com/-I74aXm3OVmc/T-CiHTZQWbI/AAAAAAAADOQ/gb_5AtpOC7w/image_thumb%25255B1%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>到這邊，我們在選擇Cache Worker Role。</p>\n<p><a href=\"http://lh5.ggpht.com/-0BqWy7F83Dg/T-CiIbcjOsI/AAAAAAAADOY/BwpE5P9yYuI/s1600-h/image%25255B8%25255D.png\"><img src=\"http://lh6.ggpht.com/-KTl8t3gTQjw/T-CiI7bO6CI/AAAAAAAADOg/KQBAH6HFWBI/image_thumb%25255B4%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>之後我們就可以從下圖發現，增加了這些東西，而這邊雖然也有WorkerRoles.cs，不過裡面是空的。</p>\n<p><a href=\"http://lh3.ggpht.com/-QNmiD4wDXsI/T-CiJVGJNyI/AAAAAAAADOo/GztmdHd5kvY/s1600-h/image%25255B12%25255D.png\"><img src=\"http://lh5.ggpht.com/-6AnMrvbTM34/T-CiJwk9MlI/AAAAAAAADOw/5FhWWPI3IIM/image_thumb%25255B6%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<h4>設定Dedicated Roles</h4>\n<p>我們可以點兩下剛剛建好的CacheWorkerRole1。</p>\n<p><a href=\"http://lh3.ggpht.com/-f6aTk5BdVIM/T-CiKQD9hLI/AAAAAAAADO4/89wrYe2ew60/s1600-h/image%25255B16%25255D.png\"><img src=\"http://lh3.ggpht.com/-CmHxUGL1aJM/T-CiLHuKAbI/AAAAAAAADPA/iP7KUuwBdJw/image_thumb%25255B8%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>其實點開後，就會發現，預設已經幫我們Enable了，而如果要部屬到Windows Azure上面，別忘了要設定一下Storage Account ( 預設是UseDevelopmentStorage=true 那邊。)，如果想自行定義一些其他Cache功能的，可以在Add Named Cache那邊去新增，預設就是Default了。</p>\n<p><a href=\"http://lh5.ggpht.com/-ST8pitGYQbU/T-CiLo8GSkI/AAAAAAAADPI/wdc6cvlNzQI/s1600-h/image%25255B21%25255D.png\"><img src=\"http://lh3.ggpht.com/-oME_G6Nop6g/T-CiMnz0jNI/AAAAAAAADPQ/PoebR13NH9M/image_thumb%25255B11%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>其餘的部分，需要增加的dll、ASP.NET Web.Config的設定，都和<a href=\"http://blog.sanc.idv.tw/2012/06/windows-azure-windows-azure-co-located.html\">前一篇</a>相同，這裡就不詳細多做介紹了，比較須注意的是，Web.config的設定，這邊因為我們要使用的是CacheWorkerRole1，所以identifier要設定成CacheWorkerRole1。</p>\n<pre class=\"brush: xml;\">  &lt;dataCacheClients&gt;\n    &lt;tracing sinkType=\"DiagnosticSink\" traceLevel=\"Error\" /&gt;\n    &lt;dataCacheClient name=\"default2\"&gt;\n      &lt;autoDiscover isEnabled=\"true\" identifier=\"CacheWorkerRole1\" /&gt;\n      &lt;!--&lt;localCache isEnabled=\"true\" sync=\"TimeoutBased\" objectCount=\"100000\" ttlValue=\"300\" /&gt;--&gt;\n    &lt;/dataCacheClient&gt;\n  &lt;/dataCacheClients&gt;\n</pre>\n<p>這樣就可以了。</p>\n<h4>後記</h4>\n<p>最近在看這部分的原理，其實裡面的詳細設定還滿多東西的，這部份等一些細節真的比較了解後，會在po上來；而這幾篇的Cache可以感覺得出來，Microsoft很費心地希望把雲端的環境弄成和一般環境一樣 ( 真實當然是不一樣，這裡是指，可以讓目前現有的環境，無痛轉移到雲端 ) ，無論是最近的Web Site或是新的Cache機制，都讓現有的環境更方便的轉移到雲端上面來，而現在雲端台灣區也開放了，這麼好的東西，還不趕快來用嗎=v=?</p>\n<h4>參考資料</h4>\n<ul>\n<li><a href=\"http://msdn.microsoft.com/en-us/library/hh914128\" title=\"http://msdn.microsoft.com/en-us/library/hh914128\">http://msdn.microsoft.com/en-us/library/hh914128</a></li>\n</ul>","excerpt":"最近忙著處理一些事情，所以這短篇到現在才出來，基本上使用Dedicated Role來當Cache也和前一篇差不多，如果不清楚此機制的人，可以先參考小弟這篇，或是小朱前輩這篇。 前篇我們是使用Co-located Cache( Existing Roles…"}},"pageContext":{"type":"posts","next":{"frontmatter":{"path":null,"title":"Windows Azure - 使用Windows Azure co-located Caching解決Session問題","tags":["ASP.NET","ASP.NET MVC","Azure"]},"fields":{"slug":"/2012/06/16/Windows-Azure-使用Windows-Azure-co-located-Caching解決Session問題/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Windows-Azure-使用Windows-Azure-co-located-Caching解決Session問題.md"},"previous":{"frontmatter":{"path":null,"title":"Visual Studio 2012 - 超好用套件VSCommands 11","tags":["Visual Studio"]},"fields":{"slug":"/2012/06/20/Visual-Studio-2012-超好用套件VSCommands-11/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Visual-Studio-2012-超好用套件VSCommands-11.md"}}}}