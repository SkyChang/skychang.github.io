{"componentChunkName":"component---src-templates-page-js","path":"/2012/07/26/Windows-Azure-製作自己的VM影像檔並且利用這個影像檔來產生一台新VM/","result":{"data":{"markdownRemark":{"frontmatter":{"title":"Windows Azure - 製作自己的VM影像檔並且利用這個影像檔來產生一台新VM!","date":"26 July 2012","author":"Sky Chang","excerpt":null,"tags":["Azure"],"coverImage":null},"id":"6233a8cb-1e99-5146-8be0-67d0fcd8a90e","html":"<p><a href=\"http://blog.sanc.idv.tw/2012/06/windows-azure-virtual.html\">前一篇</a>我們使用了Windows Azure來的VM功能，並使用官方提供的影像檔來虛擬化一台Windows 2008 R2，但是Windows Azure的VM功能，並不是只能使用官方提供的影像檔來虛擬化機器，其實我們也可以在Windows Azure上面，建立自己的影像檔，把該準備好的東西先設定好，未來如果要產生新的VM，就可以快速的產生，而不需要重頭更新阿更新，設定阿設定，裝東西啊裝東西的忙得天翻地覆。( 並非所有安裝好的軟體、設定，都可以完好的重現，如需要知道詳細的資訊，可以用利用\"sysprep\"關鍵字來尋找資料。 )</p>\n<p>小弟我這邊的範例，是使用了一台Windows 2008 R2，並且將中文語系裝好 ( 預設官方提供的Image是英文語系的 )，也設定好DNS，接下來，我們來輕鬆愉快的看圖說故事吧!</p>\n<h4>登入目前的Windows Azure VM</h4>\n<p>首先我們第一步要做的，是先登入準備要製作成Image的VM，另外，這邊也提醒大家一下，當這個VM做成Image的時候，這台VM就會消失了，所以小弟建議，這個功能比較適合用在常常需要重新安裝的服務，例如這邊的例子，將原本沒有提供中文的官方Image，裝上中文語系，並做成Image，未來就可以不需要再去安裝中文語系，減輕負擔；此外，產生的Image是綁定訂閱的，如果今天是在\"3個月免費試用\"的Windows Azure訂閱裡面產生的Image，就只能在\"3個月免費試用\"的這個訂閱裡面用來產生新的VM，簡單的說，如果我今天還有一個MSDN的Windows Azure訂閱，是沒辦法從\"3個月免費試用\"的Image產生新VM到MSDN這個訂閱的，所以如果要搬移，可能就只能先下載到本機，再上傳到新的訂閱裡面去了。</p>\n<p>ok~登入VM後，我們要從\"開始\"的地方，並選擇\"執行\"。</p>\n<p><a href=\"http://lh5.ggpht.com/-gw4hh3lpkP4/UBDk5EPc4NI/AAAAAAAADlw/Wfp7QHxBicU/s1600-h/image%25255B4%25255D.png\"><img src=\"http://lh6.ggpht.com/-STECMPc9cW4/UBDk6V68tyI/AAAAAAAADl4/LqVaPGTYF2c/image_thumb%25255B2%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，我們打入\"sysprep\"，我們準備利用Sysprep工具。</p>\n<p><a href=\"http://lh5.ggpht.com/-EreRkNcIfw8/UBDk7Ee8Q2I/AAAAAAAADmA/5xVNHoxtxtQ/s1600-h/image%25255B12%25255D.png\"><img src=\"http://lh6.ggpht.com/-lexCeXRqNGY/UBDk8dMM33I/AAAAAAAADmI/zN_09u_iCTw/image_thumb%25255B6%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>接下來，我們會跳出這個視窗，當然，如果不想利用\"執行\"，我們也可以直接從c:\\windows\\System32\\sysprep的目錄下找到sysprep.exe這個檔案；接下來，就是點兩下sysprep.exe。</p>\n<p><a href=\"http://lh5.ggpht.com/-GR5EpwbDHsM/UBDk9f0zgZI/AAAAAAAADmQ/I81g8PugTbU/s1600-h/image%25255B17%25255D.png\"><img src=\"http://lh5.ggpht.com/-68h1zi8qBtA/UBDk-3jRAJI/AAAAAAAADmY/-fOZ7cL2Lrk/image_thumb%25255B9%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>sysprep這個工具就不多加介紹了，他主要的功能是讓大量佈署的時候，可以自動的清除一些設定，讓大量佈署更加的方便；而這邊，我們要選擇\"進入系統全新體驗(OOBE)\"，並勾選下面的一般化，然後下面選擇關機；這樣按下確定後，就會關機了。</p>\n<p><a href=\"http://lh4.ggpht.com/-1h3vcT_3rI4/UBDlAHiXwnI/AAAAAAAADmg/emdOWkLVvIE/s1600-h/image%25255B21%25255D.png\"><img src=\"http://lh4.ggpht.com/-rmOO6Pa67Nk/UBDlBBoTycI/AAAAAAAADmo/AAgaPI93A8o/image_thumb%25255B11%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>不過這部分要等一下下，執行完後，就會自動關機了。</p>\n<p><a href=\"http://lh4.ggpht.com/-SGIPpCVC-iw/UBDlCDwzhJI/AAAAAAAADnM/OgHHqKbPWKk/s1600-h/image%25255B30%25255D.png\"><img src=\"http://lh6.ggpht.com/-pt9JoD4SRjw/UBDlDAxxs9I/AAAAAAAADnQ/7FAAExyFZXY/image_thumb%25255B16%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>通常會需要一點時間，這時候可以去喝個茶，休息一下。</p>\n<h4>製作Image</h4>\n<p>當VM設定完成後，我們回到管理介面，我們可以看到這時候已經Stopped了，這時我們就可以使用Capture按鈕來製作Image。</p>\n<p><a href=\"http://lh6.ggpht.com/-IupF-YkF_Rs/UBDpaUU4HyI/AAAAAAAADnU/GpOmZud3on4/s1600-h/image%25255B35%25255D.png\"><img src=\"http://lh4.ggpht.com/-9erg8gnQEiM/UBDpbjyNPwI/AAAAAAAADnY/99luZJ_62IQ/image_thumb%25255B19%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>這裡要填一下資料，我們可以命名Image的名稱，並且下面要勾選起來，如果沒勾選，則沒辦法繼續下去喔!</p>\n<p><a href=\"http://lh6.ggpht.com/-iNU5xgpRfb8/UBDpcjTbaQI/AAAAAAAADnk/BiIE5dfklbY/s1600-h/image%25255B39%25255D.png\"><img src=\"http://lh6.ggpht.com/-1p3Ri5Z6jlg/UBDpdlu7WpI/AAAAAAAADns/3TvlyxDaYBc/image_thumb%25255B21%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>當Image產生完畢後，就如前面所說的，整個VM就會不見了，所以不是很建議使用在正在運作的服務上，如下圖，整個VM都不見啦~~</p>\n<p><a href=\"http://lh5.ggpht.com/-69JkfKTcWXs/UBDpe47Fu5I/AAAAAAAADn0/4xzJu3z6bB4/s1600-h/image%25255B66%25255D.png\"><img src=\"http://lh6.ggpht.com/-3s54xkxROXQ/UBDpf9PiolI/AAAAAAAADn8/1a18jdzdB70/image_thumb%25255B36%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>另外，雖然整個VM不見，但Cloud Service的部分，會多出現原本VM的服務，如果沒有特別需求，這邊可以Delete，當然，如果要留著作紀念，也是可以啦=v=，這邊刪除，並不是必需的。</p>\n<p><a href=\"http://lh5.ggpht.com/-n1N_ClLfKyI/UBDq5u1utWI/AAAAAAAADpk/dEMeWLVQzKE/s1600-h/image%25255B86%25255D.png\"><img src=\"http://lh6.ggpht.com/-NgV6g3JNW9U/UBDq63MW3EI/AAAAAAAADps/JuFR3AHQnOA/image_thumb%25255B48%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>到這邊，就算是Image製作完畢了。</p>\n<h4>使用剛剛的Image產生新的VM</h4>\n<p>剛剛建立好的Image，我們就可以利用他來產生看看。</p>\n<p><a href=\"http://lh6.ggpht.com/-seQ9SH_6fK4/UBDpiFix2GI/AAAAAAAADoE/skhKV5I5ul8/s1600-h/image%25255B53%25255D.png\"><img src=\"http://lh6.ggpht.com/-CYe127zJBU8/UBDpjNfxadI/AAAAAAAADoM/XDjOJQWsjE4/image_thumb%25255B29%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>一樣，選擇購物車的圖示 ( From Gallery )。</p>\n<p><a href=\"http://lh4.ggpht.com/-usCE606KO0Q/UBDpkgRxsPI/AAAAAAAADoU/_a-8bugPEkc/s1600-h/image%25255B57%25255D.png\"><img src=\"http://lh4.ggpht.com/-ivRjKuECD_k/UBDplp_5IZI/AAAAAAAADoc/DMJfQ23zlOA/image_thumb%25255B31%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>這時候，我們就可以選擇My Images，就可以看到剛剛建立的Image喔!!</p>\n<p><a href=\"http://lh4.ggpht.com/-t0QEyVx8QOw/UBDpmoBZ5rI/AAAAAAAADok/MxR7kiMExiI/s1600-h/image%25255B62%25255D.png\"><img src=\"http://lh3.ggpht.com/-XQtoiTkh1K0/UBDpoj-QDpI/AAAAAAAADos/hsY5k_wZ8S8/image_thumb%25255B34%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>這邊的配置和之前沒有甚麼不同。</p>\n<p><a href=\"http://lh5.ggpht.com/-y7TGBRIIwBI/UBDppr3emNI/AAAAAAAADo0/6KMbKjihPPU/s1600-h/image%25255B71%25255D.png\"><img src=\"http://lh3.ggpht.com/-e7QaMYhgBGw/UBDpr2sHntI/AAAAAAAADo4/hFxyNSFiDoQ/image_thumb%25255B39%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>這邊就要注意一下了，如前面所說，如果今天是在\"3個月免費試用\"的Windows Azure訂閱裡面產生的Image，就只能在\"3個月免費試用\"的這個訂閱裡面用訂閱，簡單的說，如果我今天還有一個MSDN的Windows Azure訂閱，是沒辦法從\"3個月免費試用\"的Image產生新VM到MSDN這個訂閱的，所以如果要搬移，可能就只能先下載到本機，再上傳到新的訂閱裡面去了；所以，這邊的Subscription (訂閱)，也只有\"3個月免費試用\"可以選擇，而我們看右邊的DNSImage資訊，也可以看到，這個Image是屬於\"3個月免費試用\"的訂閱範圍。</p>\n<p><a href=\"http://lh3.ggpht.com/-cOlxDSZTCA8/UBDptf01PWI/AAAAAAAADpE/aIuCR-iUARs/s1600-h/image%25255B76%25255D.png\"><img src=\"http://lh4.ggpht.com/-sykkOnna9l4/UBDpvw1kNPI/AAAAAAAADpM/n4VgjLNdOpA/image_thumb%25255B42%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>這邊可以選擇是否要HA架構，我們不需要，所以就選擇None了。</p>\n<p><a href=\"http://lh4.ggpht.com/-N8zKHLKdJSg/UBDpx8mA-eI/AAAAAAAADpU/jv7a-z_-Mw8/s1600-h/image%25255B81%25255D.png\"><img src=\"http://lh4.ggpht.com/-9uZO6IHPqj0/UBDpynilUnI/AAAAAAAADpc/CvE54FX6S68/image_thumb%25255B45%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>跑一段時間，等待完成。</p>\n<p><a href=\"http://lh6.ggpht.com/-zfzZSr8gPn0/UBDtOHKthJI/AAAAAAAADp0/hijdnIW7TJ4/s1600-h/image%25255B90%25255D.png\"><img src=\"http://lh3.ggpht.com/-J6kqapiCN5Y/UBDtPPXCR5I/AAAAAAAADp8/dQqMR8V_kkA/image_thumb%25255B50%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>到這邊，就可以看到，原本官方的Image是英文版，而我們自己的Image是中文版，並且設定好了DSN，如下圖。</p>\n<p><a href=\"http://lh3.ggpht.com/-PAXit1trS2g/UBDtQOgKDnI/AAAAAAAADqE/57fkzPu_9vE/s1600-h/image%25255B100%25255D.png\"><img src=\"http://lh4.ggpht.com/-lzNrylVUthA/UBDtRfGysHI/AAAAAAAADqM/CcbZf8RG5oE/image_thumb%25255B56%25255D.png?imgmax=800\" alt=\"image\" title=\"image\"></a></p>\n<p>這樣，簡單的範例就做完了!!</p>\n<h4>後記</h4>\n<p>有時候需要部署多台同樣的機器，我們就可以用這種方式大量的複製，但不要把它當成是一種備份，或是快照功能；他只是單純地讓我們可以有自己的Image方便部署而已。</p>","excerpt":"前一篇我們使用了Windows Azure來的VM功能，並使用官方提供的影像檔來虛擬化一台Windows 2008 R2，但是Windows Azure的VM功能，並不是只能使用官方提供的影像檔來虛擬化機器，其實我們也可以在Windows Azure…"}},"pageContext":{"type":"posts","next":{"frontmatter":{"path":null,"title":"Windows Azure - 使用VS2012部署功能部署ASP.NET MVC到Web Site上","tags":["ASP.NET MVC","Azure","Visual Studio"]},"fields":{"slug":"/2012/07/25/Windows-Azure-使用VS2012部署功能部署ASP-NET-MVC到Web-Site上/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Windows-Azure-使用VS2012部署功能部署ASP-NET-MVC到Web-Site上.md"},"previous":{"frontmatter":{"path":null,"title":"Windows Azure -  使用TFS部署，發生Service.Definition.build.csdef存取拒絕的錯誤","tags":["Azure","TFS"]},"fields":{"slug":"/2012/08/12/Windows-Azure-使用TFS部署，發生Service-Definition-build-csdef存取拒絕的錯誤/"},"fileAbsolutePath":"/home/runner/work/blog.sanc.idv.tw/blog.sanc.idv.tw/src/posts/blog.sanc.idv.tw/Windows-Azure-使用TFS部署，發生Service-Definition-build-csdef存取拒絕的錯誤.md"}}}}